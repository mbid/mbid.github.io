<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Semantics of Datalog with Equalities</title>
<link rel="stylesheet" type="text/css" href="https://cdn.rawgit.com/dreampulse/computer-modern-web-font/master/fonts.css">
<link rel="stylesheet" type="text/css" href="style.css">
<link rel="stylesheet" type="text/css" href="img-math/geometry.css">
</head>

<body>
<h1>Semantics of Datalog with Equalities</h1>
<h2>Abstract</h2>
<div class="paragraph">
We discuss the syntax and semantics of relational Horn logic (RHL) and partial Horn logic (PHL).
RHL is an extension of the Datalog programming language that allows introducing and equating variables in conclusions.
PHL is an extension of RHL by partial functions and one of the many equivalent notions of essentially algebraic theory.</div>
<div class="paragraph">
Our main contribution is a new construction of free models.
We associate to RHL and PHL sequents <em>classifying morphisms</em>, which enable us to characterize logical satisfaction using lifting properties.
We then obtain free and weakly free models using the <em>small object argument</em>.
The small object argument can be understood as an abstract generalization of Datalog evaluation.
It underpins the implementation of the <em>Eqlog</em> Datalog engine, which computes free models of PHL theories.</div>
<h2>
1 Introduction</h2>
<div class="paragraph">
<em>Datalog</em> [<a href="#know-datalog">11</a>] is a programming language for logical inference from Horn clauses.
Abstracting from concrete syntax, a Datalog program consists of the following declarations:
<ul>
<li>
<div class="paragraph">
A set of <em>sort symbols</em> <img src="img-math/c97a8fe633f85e531699955fb905d5a68ebdd81d9622ddcedb8f550da2473f85.svg" class="inline-math">.</div>
</li>
<li>
<div class="paragraph">
A set of <em>relation symbols</em> and their <em>arities</em> <img src="img-math/1811f68eb74929ecb6edffe855e69d59f231c07bbc85eda64f0b42728156e759.svg" class="inline-math">.</div>
</li>
<li>
<div class="paragraph">
A set of <em>sequents</em> (or <em>rules</em>, or <em>axioms</em>) of the form
<div class="display-math-row">
<img src="img-math/6437a45b5cc2bcf0a305c53f594af33f3716b507dd72d5674905f336d673b8f6.svg">
</div>
where <img src="img-math/76d213f7fc5b846c31e4909cd423e452744714c9fc6eeb95902631cb28bc1a22.svg" class="inline-math"> is a sort-compatible list of variables for each <img src="img-math/d42d5862aea05b2fd7aa9c5bb07e9c13754585c17cee2cf95c36c2d9fc35ebeb.svg" class="inline-math">, and each variable in the conclusion also appears in the premise.</div>
</li>
</ul>

A <em>fact</em> is an expression of the form <img src="img-math/fe2b04ce9825c2418bdb28a6ab09ef40919616be34d9d7dec5a20f982543b1f1.svg" class="inline-math"> where each <img src="img-math/b47caac25342a76cbe519c9ef7e76072c5ba16544ae26502f36453651785bf5e.svg" class="inline-math"> is a constant symbol of the appropriate sort.
Given a Datalog program and a set of input facts, a <em>Datalog engine</em> computes the set of facts that can be derived from the input facts by repeated application of sequents.</div>
<div class="paragraph">
A typical example of a problem that can be solved using Datalog is the computation of the transitive closure of a (directed) graph.
Graphs are given by a binary relation <img src="img-math/25ab26d1d36bddf688f13a71b074953f06579d25cf3d70b9b3539a4daa178404.svg" class="inline-math"> of edges among a sort <img src="img-math/097341643da03f834dcfc1c269e14dd1882b799fef693ffd387bad12e0df2571.svg" class="inline-math"> of vertices.
The only axiom of transitive graphs is the transitivity axiom
<div class="display-math-row">
<img src="img-math/166c630c9a49346fa2657d478d42df80658cfeb1349b8453a2f07dfa9586ae74.svg">
</div>
A set of input facts for this Datalog program is given by a set of of expressions <img src="img-math/820d4e4ef0d5940bef26918922eb3e76cfbe9f56e38653c9849d12bd656e2a0f.svg" class="inline-math">, where <img src="img-math/ccee10694213a800fcf0b9741ccc221c1e85cd63bf41465405647a4928b2010c.svg" class="inline-math"> are constant symbols.
We identify such data with the data of a graph with vertices <img src="img-math/13c7e0a6ecc1c544f8ccc74a35669d81437eb06d4ec3eabd47617e9ddfd3ff0a.svg" class="inline-math"> and edges <img src="img-math/158f7e9a2a196b80e709cd8d0a9de2f4e5a65b0059da3b9107caca1444d7062c.svg" class="inline-math">.
Every finite graph in which every vertex appears in some edge arises in this way, so we conflate such graphs and sets of facts.
(Standard Datalog does not support constants that do not appear in a fact.)</div>
<div class="paragraph">
Given the Datalog program for transitive graphs and a corresponding set of facts, a Datalog engine enumerates all matches of the premise of the transitivity axiom, i.e. all substitutions <img src="img-math/b7531fc821fa4ba3197ed06789e6da2f5c3d0a4422b2f37d304d22ae1559867e.svg" class="inline-math"> such that that the substituted conjuncts of the premise, <img src="img-math/820d4e4ef0d5940bef26918922eb3e76cfbe9f56e38653c9849d12bd656e2a0f.svg" class="inline-math"> and <img src="img-math/7c8dfc58d37b51305941da0c8e56b064f0877b9ee4e08d83e6b3306227ccc747.svg" class="inline-math">, are in the set of input facts.
For each such substitution, the Datalog engine then adds the substitution <img src="img-math/3a8044fed61ac66dada611c467b879419aaa271ba682b3aafb591571042b70fd.svg" class="inline-math"> of the conclusion to the set of facts.
This process is repeated until the set of facts does not increase anymore, that is, until a fixed point has been reached.
This final set of facts now corresponds to a transitive graph.</div>
<div class="paragraph">
Datalog has seen renewed interest in recent years for the implementation of program analysis tools [<a href="#declarative-points-to">10</a>, <a href="#alias-analysis-bdd">9</a>, <a href="#flix">8</a>].
From a high-level point of view, one applies Datalog by encoding abstract syntax trees as tuples in relations:
Each type of abstract syntax tree node translates into a relation. If the node type as <img src="img-math/509fe7e8ba852248c1de4dfc8c752f04a501aa15dc740f89268b2dd4cb0e9155.svg" class="inline-math"> children, then the relation has <img src="img-math/d0c752a914241f4f7e66e7affaf49531bcc8d090f651e5cf00e6377856d0f7f6.svg" class="inline-math"> entries, one entry for each children and one entry representing the node itself.
This encoding allows executing Datalog programs on inputs that are derived from source code.
Of course, the abstract syntax tree need not be encoded faithfully if some of its features are not required for the analysis one is interested in.</div>
<div class="paragraph">
<em>Equality saturation</em> has recently garnered interest as a program optimization technique [<a href="#egg">13</a>].
The idea is to insert expressions that should be optimized into an e-graph, and then close the e-graph under a set of rewrite rules.
E-graphs allow sharing nodes that occur as children more than once, so that a large number of expressions can be stored.
Furthermore, e-graphs can be efficiently closed under congruence, i.e. equivalence can be propagated from subexpressions to their parents.
After a suitable number of rewrite rules have been applied and the e-graph has been closed under congruence, one selects a suitable equivalent expression from the equivalence class of the expression one is interested in according to a cost function.
Crucially, equality saturation makes considerations about the order of rewrites unnecessary.</div>
<div class="paragraph">
In this paper, we study languages and corresponding semantics that combine and subsume both Datalog and the applications of e-graphs outlined above.
To that end, we extend Datalog by <em>equality</em>, that is, the ability of enforce an equality <img src="img-math/9cd2b0fcede7653e1b74d39d80f93075066d668d15e1482494016ff0f94e433f.svg" class="inline-math"> in the conclusion of a sequent.
One example is the order-theoretic antisymmetry axiom
<div class="display-math-row">
<img src="img-math/9b33b5fd0ba18023a7d335f12926e0ebeb11b2992b1f190f449c6486094f2a81.svg">
</div>
which is not valid Datalog due to the equality atom <img src="img-math/9cd2b0fcede7653e1b74d39d80f93075066d668d15e1482494016ff0f94e433f.svg" class="inline-math">, but allowed in our extension.
If during evaluation of RHL an equality among constants <img src="img-math/d4b6d11996bd567f1c0c3392691d7b85feef8cb5cab13a3cc68a47eb74848ccb.svg" class="inline-math"> and <img src="img-math/adb63ad171922b669d02e4c2d3ffc682202fae7cb7ebdc89b72a68d3e52ae155.svg" class="inline-math"> is inferred, then we expect the system to not distinguish <img src="img-math/d4b6d11996bd567f1c0c3392691d7b85feef8cb5cab13a3cc68a47eb74848ccb.svg" class="inline-math"> and <img src="img-math/adb63ad171922b669d02e4c2d3ffc682202fae7cb7ebdc89b72a68d3e52ae155.svg" class="inline-math"> from then on.
In other words, inferred equality should behave as congruence with respect to relations.
For example, the premise <img src="img-math/3a9d5ae329da605e9a7de695128094c34a6d9e48f0dab815b695eb611ada5aa3.svg" class="inline-math"> of the premise of the transitivity axiom should match <img src="img-math/692dd92afd91fb7bfe14d1a4889a1584e228626337d417154ab2f6115c003123.svg" class="inline-math"> if the equality <img src="img-math/f4bcf9c21e670f7c58fc884aec81b87c52a9c8d1e0adf24d8d487319a35801c3.svg" class="inline-math"> has been inferred earlier.
In addition to a set of derived facts, we also expect evaluation to yield an equivalence relation on each sort, representing inferred equalities.</div>
<div class="paragraph">
<em>Relational Horn logic</em> extends Datalog further by free variables matching any element of a sort, and by variables that only occur in a conclusion.
We interpret the latter as existentially quantified:
If the premise of a sequent matches and the conclusion contains a variable that is not bound in the premise, then we expect the Datalog engine to create new identifiers of the given sort if necessary to ensure that the conclusion holds.</div>
<div class="paragraph">
<em>Partial Horn logic</em>, originally due to [<a href="#phl">6</a>], is a layer of syntactic sugar on top RHL, i.e. a purely syntactic extension with the same descriptive power.
PHL adds function symbols <img src="img-math/9ff31b575bd0eda2c907ebbefc461c8a75a43c525285dc5c8d7be434eb95f452.svg" class="inline-math">, which desugar into relations <img src="img-math/85b7fe30ab12e9ccee0c8e2280e633cc1d6cea397a57863c7d413847ef06ec6f.svg" class="inline-math"> representing the graph of the function and the functionality axiom
<div class="display-math-row">
<img src="img-math/0d7bb62e0696830dc3c1a7fe597087d099d6f913f81daf478d6f370bdbf61c55.svg">
</div>
In positions where RHL expects variables (e.g. arguments of predicates or in equations), PHL allows also composed terms.
These composed terms are desugared into a fresh variable corresponding to the result of applying the function and an assertion about the graph of the function.</div>
<div class="paragraph">
The features of PHL allow implementing more algorithms than standard Datalog, for example congruence closure [<a href="#congruence-closure">4</a>], Steensgaard-style pointer analysis [<a href="#steensgard">3</a>] and Hindley-Milner type inference [<a href="#milner-inference">2</a>].
In each case, evaluation (which will be described in follow-up work) of the PHL theory encoding the problem domain yields the same algorithm as the standard domain-specific algorithm.
In general, we should expect problems that are typically solved by combining union-find data structures with fixed point computations to be instances of PHL evaluation.</div>
<div class="paragraph">
Partial Horn logic is one of the equivalent notions of <em>essentially algebraic theory</em>.
Essentially algebraic theories generalize the better-known algebraic theories of universal algebra by allowing functions to be partial.
Crucially, the <em>free model theorem</em> of universal algebra continues to hold also for essentially algebraic theories.
Free models are the basis of our semantics of PHL evaluation.
We show that free models can be computed using the <em>small object argument</em>, which we shall come to understand as an abstract generalization of Datalog evaluation.</div>
<div class="paragraph">
In brief, the relation of free models and Datalog evaluation can be understood for the transitivity Datalog program outlined above as follows.
We have seen that input data for this Datalog program represent certain graphs <img src="img-math/67aab7e97b6b2fa81588fb5e3abd361e6dc0f0b58a094ce23629d4f7f8811485.svg" class="inline-math">, while output data represent transitive graphs <img src="img-math/cfc46538d71060e5b3822dcf999541be3d337eb03cf6c2683e989043b8d5d7e9.svg" class="inline-math">.
The two graphs <img src="img-math/64ca379cf1c6924c8d37743a885e69f21e7591c2545042fa2acd48b58ce9cd51.svg" class="inline-math"> and <img src="img-math/c54af410a5779738e5c127baeef21447d2f18abc40392748d982a6ac9765b9c8.svg" class="inline-math"> share the same set of vertices <img src="img-math/097341643da03f834dcfc1c269e14dd1882b799fef693ffd387bad12e0df2571.svg" class="inline-math">, which is the set of constant symbols that appear in the set of input facts.
Intuitively, <img src="img-math/c54af410a5779738e5c127baeef21447d2f18abc40392748d982a6ac9765b9c8.svg" class="inline-math"> arises from <img src="img-math/64ca379cf1c6924c8d37743a885e69f21e7591c2545042fa2acd48b58ce9cd51.svg" class="inline-math"> by adding data that must exist due to the transitivity axiom but no more.</div>
<div class="paragraph">
Let us rephrase the relation between <img src="img-math/64ca379cf1c6924c8d37743a885e69f21e7591c2545042fa2acd48b58ce9cd51.svg" class="inline-math"> and <img src="img-math/c54af410a5779738e5c127baeef21447d2f18abc40392748d982a6ac9765b9c8.svg" class="inline-math"> using category theory.
Denote by <img src="img-math/cdc7384f95f41ea61ce998050a34d0e8aae0ce6e27287af9912c6fc5ec4637ba.svg" class="inline-math"> the category of graphs:
A morphism <img src="img-math/5e7d5b0dc20466b694914c290eca8e2971002de8599a61fdfa7776109f2e457b.svg" class="inline-math"> between graphs is a map <img src="img-math/8fd9c1c910fb9080c198c7584184e4e9925609530cdcb65da69d397a1e24a82b.svg" class="inline-math"> that preserves the edge relation.
Thus if <img src="img-math/54bea8132ecde9f4f13e8dd6d9abe4a02eb9c69cbb5b377064fc5f430beb4425.svg" class="inline-math">, then we must have <img src="img-math/e39841a1d4930e8edc13aa0ae868c2ffa60717c92d2cd113b53639d5fbac9038.svg" class="inline-math">.
The requirement that the output graph <img src="img-math/c54af410a5779738e5c127baeef21447d2f18abc40392748d982a6ac9765b9c8.svg" class="inline-math"> arises from the input <img src="img-math/64ca379cf1c6924c8d37743a885e69f21e7591c2545042fa2acd48b58ce9cd51.svg" class="inline-math"> solely by application of the transitivity sequent can now be summarized as follows:</div>
<div id="prop-free-transitive-graph" class="theorem-like theorem-style-theorem">
<div class="paragraph">
<h4>Proposition 1.
</h4>
Let <img src="img-math/cfc46538d71060e5b3822dcf999541be3d337eb03cf6c2683e989043b8d5d7e9.svg" class="inline-math"> be the output graph generated from evaluating the transitivity Datalog program on a finite input graph <img src="img-math/67aab7e97b6b2fa81588fb5e3abd361e6dc0f0b58a094ce23629d4f7f8811485.svg" class="inline-math">.
Then <img src="img-math/c54af410a5779738e5c127baeef21447d2f18abc40392748d982a6ac9765b9c8.svg" class="inline-math"> is the free transitive graph over <img src="img-math/64ca379cf1c6924c8d37743a885e69f21e7591c2545042fa2acd48b58ce9cd51.svg" class="inline-math">.</div>
</div>
<div class="proof">
<div class="paragraph">
<i class="proof">Proof.</i>
First we must exhibit a canonical graph morphism <img src="img-math/daf39aecb23eb2e221ef5a4e23e73e93d6a40dc54f583e09a5fd3881a02f24fd.svg" class="inline-math">.
As <img src="img-math/64ca379cf1c6924c8d37743a885e69f21e7591c2545042fa2acd48b58ce9cd51.svg" class="inline-math"> and <img src="img-math/c54af410a5779738e5c127baeef21447d2f18abc40392748d982a6ac9765b9c8.svg" class="inline-math"> share the same set of vertices, we choose <img src="img-math/4e46704448c6ba17ce04809324a4e90692e1307db12bbd8f3949405e2cf4795c.svg" class="inline-math"> simply as identity map on <img src="img-math/097341643da03f834dcfc1c269e14dd1882b799fef693ffd387bad12e0df2571.svg" class="inline-math">.
Note that the identity on <img src="img-math/097341643da03f834dcfc1c269e14dd1882b799fef693ffd387bad12e0df2571.svg" class="inline-math"> is indeed a graph morphism <img src="img-math/80f267ba1b589a80d35926beac80bd508a1c8d11c2a2518ab093b07a3954da02.svg" class="inline-math"> because <img src="img-math/637d92b78a98859a81075cfd936401bf136efac7cbff3433f0af0c8285400756.svg" class="inline-math">.</div>
<div class="paragraph">
Now we must show that for all graph morphisms <img src="img-math/c7e5d493ba1b44dfe4c9f9d5d860a1068715d9df168c3e1c7cf90aa2c5d4d3c4.svg" class="inline-math"> where <img src="img-math/a2acaa12748bd920e3b2525abbf6cede88bfbc2c6ea377aab775ba9450684870.svg" class="inline-math"> is a transitive graph, there exists a unique graph morphism <img src="img-math/74c442ec491d599881cecd493b8a7f3172e04e9c9162e00cfb96dc98c3e1d944.svg" class="inline-math"> such that the following triangle commutes:
<div class="display-math-row">
<img src="img-math/ae15e274445d09feb24f989dbb85d02e6ed7e096845e86677b54cb5e91d06c66.svg">
</div>
Because <img src="img-math/4e46704448c6ba17ce04809324a4e90692e1307db12bbd8f3949405e2cf4795c.svg" class="inline-math"> is the identity map, it suffices to show that <img src="img-math/53cb806dc6f3db23e3bb581250d3dcead1c4c1a42509fe50cc47f93e8d3a698d.svg" class="inline-math"> also defines a graph morphisms <img src="img-math/a7c67704674b96d005c6460a59e3dc6b3f0217411e68dab8f3f20dcba487155a.svg" class="inline-math">; uniqueness of <img src="img-math/3ac9675be6c0e312b76184b216f47bd95af3bc8c60c0dd273cadefb50dd492f3.svg" class="inline-math"> follows from surjectivity of <img src="img-math/4e46704448c6ba17ce04809324a4e90692e1307db12bbd8f3949405e2cf4795c.svg" class="inline-math">.
Recall that <img src="img-math/c54af410a5779738e5c127baeef21447d2f18abc40392748d982a6ac9765b9c8.svg" class="inline-math"> arises from repeatedly matching the premise of the transitivity axiom and adjoining its conclusion.
Thus there is a finite chain
<div class="display-math-row">
<img src="img-math/1f0eb6d2036dfec92a0203773bbc8f577fb0aea19496b69f90002b8f6714a20a.svg">
</div>
where for each <img src="img-math/d42d5862aea05b2fd7aa9c5bb07e9c13754585c17cee2cf95c36c2d9fc35ebeb.svg" class="inline-math"> there exist <img src="img-math/dda9720865810a386ee5d004d6242f96260a81ca64a46cd0be52ccab93523d63.svg" class="inline-math"> such that
<div id="eq-trans-graph-step" class="display-math-row">
<span>(1)</span>
<img src="img-math/14b068349adcc29eff82a34515c7513b664a4d94a930c80f805d6e7414c2157e.svg">
<span>(1)</span>
</div>
By induction, it suffices to show for all <img src="img-math/d42d5862aea05b2fd7aa9c5bb07e9c13754585c17cee2cf95c36c2d9fc35ebeb.svg" class="inline-math"> that <img src="img-math/f2738b187b384a32bc0ae64c168ec48b7bb1dcd95d507720952f97e1cfe178ee.svg" class="inline-math"> is a graph morphism <img src="img-math/f80a10e5e9c7033c4cb9e9a3fd272e59fb4a135de97ede302b55f31d35355b5c.svg" class="inline-math">, assuming that <img src="img-math/f2738b187b384a32bc0ae64c168ec48b7bb1dcd95d507720952f97e1cfe178ee.svg" class="inline-math"> is a graph morphisms <img src="img-math/ee6ff904a7fb593e5b7a2620db697c385ee4a78e7ea137440eef0d59009cfca6.svg" class="inline-math">.
Choose <img src="img-math/d3b0caae8196030bc8cd336acf50c16a11b2053c4c43b6e6340c31afa98e6798.svg" class="inline-math"> such that <img src="img-math/d7a1556e669b191777596b1fc29ac2dad56b595506c2697cabeaa84b7a0251b9.svg" class="inline-math"> and <a href="#eq-trans-graph-step">(1)</a> is satisfied.
Because <img src="img-math/f2738b187b384a32bc0ae64c168ec48b7bb1dcd95d507720952f97e1cfe178ee.svg" class="inline-math"> is a graph morphism <img src="img-math/30f1d3a8aac3fffb7d2993393fc07cebda87957af1c415e68d2f1dc7b7e3c00c.svg" class="inline-math">, we have <img src="img-math/3333692f32a570ca1be6401eb744a63046b8bdafb11fb25f8e4a1a648caa7e63.svg" class="inline-math">.
Because <img src="img-math/3d546c334e5a5b09fad223a0bf3a258e5dfcff5e4329762929ab5a7c0b4c31c7.svg" class="inline-math"> is transitive, it follows that <img src="img-math/810992becadab47a483aa6be04343bb9dddadfa50d27593b69dbb0905d3918f2.svg" class="inline-math">.
Thus <img src="img-math/f2738b187b384a32bc0ae64c168ec48b7bb1dcd95d507720952f97e1cfe178ee.svg" class="inline-math"> preserves the edge <img src="img-math/24537a2a7c6d2c78c6e97ebb7d08ad3976c37e128c11293c5bf0d9676ea48806.svg" class="inline-math"> and hence constitutes a graph morphism <img src="img-math/f80a10e5e9c7033c4cb9e9a3fd272e59fb4a135de97ede302b55f31d35355b5c.svg" class="inline-math">.</div>
</div>
<div class="paragraph">
Denote by <img src="img-math/7ccd0068751eb44de6bed150acbfc170dcc427dbd7b9e8b8bcaa5180b228cce8.svg" class="inline-math"> the full subcategory of <img src="img-math/cdc7384f95f41ea61ce998050a34d0e8aae0ce6e27287af9912c6fc5ec4637ba.svg" class="inline-math"> given by the transitive graphs.
The inclusion functor <img src="img-math/ad04d8e7abed1ab051b601880240a2f7cfd6d19d4f8afc6a21dcb4a99aeca130.svg" class="inline-math"> has a left adjoint, a <em>reflector</em>, which is given by assigning a graph to its transitive hull.
Thus Proposition <a href="#prop-free-transitive-graph">1</a> shows that the transitivity Datalog program computes the reflector.
Our primary goal in this paper is to explore and extend a semantics of PHL along these lines.</div>
<div class="paragraph">
<strong>Outline and Contributions.</strong>
In Section <a href="#sec-small-object-argument">2</a>, we review the <em>small object argument</em> [<a href="#hovey-model-categories">12</a>, Theorem 2.1.14] as a method of computing weak reflections into subcategories of injective objects.
We introduce <em>strong</em> classes of morphisms, for which the small object argument specializes to the <em>orthogonal-reflection construction</em> [<a href="#locally-presentable-and-accessible-categories">7</a>, Chapter 1.C].</div>
<div class="paragraph">
In Section <a href="#sec-rhl">3</a>, we introduce <em>relational Horn logic (RHL)</em>.
RHL extends Datalog with unbound variables, with variables that occur only in the conclusion, and with equations.
Input data of Datalog programs generalize to finite <em>relational structures</em>, and output data generalize to <em>models</em>, i.e. relational structures that satisfy all sequents.
We show that free models exist for <em>strong</em> RHL theories, which include all Datalog theories.</div>
<div class="paragraph">
Our poof of the existence of free models associates to each RHL sequent a <em>classifying morphism</em> of relational structures.
Satisfaction of the sequent can be characterized as lifting property against the classifying morphism.
The small object argument now shows the existence of free models for strong theories.
From this perspective, we may thus understand the small object argument as an abstract formulation of Datalog evaluation.</div>
<div class="paragraph">
In Section <a href="#sec-phl">4</a>, we extend RHL by function symbols to obtain <em>partial Horn logic (PHL)</em>.
By identifying each function symbol with a relation symbol representing its graph and adding a functionality axiom, every PHL theory gives rise to a relational Horn logic theory with equivalent semantics.
For <em>epic</em> PHL theories, where all variables must be introduced in the premise of a sequent, the associated RHL theory is strong.
Conversely, we show that the semantics of every strong RHL theory can be recovered as semantics of an epic PHL theory.
This justifies the usage of epic PHL as an equally powerful but syntactically better-behaved language compared to strong RHL.</div>
<div class="paragraph">
The results of this paper serve as semantics of <em>Eqlog</em>, a Datalog engine that computes free models of PHL theories.
Eqlog's algorithm is based on an efficient implementation of the small object argument that combines optimized Datalog evaluation (semi-naive evaluation and indices) with techniques used in congruence closure algorithms.
Independently of Eqlog and the work presented there, members of the Egg [<a href="#egg">13</a>] community have created the <em>Egglog</em> tool, which combines Datalog with e-graphs and is based on very similar ideas as those of Eqlog.</div>
<h2 id="sec-small-object-argument">
2 The Small Object Argument</h2>
<div class="paragraph">
This section is a review of the small object argument, which we shall in later sections come to understand as an abstract description of Datalog evaluation.
The concepts we discuss here are not new and are in fact widely known among homotopy theorists; see for example [<a href="#locally-presentable-and-accessible-categories">7</a>] for a standard exposition.
A minor innovation is our consideration of <em>strong</em> sets:
Sets of morphisms for which injectivity coincides with orthogonality.
For strong sets, the small object argument yields a reflection into the orthogonal subcategory where in general we would obtain only a weak reflection into the injective subcategory.</div>
<div class="paragraph">
The related <em>orthogonal-reflection construction</em> [<a href="#locally-presentable-and-accessible-categories">7</a>, Chapter 1.C] produces a reflection into the orthogonal subcategory for arbitrary sets of morphisms <img src="img-math/33f0af6adb082f260ea68be9c97080c9a6c235a7dab602edf2e620f833b4a5e9.svg" class="inline-math">.
We show that every set of morphism <img src="img-math/33f0af6adb082f260ea68be9c97080c9a6c235a7dab602edf2e620f833b4a5e9.svg" class="inline-math"> can be extended to a strong set <img src="img-math/c5799ea52b08e42b5b204ac3525a050e838549f4aca1c418cbfd67898971c734.svg" class="inline-math"> such that <img src="img-math/33f0af6adb082f260ea68be9c97080c9a6c235a7dab602edf2e620f833b4a5e9.svg" class="inline-math"> and <img src="img-math/c5799ea52b08e42b5b204ac3525a050e838549f4aca1c418cbfd67898971c734.svg" class="inline-math"> induce the same orthogonality class.
The small object argument for <img src="img-math/c5799ea52b08e42b5b204ac3525a050e838549f4aca1c418cbfd67898971c734.svg" class="inline-math"> now specializes to the orthogonal-reflection construction for <img src="img-math/33f0af6adb082f260ea68be9c97080c9a6c235a7dab602edf2e620f833b4a5e9.svg" class="inline-math">.
Thus, the concept of strong morphisms can be used to understand the orthogonal-reflection construction as a specialized variation of the small object argument.</div>
<div class="paragraph">
Fix a cocomplete category locally small <img src="img-math/dc523e12504d2f9a179ee90b400d2e5b29b05d6ee1e496dda0eed156a4ef0a2c.svg" class="inline-math"> for the remainder of this section.
We reserve the word <em>set</em> for a small set, while a <em>class</em> refers to a set in a larger set-theoretic universe that contains the collection of objects in <img src="img-math/dc523e12504d2f9a179ee90b400d2e5b29b05d6ee1e496dda0eed156a4ef0a2c.svg" class="inline-math">.
All colimits of set-indexed diagrams in <img src="img-math/dc523e12504d2f9a179ee90b400d2e5b29b05d6ee1e496dda0eed156a4ef0a2c.svg" class="inline-math"> exist, while colimits of class-indexed diagrams need not exist.</div>
<div class="theorem-like theorem-style-definition">
<div class="paragraph">
<h4>Definition 2.
</h4>
Let <img src="img-math/ce45e690d14c519d518a69b5d8fbeef4fc1bdb717fda749b3ce014728cb1807c.svg" class="inline-math"> be a morphism and let <img src="img-math/058a0e00a68e1131c9aa4f8bd9d0e56f03e14180114befecf4eccfefb05fb83d.svg" class="inline-math"> be an object.
We write <img src="img-math/3cedcf4e63f7a73a74c92d89ccc30661f06b55b796fd9c1ccb03344837c0c648.svg" class="inline-math"> and say that <img src="img-math/058a0e00a68e1131c9aa4f8bd9d0e56f03e14180114befecf4eccfefb05fb83d.svg" class="inline-math"> is <em>injective</em> to <img src="img-math/f2738b187b384a32bc0ae64c168ec48b7bb1dcd95d507720952f97e1cfe178ee.svg" class="inline-math"> if for all maps <img src="img-math/f9235f639041ac55d215ed1756a6e7007fbe34e0b578cde3074070458cd02a7c.svg" class="inline-math"> there exists a map <img src="img-math/ab5b23f5746293b4150563396d8bd140fa7bddf5de1c81447ea22967b4f0e559.svg" class="inline-math"> such that
<div class="display-math-row">
<img src="img-math/c37e19a518c9eacec795bf480cd8117c52abb61e7299077ebf8c49ff3e8f8dc6.svg">
</div>
commutes.
If furthermore <img src="img-math/45ba21d96a2b4e186f8fd82018b8419f30aef974b138b989b17f0ef42b7c1d40.svg" class="inline-math"> is unique for all <img src="img-math/a4bd19b1cdf1d5d5f761239964ebfba12682d12ccb248fe4b410276067940e15.svg" class="inline-math">, then we write <img src="img-math/fb03b7ef9f34195fd5aba53b1254e9e792efa251c3459d2df978b24a20554cc2.svg" class="inline-math"> and say that <img src="img-math/058a0e00a68e1131c9aa4f8bd9d0e56f03e14180114befecf4eccfefb05fb83d.svg" class="inline-math"> is <em>orthogonal</em> to <img src="img-math/f2738b187b384a32bc0ae64c168ec48b7bb1dcd95d507720952f97e1cfe178ee.svg" class="inline-math">.</div>
<div class="paragraph">
If <img src="img-math/33f0af6adb082f260ea68be9c97080c9a6c235a7dab602edf2e620f833b4a5e9.svg" class="inline-math"> is a class of morphisms, then we write <img src="img-math/421f88aed95142bd55d9e52b9a58744bd92f2c9c7cf0d2fef13cde2f3a00ec9b.svg" class="inline-math"> if <img src="img-math/3cedcf4e63f7a73a74c92d89ccc30661f06b55b796fd9c1ccb03344837c0c648.svg" class="inline-math"> for all <img src="img-math/2fd063497aef0a0dba32f898a9db6b8b466abece1bdc0814993b55273c55d399.svg" class="inline-math">, and <img src="img-math/ee8f3ef61d4b4d28fe6d287cc6b13fabaf97f460129eac6422a4e93da2c540a0.svg" class="inline-math"> if <img src="img-math/fb03b7ef9f34195fd5aba53b1254e9e792efa251c3459d2df978b24a20554cc2.svg" class="inline-math"> for all <img src="img-math/2fd063497aef0a0dba32f898a9db6b8b466abece1bdc0814993b55273c55d399.svg" class="inline-math">.
The full subcategories given by the injective and orthogonal objects, respectively, are denoted by <img src="img-math/00b0c6579ea555a95618595a9fc59c54224cda841d202964e8bc06af3c218455.svg" class="inline-math"> and <img src="img-math/e6dad0925b8a4a15da0c3b9e68ab23258014b3f75d1b2319f935206c98eac23c.svg" class="inline-math">.
We call <img src="img-math/00b0c6579ea555a95618595a9fc59c54224cda841d202964e8bc06af3c218455.svg" class="inline-math"> the <em>injectivity class</em> of <img src="img-math/33f0af6adb082f260ea68be9c97080c9a6c235a7dab602edf2e620f833b4a5e9.svg" class="inline-math"> and <img src="img-math/e6dad0925b8a4a15da0c3b9e68ab23258014b3f75d1b2319f935206c98eac23c.svg" class="inline-math"> the <em>orthogonality class</em> of <img src="img-math/33f0af6adb082f260ea68be9c97080c9a6c235a7dab602edf2e620f833b4a5e9.svg" class="inline-math">.</div>
</div>
<div id="def-strong" class="theorem-like theorem-style-definition">
<div class="paragraph">
<h4>Definition 3.
</h4>
A class <img src="img-math/33f0af6adb082f260ea68be9c97080c9a6c235a7dab602edf2e620f833b4a5e9.svg" class="inline-math"> of morphisms is called <em>strong</em>  if <img src="img-math/af595a9c3b1bd077b038c479670e7c2f7983cfce70a96cfffa570de14bfee87c.svg" class="inline-math">.</div>
</div>
<div class="paragraph">
One of the main sources of strong sets is the following proposition:</div>
<div id="prop-epi-strong" class="theorem-like theorem-style-theorem">
<div class="paragraph">
<h4>Proposition 4.
</h4>
Let <img src="img-math/33f0af6adb082f260ea68be9c97080c9a6c235a7dab602edf2e620f833b4a5e9.svg" class="inline-math"> be a class of epimorphisms.
Then <img src="img-math/33f0af6adb082f260ea68be9c97080c9a6c235a7dab602edf2e620f833b4a5e9.svg" class="inline-math"> is strong.
</div>
</div>
<div class="proof">
<div class="paragraph">
<i class="proof">Proof.</i>
This follows immediately from right-cancellation.</div>
</div>
<div class="paragraph">
Another source of strong sets is the following proposition.
It lets us reduce questions about orthogonality classes to strong injectivity classes.</div>
<div id="prop-strongbization" class="theorem-like theorem-style-theorem">
<div class="paragraph">
<h4>Proposition 5.
</h4>
Let <img src="img-math/33f0af6adb082f260ea68be9c97080c9a6c235a7dab602edf2e620f833b4a5e9.svg" class="inline-math"> be a class of morphisms.
Then there exists a superclass <img src="img-math/b78f0648c6c34ce92419435ab312536183954fdde085350dc62a3be82f3ed7a6.svg" class="inline-math"> such that <img src="img-math/c5799ea52b08e42b5b204ac3525a050e838549f4aca1c418cbfd67898971c734.svg" class="inline-math"> is strong and <img src="img-math/43ead473f40b488f49ea87fa42d843382451625ad2c58c67c3cb022655b38249.svg" class="inline-math">.
If <img src="img-math/33f0af6adb082f260ea68be9c97080c9a6c235a7dab602edf2e620f833b4a5e9.svg" class="inline-math"> is a set, then <img src="img-math/c5799ea52b08e42b5b204ac3525a050e838549f4aca1c418cbfd67898971c734.svg" class="inline-math"> can be chosen as set.</div>
</div>
<div class="proof">
<div class="paragraph">
<i class="proof">Proof.</i>
Let <img src="img-math/ce45e690d14c519d518a69b5d8fbeef4fc1bdb717fda749b3ce014728cb1807c.svg" class="inline-math"> be a morphism in <img src="img-math/33f0af6adb082f260ea68be9c97080c9a6c235a7dab602edf2e620f833b4a5e9.svg" class="inline-math">.
Then for each object <img src="img-math/058a0e00a68e1131c9aa4f8bd9d0e56f03e14180114befecf4eccfefb05fb83d.svg" class="inline-math">, the data of a single map <img src="img-math/f9235f639041ac55d215ed1756a6e7007fbe34e0b578cde3074070458cd02a7c.svg" class="inline-math"> and two maps <img src="img-math/8b6c19807f13edcdbadd113b72d1964a59e246ec1100d3663b984eb048489473.svg" class="inline-math"> such that
<div class="display-math-row">
<img src="img-math/5f759253d6425c7be5932af5cd5781e03475c3044ca241889a63ee51b9848c84.svg">
</div>
commutes for <img src="img-math/78d88ab59b5faf861fff807ffcbd675c2d8011e189a327bb79ab95c72ae354d9.svg" class="inline-math"> is in bijective correspondence to a map <img src="img-math/ef939a68e076b173b48e276fa86754cf092ec04dc0c0217dcdb0ee2e0dcfcd8b.svg" class="inline-math">.
Let
<div class="display-math-row">
<img src="img-math/cd603554fa2249038e44c02d48b67880dddab9099e363b1e648d9681fd9e801a.svg">
</div>
be the canonical map that collapses the two copies of <img src="img-math/d86feac55d82bcc77c1cc615c0236fbd0d614da286d7046334827cfc5912fc12.svg" class="inline-math"> into one.
Then <img src="img-math/5ac51754d98c4d3949bb78b440518c887d714a6fb2c12425e99fb79c3cc8c437.svg" class="inline-math"> if and only if there exists a map <img src="img-math/45ba21d96a2b4e186f8fd82018b8419f30aef974b138b989b17f0ef42b7c1d40.svg" class="inline-math"> such that
<div class="display-math-row">
<img src="img-math/4a89ddc5e8ad45d6b4878e75804fb014327343bfc475a1a51854b6b7d74e25c5.svg">
</div>
commutes.
The map <img src="img-math/2c9a7e34137571c0b17918217b03b9bdc0aaa1d58b32caaf46e2bbdb6c6dd819.svg" class="inline-math"> is an epimorphism.
Thus if <img src="img-math/45ba21d96a2b4e186f8fd82018b8419f30aef974b138b989b17f0ef42b7c1d40.svg" class="inline-math"> exists, then it exists uniquely, and <img src="img-math/66175941bc11bf1328e68a35281072da38583989414bbfa288f12880351fc93e.svg" class="inline-math">.
It follows that <img src="img-math/058a0e00a68e1131c9aa4f8bd9d0e56f03e14180114befecf4eccfefb05fb83d.svg" class="inline-math"> is orthogonal to <img src="img-math/f2738b187b384a32bc0ae64c168ec48b7bb1dcd95d507720952f97e1cfe178ee.svg" class="inline-math"> if and only if <img src="img-math/f2738b187b384a32bc0ae64c168ec48b7bb1dcd95d507720952f97e1cfe178ee.svg" class="inline-math"> is injective to both <img src="img-math/f2738b187b384a32bc0ae64c168ec48b7bb1dcd95d507720952f97e1cfe178ee.svg" class="inline-math"> and <img src="img-math/2c9a7e34137571c0b17918217b03b9bdc0aaa1d58b32caaf46e2bbdb6c6dd819.svg" class="inline-math">.
The desired class <img src="img-math/c5799ea52b08e42b5b204ac3525a050e838549f4aca1c418cbfd67898971c734.svg" class="inline-math"> can thus be defined by <img src="img-math/c874b6412bfc1a1a61910970cba40fc7556c837c6b026684db3e0d8a7673b66e.svg" class="inline-math">.</div>
</div>
<div class="theorem-like theorem-style-definition">
<div class="paragraph">
<h4>Definition 6.
</h4>
A <em>sequence</em> of morphisms is a diagram of the form
<div class="display-math-row">
<img src="img-math/98e981a227a342a4c694d2ad1f65c7b1e08e5a8ff771f3a2f242590915532214.svg">
</div>
for a countable set <img src="img-math/421cecb7d2a6913432f9ac6e31d536cf88025e1b4e143fed8b8e261f2ef50050.svg" class="inline-math"> of morphisms.
The <em>composition</em> of a sequence of morphisms <img src="img-math/421cecb7d2a6913432f9ac6e31d536cf88025e1b4e143fed8b8e261f2ef50050.svg" class="inline-math"> is the canonical map
<div class="display-math-row">
<img src="img-math/b8bc1f6515b2cc4647252c58ba7a6af1ec9ba61cf6d06784b1a26be8feb88e41.svg">
</div>
to the colimit of the sequence.</div>
</div>
<div class="paragraph">
Note that the composition of a sequence of morphisms is uniquely determined only up to a choice of colimit.</div>
<div id="def-relative-cell-complex" class="theorem-like theorem-style-definition">
<div class="paragraph">
<h4>Definition 7.
</h4>
Let <img src="img-math/33f0af6adb082f260ea68be9c97080c9a6c235a7dab602edf2e620f833b4a5e9.svg" class="inline-math"> be a class of morphisms.
The class <img src="img-math/a603ba9c120beeb4cc13d75afd4bffb964f013db497ed642147503edd36cd7b5.svg" class="inline-math"> of <em>relative <img src="img-math/33f0af6adb082f260ea68be9c97080c9a6c235a7dab602edf2e620f833b4a5e9.svg" class="inline-math">-cell complexes</em> is the least class of morphisms such that the following closure properties hold:
<ol>
<li id="itm-cell-base">
<div class="paragraph">
<img src="img-math/5cc83c28f622c8078e9a7d14a3d1cb6d2753b61cb94b19f3027d75f989fab2e9.svg" class="inline-math">.</div>
</li>
<li id="itm-cell-coproduct">
<div class="paragraph">
<img src="img-math/a603ba9c120beeb4cc13d75afd4bffb964f013db497ed642147503edd36cd7b5.svg" class="inline-math"> is closed under coproducts.
That is, if <img src="img-math/076b00f6793e3144bd78d89af90d8dba6bb557296284a1f0fb3c493e26322acf.svg" class="inline-math"> is a family of morphisms indexed by some set <img src="img-math/f6cf97bfa9e50ab18203d10ce01677a20c00e3c84b54146a8e4d73ea55dc8db9.svg" class="inline-math"> and <img src="img-math/6c089b709fc8890d88a410b95d2cca0eee76bb8459286fbef851f7c15c9fca41.svg" class="inline-math"> for all <img src="img-math/93a736e3b4f8ef8bdefbb35f8b56965472337fbbca51b561228031e38798409c.svg" class="inline-math">, then
<div class="display-math-row">
<img src="img-math/9e210782a36d57f11039dfeb14b4e6e3b9f0aa9d66bc40377dd5cff84d6070dd.svg">
</div>
is in <img src="img-math/a603ba9c120beeb4cc13d75afd4bffb964f013db497ed642147503edd36cd7b5.svg" class="inline-math">.</div>
</li>
<li id="itm-cell-pushout">
<div class="paragraph">
<img src="img-math/a603ba9c120beeb4cc13d75afd4bffb964f013db497ed642147503edd36cd7b5.svg" class="inline-math"> is closed under pushouts.
That is, if
<div class="display-math-row">
<img src="img-math/b2d4b1ca3b3ee8fbda23880348dff5069e8a6e599511391dba9ff483350ccd57.svg">
</div>
is a pushout square and <img src="img-math/f18f92d3d4e7fa06e36cb45732f7ddc959707c56c35523cbebfd1abd90995312.svg" class="inline-math">, then <img src="img-math/9c271765f47f5288ce1403df8835b145c7dcb177be4cf1a2fe8de8221fc7bb4e.svg" class="inline-math">.</div>
</li>
<li id="itm-cell-composition">
<div class="paragraph">
<img src="img-math/a603ba9c120beeb4cc13d75afd4bffb964f013db497ed642147503edd36cd7b5.svg" class="inline-math"> is closed under composition of sequences.
That is, if
<div class="display-math-row">
<img src="img-math/3c05929a10cbfbcc085528603ebbe822717eedfd8534b3d08562da4fb9c49e56.svg">
</div>
is a sequence of morphisms <img src="img-math/b600807ca169b285c10a65efc222ea95f41375c43d991f88ff06858337c363e1.svg" class="inline-math"> with composition <img src="img-math/91e2fd82a31097cef46323cb3e2d173854839e5bc500444ec0414889bbc3096a.svg" class="inline-math">, then <img src="img-math/f18f92d3d4e7fa06e36cb45732f7ddc959707c56c35523cbebfd1abd90995312.svg" class="inline-math">.</div>
</li>
</ol>
</div>
</div>
<div id="rem-iterative-flattening" class="theorem-like theorem-style-remark">
<div class="paragraph">
<h4>Remark 8.
</h4>
Standard literature on factorization systems and the closely related small object argument [<a href="#hovey-model-categories">12</a>] considers usually not only countable sequences of morphisms but also arbitrary transfinite sequences, which are chains of morphisms indexed by an arbitrary ordinal number.
In this more general setting, one then typically defines a relative <img src="img-math/33f0af6adb082f260ea68be9c97080c9a6c235a7dab602edf2e620f833b4a5e9.svg" class="inline-math">-cell complex to be a transfinite composition of pushouts of morphisms in <img src="img-math/33f0af6adb082f260ea68be9c97080c9a6c235a7dab602edf2e620f833b4a5e9.svg" class="inline-math"> without mention of coproducts.</div>
<div class="paragraph">
This more common notion of relative <img src="img-math/33f0af6adb082f260ea68be9c97080c9a6c235a7dab602edf2e620f833b4a5e9.svg" class="inline-math">-cell complex satisfies our closure properties <a href="#itm-cell-base">1</a> -- <a href="#itm-cell-composition">4</a>.
For <a href="#itm-cell-coproduct">2</a>, one chooses a well-ordering on the indexing set <img src="img-math/f6cf97bfa9e50ab18203d10ce01677a20c00e3c84b54146a8e4d73ea55dc8db9.svg" class="inline-math">, and then computes the coproduct as composition of a chain indexed by this well-ordering.
Conversely, our definition of relative <img src="img-math/33f0af6adb082f260ea68be9c97080c9a6c235a7dab602edf2e620f833b4a5e9.svg" class="inline-math">-cell complex is closed under arbitrary transfinite composition if all morphism in <img src="img-math/33f0af6adb082f260ea68be9c97080c9a6c235a7dab602edf2e620f833b4a5e9.svg" class="inline-math"> have finitely presentable domains and codomains (Definition <a href="#def-finitely-presentable">14</a>).
Thus, whenever the domains and codomains of the morphisms in <img src="img-math/33f0af6adb082f260ea68be9c97080c9a6c235a7dab602edf2e620f833b4a5e9.svg" class="inline-math"> are finitely presentable, the definition given here and the usual one agree.</div>
</div>
<div id="prop-iterative-relative-cell-complexes" class="theorem-like theorem-style-theorem">
<div class="paragraph">
<h4>Proposition 9.
</h4>
Let <img src="img-math/33f0af6adb082f260ea68be9c97080c9a6c235a7dab602edf2e620f833b4a5e9.svg" class="inline-math"> be a class of morphisms.
Define classes of morphisms <img src="img-math/ff47aa35da38ce9636b4045ea471d81142dac73c53d40fe6e0250b310eb78613.svg" class="inline-math"> as follows:
<div class="display-math-row">
<img src="img-math/7e0eed2200fd5ae4947058120c0c215c3b0014b1d5d44241730969810500e895.svg">
</div>
Then <img src="img-math/a6d8f46fb1c6fb703550150db669dc0ed76ca58fc8c4bd861c144b1e6e7105db.svg" class="inline-math">.</div>
</div>
<div class="proof">
<div class="paragraph">
<i class="proof">Proof.</i>
Coproducts, pushouts and compositions of sequences are all defined via colimits.
Because colimits commute with colimits, <img src="img-math/d8c177b04f2f9eb6b9538a884664508a6cc114b5fb30db229fe6deae123f55f0.svg" class="inline-math"> is closed under coproducts, pushouts and compositions of sequences.
It follows that <img src="img-math/99cdcd1e3c5d7e3fe10e97146171465e80a4b56168f83ae3ff5708b8de0ad633.svg" class="inline-math">, hence <img src="img-math/4954c048391d9162a1abb9b309f5ac4c900cbd7b7380f30a8cbc27e5e715f562.svg" class="inline-math">.</div>
</div>
<div class="theorem-like theorem-style-theorem">
<div class="paragraph">
<h4>Proposition 10.
</h4>
Let <img src="img-math/33f0af6adb082f260ea68be9c97080c9a6c235a7dab602edf2e620f833b4a5e9.svg" class="inline-math"> be a class of morphisms.
Then <img src="img-math/a48ed3661ae587361ab5edd222dfad4f80945d8c6473fa5bc1754064a03d8f41.svg" class="inline-math"> and <img src="img-math/83b0594e964697306711c0c43ad2e42a54d4f6b4b222c4898bf129cb2f38d00b.svg" class="inline-math">.</div>
</div>
<div class="proof">
<div class="paragraph">
<i class="proof">Proof.</i>
If <img src="img-math/a21dcda0e00655a9de4fbb1f86490930847770acb4ce0703cb499ac5fbd0e1da.svg" class="inline-math"> is an inclusion of classes of morphisms, then in general <img src="img-math/35cac02a9f73efa192aafc5cb05bc6310a2788c255bfb167e9d8a38e2b450b63.svg" class="inline-math"> and <img src="img-math/ee38137af9eeeb186c23ea03cd2fcf0c78e7d1dfb559a73e2e148ed1020ae2a4.svg" class="inline-math">.
This proves the inclusions <img src="img-math/e1e99935c71bdc6f2e34b48b4e75291363f5f33f96f5372459c8a96ac8c06ed3.svg" class="inline-math">.</div>
<div class="paragraph">
Conversely, it suffices to show for <img src="img-math/830a0046dd42785066fc1ae64c21a0cc561662c05982ff9633f114990af69f55.svg" class="inline-math"> that the class
<div class="display-math-row">
<img src="img-math/706c784bb23d0e3a866e069281a08ac613db2474535bb10bc3d93a46eba9ca78.svg">
</div>
satisfies the closure properties <a href="#itm-cell-base">1</a> -- <a href="#itm-cell-composition">4</a> of Definition <a href="#def-relative-cell-complex">7</a>, and similarly for orthogonality.
This is routine.
For example, closure under pushouts can be proved as follows.
Let <img src="img-math/058a0e00a68e1131c9aa4f8bd9d0e56f03e14180114befecf4eccfefb05fb83d.svg" class="inline-math"> be injective (orthogonal) to <img src="img-math/ce45e690d14c519d518a69b5d8fbeef4fc1bdb717fda749b3ce014728cb1807c.svg" class="inline-math">, let <img src="img-math/11258277383e545d67b0df7bb6194e860127365deca275b60c6f1d451e1a3dc1.svg" class="inline-math"> be a pushout of <img src="img-math/f2738b187b384a32bc0ae64c168ec48b7bb1dcd95d507720952f97e1cfe178ee.svg" class="inline-math">, and let <img src="img-math/37052c23e66971b4ab2dda1d7300747341f5db91814e4d0448464fcccd0b108e.svg" class="inline-math"> be an arbitrary morphism.
The lift <img src="img-math/2add8feed0cbb96594501c717059a7159215e8b4e95da266b2af248fa41410a9.svg" class="inline-math"> can then be obtained from a lift <img src="img-math/4a23876b36f4883e1801158a16554c93ad19197982c76286ce66c95a7ba9f873.svg" class="inline-math"> and the universal property of the pushout in the following diagram:
<div class="display-math-row">
<img src="img-math/3f63e6039a860eff215a01251c8640d9db38dad7af37520f4408052bda25b3bf.svg">
</div>
If the lift <img src="img-math/4a23876b36f4883e1801158a16554c93ad19197982c76286ce66c95a7ba9f873.svg" class="inline-math"> is unique, then also <img src="img-math/2add8feed0cbb96594501c717059a7159215e8b4e95da266b2af248fa41410a9.svg" class="inline-math"> is unique by uniqueness of the morphism induced by the universal property of the pushout.</div>
</div>
<div id="def-reflection" class="theorem-like theorem-style-definition">
<div class="paragraph">
<h4>Definition 11.
</h4>
Let <img src="img-math/86eda87a5505867f56e3379438df6c36dfe57740343f59c5f1b3302f62fe1389.svg" class="inline-math"> be a full subcategory.
A <em>weak reflection</em> of an object <img src="img-math/c9a48f8af60d372deb39eb911f1b01485b220c3d72bb3dd5dbc5df987d0683c8.svg" class="inline-math"> is a map <img src="img-math/1e97c5a8e4f83875ee9524f9be28415fe4fb1c66032516c984ff25cfa69caec5.svg" class="inline-math"> such that <img src="img-math/c8dadf3961411845135572d915d2024d9a90f0ff35ad368485de5902a20e4d32.svg" class="inline-math"> and every map <img src="img-math/9a9555b00a2e9e38c0fc318528b8cda749c39320d3515f25aa9126a990ba8107.svg" class="inline-math"> with <img src="img-math/3ad63d320c5ca79a8cd3c33d9d340c18d8c4699105fe18fe6dca383707df0aff.svg" class="inline-math"> factors via <img src="img-math/4e46704448c6ba17ce04809324a4e90692e1307db12bbd8f3949405e2cf4795c.svg" class="inline-math">.
If the factorization is unique for all <img src="img-math/9a9555b00a2e9e38c0fc318528b8cda749c39320d3515f25aa9126a990ba8107.svg" class="inline-math">, then <img src="img-math/4e46704448c6ba17ce04809324a4e90692e1307db12bbd8f3949405e2cf4795c.svg" class="inline-math"> is a <em>reflection</em>.
A <em>(weak) reflector</em> consists of a functor <img src="img-math/12315b434217e1b43a1f23386e1ae895dabc38d955d23570b23d61cd253806a6.svg" class="inline-math"> and a natural transformation <img src="img-math/e463f1364a55a32d8419edf003c61c429e456b33ca4cb5b7dca3f72d37743c71.svg" class="inline-math"> such that <img src="img-math/a758955eacfdf2fc8f07f2bf539690ccdf317e1a79f56798ce06a1a4529db64e.svg" class="inline-math"> is a (weak) reflection for all <img src="img-math/c9a48f8af60d372deb39eb911f1b01485b220c3d72bb3dd5dbc5df987d0683c8.svg" class="inline-math">.
The subcategory <img src="img-math/f51e1e3e2eb72c54fc9c2b2e4fc147df9af16693bd46879e8943cb36beef5750.svg" class="inline-math"> is <em>(weakly) reflective</em> in <img src="img-math/dc523e12504d2f9a179ee90b400d2e5b29b05d6ee1e496dda0eed156a4ef0a2c.svg" class="inline-math"> if there exists a (weak) reflector.</div>
</div>
<div id="prop-factoring-via-cell-complexes" class="theorem-like theorem-style-theorem">
<div class="paragraph">
<h4>Proposition 12.
</h4>
Let <img src="img-math/33f0af6adb082f260ea68be9c97080c9a6c235a7dab602edf2e620f833b4a5e9.svg" class="inline-math"> be a class of morphisms.
Let <img src="img-math/48066c92e9c1389e9d01471a09b3377bc1b8af0ac5cb934e689031d4b7e0b765.svg" class="inline-math"> be a relative <img src="img-math/33f0af6adb082f260ea68be9c97080c9a6c235a7dab602edf2e620f833b4a5e9.svg" class="inline-math">-cell complex, and let <img src="img-math/34aeb4e77cbf9ab9ed6b6eecfdee8e5d3d3b25079ebc0acf324c8efe4568ea36.svg" class="inline-math"> be a map with <img src="img-math/f786ed98baec0b0948cca6c76ea5b867d310abc204078c0fc3011882f7c309c7.svg" class="inline-math">.
Then there is a map <img src="img-math/34fdba4817ce62d83598229f2e13d0b9b754e08893f6596f35f73ea0e0d27901.svg" class="inline-math"> such that <img src="img-math/6ad03f10ce73834e82c4ccd40041410b120c41e3bc38424f9e6db55afc4058a5.svg" class="inline-math">.
If furthermore <img src="img-math/33f0af6adb082f260ea68be9c97080c9a6c235a7dab602edf2e620f833b4a5e9.svg" class="inline-math"> is strong, then <img src="img-math/a377d23a5d42b7385429fc05b94bb6baf3dc6e993286ea1099d657ce9f31543e.svg" class="inline-math"> is unique.</div>
</div>
<div class="proof">
<div class="paragraph">
<i class="proof">Proof.</i>
This follows from the fact that the class of morphisms <img src="img-math/f2738b187b384a32bc0ae64c168ec48b7bb1dcd95d507720952f97e1cfe178ee.svg" class="inline-math"> for which the lemma holds satisfies properties <a href="#itm-cell-base">1</a> -- <a href="#itm-cell-composition">4</a> of Definition <a href="#def-relative-cell-complex">7</a>.</div>
</div>
<div id="prop-relative-m-cell-complex-is-reflection" class="theorem-like theorem-style-theorem">
<div class="paragraph">
<h4>Proposition 13.
</h4>
Let <img src="img-math/33f0af6adb082f260ea68be9c97080c9a6c235a7dab602edf2e620f833b4a5e9.svg" class="inline-math"> be a class of morphisms.
Let <img src="img-math/48066c92e9c1389e9d01471a09b3377bc1b8af0ac5cb934e689031d4b7e0b765.svg" class="inline-math"> be a relative <img src="img-math/33f0af6adb082f260ea68be9c97080c9a6c235a7dab602edf2e620f833b4a5e9.svg" class="inline-math">-cell complex such that <img src="img-math/b478a8a39553afb5e30c8ccfcce564674b25735249d139633ad48cf5bea27144.svg" class="inline-math">.
Then <img src="img-math/f2738b187b384a32bc0ae64c168ec48b7bb1dcd95d507720952f97e1cfe178ee.svg" class="inline-math"> is a weak reflection into <img src="img-math/00b0c6579ea555a95618595a9fc59c54224cda841d202964e8bc06af3c218455.svg" class="inline-math">.
If <img src="img-math/33f0af6adb082f260ea68be9c97080c9a6c235a7dab602edf2e620f833b4a5e9.svg" class="inline-math"> is strong, then <img src="img-math/f2738b187b384a32bc0ae64c168ec48b7bb1dcd95d507720952f97e1cfe178ee.svg" class="inline-math"> is a reflection.</div>
</div>
<div class="proof">
<div class="paragraph">
<i class="proof">Proof.</i>
By Proposition <a href="#prop-factoring-via-cell-complexes">12</a>.</div>
</div>
<div id="def-finitely-presentable" class="theorem-like theorem-style-definition">
<div class="paragraph">
<h4>Definition 14.
</h4>
An object <img src="img-math/058a0e00a68e1131c9aa4f8bd9d0e56f03e14180114befecf4eccfefb05fb83d.svg" class="inline-math"> is <em>finitely presentable</em> if the hom-functor <img src="img-math/ea3a6034f8d95edbfca288764d3f191d282109f248bbd8cf4549c192a520987d.svg" class="inline-math"> preserves filtered colimits.</div>
</div>
<div id="prop-small-object-argument-prop" class="theorem-like theorem-style-theorem">
<div class="paragraph">
<h4>Proposition 15 <span class="theorem-note">(Small Object Argument: Property)</span>.
</h4>
Let <img src="img-math/33f0af6adb082f260ea68be9c97080c9a6c235a7dab602edf2e620f833b4a5e9.svg" class="inline-math"> be a class of morphisms with finitely presentable domains and codomains.
Let
<div class="display-math-row">
<img src="img-math/6699194b9b41acb2612e24f5ce61456efc1d521444765ee816011d8fbd9edf0f.svg">
</div>
be a sequence in <img src="img-math/33f0af6adb082f260ea68be9c97080c9a6c235a7dab602edf2e620f833b4a5e9.svg" class="inline-math"> such that the following holds:
<ol>
<li>
<div class="paragraph">
<img src="img-math/41a98b302dc8d6b3ff252a20c42d9845cdb7664b552cff13b695f1e751e1836e.svg" class="inline-math"> is a relative <img src="img-math/33f0af6adb082f260ea68be9c97080c9a6c235a7dab602edf2e620f833b4a5e9.svg" class="inline-math">-cell complex for all <img src="img-math/509fe7e8ba852248c1de4dfc8c752f04a501aa15dc740f89268b2dd4cb0e9155.svg" class="inline-math">.</div>
</li>
<li id="itm-m-factorizations-exist">
<div class="paragraph">
For all <img src="img-math/ce45e690d14c519d518a69b5d8fbeef4fc1bdb717fda749b3ce014728cb1807c.svg" class="inline-math"> in <img src="img-math/33f0af6adb082f260ea68be9c97080c9a6c235a7dab602edf2e620f833b4a5e9.svg" class="inline-math">, <img src="img-math/282b49edc6a3215d6076dede282ec3a4bfc2f2be9b6367b3f30e86ac2e4bc42d.svg" class="inline-math"> and maps <img src="img-math/31f379fb3aa4cc10ce18a0f6b4984141bdd622805b6e28dae277cd90ba86fd40.svg" class="inline-math">, there exists a map a map <img src="img-math/1b6f8217041e46cf12904d3220aa98fe982a64c753818c0765f30f6407afd030.svg" class="inline-math"> for some <img src="img-math/4bba9a8ed78658e911a9a42ca7c20e58162e4bd2bd80e7905d7846c76aca8d41.svg" class="inline-math"> such that
<div class="display-math-row">
<img src="img-math/881cd94133f96c26bdc50e50cd74ab76ea246bce7f0a70b70df4ab0fb1b8129b.svg">
</div>
commutes.</div>
</li>
</ol>

Then the transfinite composition <img src="img-math/759a6399318290dae07b83d4a6924f2a2f200e84b25acd6cb6643a45580afa33.svg" class="inline-math"> of the <img src="img-math/41a98b302dc8d6b3ff252a20c42d9845cdb7664b552cff13b695f1e751e1836e.svg" class="inline-math"> is a weak reflection into <img src="img-math/00b0c6579ea555a95618595a9fc59c54224cda841d202964e8bc06af3c218455.svg" class="inline-math">.
If <img src="img-math/33f0af6adb082f260ea68be9c97080c9a6c235a7dab602edf2e620f833b4a5e9.svg" class="inline-math"> is strong, then <img src="img-math/759a6399318290dae07b83d4a6924f2a2f200e84b25acd6cb6643a45580afa33.svg" class="inline-math"> is a reflection.</div>
</div>
<div class="proof">
<div class="paragraph">
<i class="proof">Proof.</i>
Because <img src="img-math/a603ba9c120beeb4cc13d75afd4bffb964f013db497ed642147503edd36cd7b5.svg" class="inline-math"> is closed under infinite composition, the map <img src="img-math/759a6399318290dae07b83d4a6924f2a2f200e84b25acd6cb6643a45580afa33.svg" class="inline-math"> is a relative <img src="img-math/33f0af6adb082f260ea68be9c97080c9a6c235a7dab602edf2e620f833b4a5e9.svg" class="inline-math">-cell complex.
Thus by Proposition <a href="#prop-relative-m-cell-complex-is-reflection">13</a>, it suffices to show that <img src="img-math/48848ad7f63729e09495d86a45da82ecbb4e3b7b8600abefc01c63010e6da355.svg" class="inline-math"> is in <img src="img-math/00b0c6579ea555a95618595a9fc59c54224cda841d202964e8bc06af3c218455.svg" class="inline-math">.</div>
<div class="paragraph">
Let <img src="img-math/ce45e690d14c519d518a69b5d8fbeef4fc1bdb717fda749b3ce014728cb1807c.svg" class="inline-math"> be in <img src="img-math/33f0af6adb082f260ea68be9c97080c9a6c235a7dab602edf2e620f833b4a5e9.svg" class="inline-math"> and let <img src="img-math/1f7429dec5e61463b4e9cafc0a3360999838082217ce75f387fb93029ccfca61.svg" class="inline-math">.
Because <img src="img-math/40886b1745a36e9b8a947c1ebc2f64c47d47f7465154c3aa49b1a2a7d80a5ab1.svg" class="inline-math"> is finitely presentable, there exists <img src="img-math/8fed3626623475d97ded6863da7837207d2dc337c82cf10ee6d0c0be45d5596b.svg" class="inline-math"> and <img src="img-math/6d086bdab57b3c0746b6624dc78aed5b7d695ba47eeb84f7d78010569d33eb50.svg" class="inline-math"> such that <img src="img-math/a4bd19b1cdf1d5d5f761239964ebfba12682d12ccb248fe4b410276067940e15.svg" class="inline-math"> factors as <img src="img-math/a43d5dfb64c4dc21e6c6e7c334eb4e43d72b7bf251228fa357e4345c1b9b42b3.svg" class="inline-math">.
By assumption <a href="#itm-m-factorizations-exist">2</a>, there exist <img src="img-math/396b9269ff6f1c316dd0e64e61ac28d8bdce88a5ec656424ce023f96c788b326.svg" class="inline-math"> and <img src="img-math/b3cf3e5a4c8e598a86d9b54d9bc63d5877027f7ddb7bb2c6a303b5d1e3225cc9.svg" class="inline-math"> that commutes with <img src="img-math/f2738b187b384a32bc0ae64c168ec48b7bb1dcd95d507720952f97e1cfe178ee.svg" class="inline-math">, <img src="img-math/0abd1f3def3a83ad436689b17d36745eb6634e1735349a4932f09618c41ce8dc.svg" class="inline-math"> and <img src="img-math/ad775893a921c9bb748387e65f1e7815b9567024c5c1818783e0661c6a4861aa.svg" class="inline-math">.
Thus if we define <img src="img-math/45ba21d96a2b4e186f8fd82018b8419f30aef974b138b989b17f0ef42b7c1d40.svg" class="inline-math"> as composition <img src="img-math/ae5057519202d0d0d3a2dc83c5f2c5385697e9d2f2a83e6a430d57fe08a9bb2e.svg" class="inline-math">, then <img src="img-math/610a488e49a88c4455fb7c3074a1a45df259b740f6b3b5e41e467b5faa11843c.svg" class="inline-math">.</div>
</div>
<div id="prop-small-object-argument-exist" class="theorem-like theorem-style-theorem">
<div class="paragraph">
<h4>Proposition 16 <span class="theorem-note">(Small Object Argument: Existence)</span>.
</h4>
Let <img src="img-math/33f0af6adb082f260ea68be9c97080c9a6c235a7dab602edf2e620f833b4a5e9.svg" class="inline-math"> be a set of morphism with finitely presentable domains and codomains, and let <img src="img-math/058a0e00a68e1131c9aa4f8bd9d0e56f03e14180114befecf4eccfefb05fb83d.svg" class="inline-math"> be an object.
Then there exists a sequence
<div class="display-math-row">
<img src="img-math/183947dad4f323fe851e172398328c36dc7bbe5b7434b6700a72e5d14ec328fa.svg">
</div>
satisfying the conditions of Proposition <a href="#prop-small-object-argument-prop">15</a>.
In particular, <img src="img-math/00b0c6579ea555a95618595a9fc59c54224cda841d202964e8bc06af3c218455.svg" class="inline-math"> is a (weakly) reflective subcategory of <img src="img-math/dc523e12504d2f9a179ee90b400d2e5b29b05d6ee1e496dda0eed156a4ef0a2c.svg" class="inline-math">.</div>
</div>
<div class="proof">
<div class="paragraph">
<i class="proof">Proof.</i>
It suffices to construct a relative <img src="img-math/33f0af6adb082f260ea68be9c97080c9a6c235a7dab602edf2e620f833b4a5e9.svg" class="inline-math">-cell complexes <img src="img-math/9a9555b00a2e9e38c0fc318528b8cda749c39320d3515f25aa9126a990ba8107.svg" class="inline-math"> such that for every <img src="img-math/ce45e690d14c519d518a69b5d8fbeef4fc1bdb717fda749b3ce014728cb1807c.svg" class="inline-math"> in <img src="img-math/33f0af6adb082f260ea68be9c97080c9a6c235a7dab602edf2e620f833b4a5e9.svg" class="inline-math"> and <img src="img-math/f9235f639041ac55d215ed1756a6e7007fbe34e0b578cde3074070458cd02a7c.svg" class="inline-math">, there exists a commuting diagram
<div class="display-math-row">
<img src="img-math/d5d175553c66407b2584f56bc5d634a3b82cd7d801a7787624ff25e966fdbb27.svg">
</div>
We then obtain the desired sequence by induction.</div>
<div class="paragraph">
Let <img src="img-math/f6cf97bfa9e50ab18203d10ce01677a20c00e3c84b54146a8e4d73ea55dc8db9.svg" class="inline-math"> be the set of pairs <img src="img-math/67724c7380c24e6472e58b9c2e6be828f360ca3443c4efb7b6c0089499646bca.svg" class="inline-math">, where <img src="img-math/ce45e690d14c519d518a69b5d8fbeef4fc1bdb717fda749b3ce014728cb1807c.svg" class="inline-math"> is a morphism in <img src="img-math/33f0af6adb082f260ea68be9c97080c9a6c235a7dab602edf2e620f833b4a5e9.svg" class="inline-math"> and <img src="img-math/f9235f639041ac55d215ed1756a6e7007fbe34e0b578cde3074070458cd02a7c.svg" class="inline-math">.
Note that <img src="img-math/f6cf97bfa9e50ab18203d10ce01677a20c00e3c84b54146a8e4d73ea55dc8db9.svg" class="inline-math"> is a set because <img src="img-math/33f0af6adb082f260ea68be9c97080c9a6c235a7dab602edf2e620f833b4a5e9.svg" class="inline-math"> is a set and <img src="img-math/e0e14246e96f298ad2f2c376c1ee74d11526b2a760a86885f7c2c19b3ee314d0.svg" class="inline-math"> is a set for all <img src="img-math/40886b1745a36e9b8a947c1ebc2f64c47d47f7465154c3aa49b1a2a7d80a5ab1.svg" class="inline-math">.
Now let <img src="img-math/9a9555b00a2e9e38c0fc318528b8cda749c39320d3515f25aa9126a990ba8107.svg" class="inline-math"> be the map defined by the following pushout diagram:
<div class="display-math-row">
<img src="img-math/c20ffade1443b9046320d0ed48480ef7c3d7fba68dd0340c4851470f635788eb.svg">
</div>
Here the top map is the coproduct <img src="img-math/11a3e7cbfab9a658cac076dd66226cd2bda632d764536800c18bf9482f4630e0.svg" class="inline-math">, and the left vertical map <img src="img-math/f38d43861513174c98cb91fde1f2d2b178d31af52ba4a1139e63282461b16cd3.svg" class="inline-math"> is induced by the universal property of coproducts.</div>
</div>
<div id="prop-reflection-vs-injectivity" class="theorem-like theorem-style-theorem">
<div class="paragraph">
<h4>Proposition 17.
</h4>
Let <img src="img-math/33f0af6adb082f260ea68be9c97080c9a6c235a7dab602edf2e620f833b4a5e9.svg" class="inline-math"> be strong set of morphisms, and let <img src="img-math/ce45e690d14c519d518a69b5d8fbeef4fc1bdb717fda749b3ce014728cb1807c.svg" class="inline-math">.
Denote by <img src="img-math/ac6ee149b36e101967e12d8ecc0a21417d9be83b4b801ce81837a5b156532e72.svg" class="inline-math"> the reflection of <img src="img-math/f2738b187b384a32bc0ae64c168ec48b7bb1dcd95d507720952f97e1cfe178ee.svg" class="inline-math"> into <img src="img-math/00b0c6579ea555a95618595a9fc59c54224cda841d202964e8bc06af3c218455.svg" class="inline-math">.
Then the following equations among injectivity and orthogonality classes hold:
<div class="display-math-row">
<img src="img-math/6add3929c3e6cdede759ff25d8218a036b2f3b1feea8efd8a40915e7da5e6a5d.svg">
</div></div>
</div>
<div class="proof">
<div class="paragraph">
<i class="proof">Proof.</i>
Let <img src="img-math/058a0e00a68e1131c9aa4f8bd9d0e56f03e14180114befecf4eccfefb05fb83d.svg" class="inline-math"> be orthogonal (equivalently: injective) to <img src="img-math/33f0af6adb082f260ea68be9c97080c9a6c235a7dab602edf2e620f833b4a5e9.svg" class="inline-math">.
Then there is a bijective correspondance between solutions to the following lifting problems:
<div class="display-math-row">
<img src="img-math/0301f2a1d8c11e276fb4bf759a5608fb0fef2dd77952ccc65e4cdeffdb329ed9.svg">
</div>
Here <img src="img-math/a4bd19b1cdf1d5d5f761239964ebfba12682d12ccb248fe4b410276067940e15.svg" class="inline-math"> is an arbitrary map, and <img src="img-math/ab91c6470f7e6993cf9a24bf626197b61848724779cfc14c361f2452e6c1057c.svg" class="inline-math"> is induced from <img src="img-math/a4bd19b1cdf1d5d5f761239964ebfba12682d12ccb248fe4b410276067940e15.svg" class="inline-math"> by the universal property of <img src="img-math/4808133a7f26d5ad6ecbf4fcf1e418065e68bfba4f4d82191602fc54dae0b84b.svg" class="inline-math"> and <img src="img-math/058a0e00a68e1131c9aa4f8bd9d0e56f03e14180114befecf4eccfefb05fb83d.svg" class="inline-math"> being orthogonal to <img src="img-math/3ac9675be6c0e312b76184b216f47bd95af3bc8c60c0dd273cadefb50dd492f3.svg" class="inline-math">.</div>
</div>
<h2 id="sec-rhl">
3 Relational Horn Logic</h2>
<div class="paragraph">
Relational Horn Logic (RHL) is a superset of Datalog.
Most notably, RHL allows equations, and in particular equations in conclusions.
Our semantics of RHL are based on <em>relational structures</em>, which we introduce in Section <a href="#subsec-relational-structures">3.1</a>.
In Section <a href="#subsec-rhl-semantics">3.2</a>, we then consider syntax and semantics of RHL.
We show that RHL models can be characterized using lifting properties against <em>classifying morphisms</em>.
This enables us to apply the small object argument to prove the existence of free models, in close analogy to Datalog evaluation.
In Section <a href="#subsec-rhl-completeness">3.3</a>, we prove a completeness result for the descriptive power of RHL:
Every finitary orthogonality class of relational structures can be obtained as semantics of an RHL theory.
In Section <a href="#subsec-datalog-vs-rhl">3.4</a>, we identify in detail the subset of RHL that corresponds to Datalog.
We then explain how the computation of free RHL models can be reduced to evaluation of Datalog with minor extensions via the <em>setoid transformation</em>.</div>
<h3 id="subsec-relational-structures">
3.1 Relational Structures</h3>
<div class="theorem-like theorem-style-definition">
<div class="paragraph">
<h4>Definition 18.
</h4>
A <em>relational signature</em> <img src="img-math/3f48b0f68758e065321bb41ffd846b3ae8096d7d26a252cc38ec1b01aaedf9a2.svg" class="inline-math"> is given by the following data:
<ul>
<li>
<div class="paragraph">
A set <img src="img-math/afd87c23c65e17b0c51f83111752692ab0030bfc9716c0a0c3b2483e4fbf7ba7.svg" class="inline-math"> of <em>sort symbols</em>.</div>
</li>
<li>
<div class="paragraph">
A set <img src="img-math/88e6d395b7900929a401d65dcee050a86691c175ed68c004157b3650a3a23252.svg" class="inline-math"> of <em>relation symbols</em>.</div>
</li>
<li>
<div class="paragraph">
A map that assigns to each relation symbol <img src="img-math/eb8a0ae53bfae72796e1352feea1dea35fd9884f2e749b6aeab6f52fd03277ab.svg" class="inline-math"> an <em>arity</em>
<div class="display-math-row">
<img src="img-math/33d24ed00fdafd4d00d36c754b6f4254d4e50f69d1aef4e25525693ea0106b46.svg">
</div>
of sort symbols <img src="img-math/acb8bcb3999e82976f96f720d9e1386793b9a0efae871dac3cf08936692f375e.svg" class="inline-math"> for <img src="img-math/282b49edc6a3215d6076dede282ec3a4bfc2f2be9b6367b3f30e86ac2e4bc42d.svg" class="inline-math">.</div>
</li>
</ul>
</div>
</div>
<div class="theorem-like theorem-style-definition">
<div class="paragraph">
<h4>Definition 19.
</h4>
Let <img src="img-math/e94a30cee0214f847bdd9fd94bd185ce58e109ee4c9196e76f806ead42454c79.svg" class="inline-math"> be a relational signature.
A <em>relational structure</em> for <img src="img-math/3f48b0f68758e065321bb41ffd846b3ae8096d7d26a252cc38ec1b01aaedf9a2.svg" class="inline-math"> consists of the following data:
<ul>
<li>
<div class="paragraph">
For each sort symbol <img src="img-math/d53b76ba7dd62a8b4c29d4609b13844e774a64afa734cc26b21e2fead3ebaacf.svg" class="inline-math">, a <em>carrier set</em> <img src="img-math/69ca06f3a8e0c73ea0a4a22f998b12768df8b0cb30389e1961bd442291669af2.svg" class="inline-math">.</div>
</li>
<li>
<div class="paragraph">
For each relation symbol <img src="img-math/eb8a0ae53bfae72796e1352feea1dea35fd9884f2e749b6aeab6f52fd03277ab.svg" class="inline-math"> with arity <img src="img-math/1811f68eb74929ecb6edffe855e69d59f231c07bbc85eda64f0b42728156e759.svg" class="inline-math">, a relation <img src="img-math/77e00fd1b2726c45f23077c602d2390d595261839d5219501ad3d65aca68b046.svg" class="inline-math">.</div>
</li>
</ul>
</div>
<div class="paragraph">
A <em>morphism of relational structures</em> <img src="img-math/48066c92e9c1389e9d01471a09b3377bc1b8af0ac5cb934e689031d4b7e0b765.svg" class="inline-math"> consists of functions <img src="img-math/2fc8944a69ab8ecefed8e427133b07f1fa857f568e6933cf69ecac510d406adb.svg" class="inline-math"> for <img src="img-math/d53b76ba7dd62a8b4c29d4609b13844e774a64afa734cc26b21e2fead3ebaacf.svg" class="inline-math"> that are compatible with the relations <img src="img-math/4c2e65ce670f4149d053f1213ff22dff0c01c2cf47d67a61b068e5c8d29a6885.svg" class="inline-math"> and <img src="img-math/7d54818f3cf13ae54c8d91398231e08a61cb1cc0eac6502d940ad8ee218b454e.svg" class="inline-math"> for all <img src="img-math/3a1de76e144a3a79a90c93f2763a2b1a152e8321cc10b1b6949020cbdd8b3ff7.svg" class="inline-math">.
That is, we require that if <img src="img-math/320e3660b6689f272e73e4417ec601693f3520e68490349f1ea453d382918fca.svg" class="inline-math"> for some relation symbol <img src="img-math/1811f68eb74929ecb6edffe855e69d59f231c07bbc85eda64f0b42728156e759.svg" class="inline-math">, then <img src="img-math/8407d52d774e4b85b7a5a1f8a3544715f9e56612e6c570c501c4133ce0c8f2cb.svg" class="inline-math">.
The <em>category of relational structures</em> is denoted by <img src="img-math/2a848f9d861e1b801356d9c69359f0c93fb8118e315aedabba7031e6457792c7.svg" class="inline-math">.</div>
</div>
<div class="paragraph">
When no confusion can arise, we suppress sort annotations.
Thus if <img src="img-math/058a0e00a68e1131c9aa4f8bd9d0e56f03e14180114befecf4eccfefb05fb83d.svg" class="inline-math"> is a relational structure, then we write <img src="img-math/113fb91cc7d1f6e0146fe362d9331a949fba05fa510417002447baa42cfb4d1f.svg" class="inline-math"> to mean that <img src="img-math/571d777af22939b072c455246099c3fba6d9c69fa3f8380529942caeae4b5d26.svg" class="inline-math"> for some <img src="img-math/d53b76ba7dd62a8b4c29d4609b13844e774a64afa734cc26b21e2fead3ebaacf.svg" class="inline-math">.
Similarly, if <img src="img-math/48066c92e9c1389e9d01471a09b3377bc1b8af0ac5cb934e689031d4b7e0b765.svg" class="inline-math"> is a morphism of relational structures and <img src="img-math/571d777af22939b072c455246099c3fba6d9c69fa3f8380529942caeae4b5d26.svg" class="inline-math">, then we often denote the image of <img src="img-math/80b62814a2107cccf2b62c4fc766ccca3986bf3a34e18eed5a6a6c540fcf8a24.svg" class="inline-math"> under <img src="img-math/f2738b187b384a32bc0ae64c168ec48b7bb1dcd95d507720952f97e1cfe178ee.svg" class="inline-math"> by <img src="img-math/619fb060f5ffad763f7dcf563096d1ba58dc0a727f52b618780fbe1cd95c4ee0.svg" class="inline-math"> instead of <img src="img-math/dd3011589b25ecfcab12646500ccc5ccce9f125e157e8274d83f0147e6cf0e5d.svg" class="inline-math">.
If the signature <img src="img-math/3f48b0f68758e065321bb41ffd846b3ae8096d7d26a252cc38ec1b01aaedf9a2.svg" class="inline-math"> is clear from context, we abbreviate <img src="img-math/2a848f9d861e1b801356d9c69359f0c93fb8118e315aedabba7031e6457792c7.svg" class="inline-math"> as <img src="img-math/dab63d9c5701419f4cd81f9adf6ffc5497518985f4e3b89083ac6364af084db1.svg" class="inline-math">.</div>
<div class="paragraph">
There is an evident forgetful functor <img src="img-math/7d7a5e89e5db909df178f0e512a206ac629658a10f9aaf88009acd61045e3d47.svg" class="inline-math"> to the <img src="img-math/afd87c23c65e17b0c51f83111752692ab0030bfc9716c0a0c3b2483e4fbf7ba7.svg" class="inline-math">-ary product of the category of sets, which is given by discarding the relations.
When we mention the <em>carrier sets</em> of a relational structure, we mean the result of applying this forgetful functor.</div>
<div id="prop-adjoints-signature-inclusion" class="theorem-like theorem-style-theorem">
<div class="paragraph">
<h4>Proposition 20.
</h4>
Let <img src="img-math/e94a30cee0214f847bdd9fd94bd185ce58e109ee4c9196e76f806ead42454c79.svg" class="inline-math"> and <img src="img-math/f174f874bfe3f341b1d6951d6496e6450b250dcee9b15d2b278381515b3e4e16.svg" class="inline-math"> be relational signatures such that <img src="img-math/cbfabbb29da9f4535a9a58b92a3d92a678943b924cef71709a582e00078d4879.svg" class="inline-math"> extends <img src="img-math/3f48b0f68758e065321bb41ffd846b3ae8096d7d26a252cc38ec1b01aaedf9a2.svg" class="inline-math">, in the sense that <img src="img-math/75d13729ce1820cebb6eda1eb217c503e52073f46a27f8ba6c9163b2b643778c.svg" class="inline-math"> and <img src="img-math/3f48b0f68758e065321bb41ffd846b3ae8096d7d26a252cc38ec1b01aaedf9a2.svg" class="inline-math"> and <img src="img-math/cbfabbb29da9f4535a9a58b92a3d92a678943b924cef71709a582e00078d4879.svg" class="inline-math"> assign the the same arities to relation symbols <img src="img-math/eb8a0ae53bfae72796e1352feea1dea35fd9884f2e749b6aeab6f52fd03277ab.svg" class="inline-math">.
Then the evident forgetful functor <img src="img-math/98311752dcf0bf449d823033b2d4ca1172cae553cd4d4731c1817fad3d706d93.svg" class="inline-math"> has left and right adjoints.
Both adjoints are sections to the forgetful functor, that is, both composites
<div class="display-math-row">
<img src="img-math/168b2d98b2b878fa0e14c5e2b1aab7bd087cadfcc220cb91d5f5780c5fc81111.svg">
</div>
are identity functors.</div>
</div>
<div class="proof">
<div class="paragraph">
<i class="proof">Proof.</i>
Let <img src="img-math/058a0e00a68e1131c9aa4f8bd9d0e56f03e14180114befecf4eccfefb05fb83d.svg" class="inline-math"> be a relational <img src="img-math/3f48b0f68758e065321bb41ffd846b3ae8096d7d26a252cc38ec1b01aaedf9a2.svg" class="inline-math">-structure.
Let <img src="img-math/54dda9d2b805864e357d74674f229dc24cf9cc87f7e62c67dd9bdfbde32ae0fe.svg" class="inline-math"> and let <img src="img-math/1811f68eb74929ecb6edffe855e69d59f231c07bbc85eda64f0b42728156e759.svg" class="inline-math"> be in <img src="img-math/a1758e129f59e4530a3fdafe5e13237d19c8053830f746c81885600a6e025b28.svg" class="inline-math">.
The left adjoint extends <img src="img-math/058a0e00a68e1131c9aa4f8bd9d0e56f03e14180114befecf4eccfefb05fb83d.svg" class="inline-math"> to a relational <img src="img-math/cbfabbb29da9f4535a9a58b92a3d92a678943b924cef71709a582e00078d4879.svg" class="inline-math">-structure <img src="img-math/114fcb6328c864abf62596ade0d8558d94cfc13aad67dd29fc29433ac30f5146.svg" class="inline-math"> by <img src="img-math/0c47f8d542d7ea96cf4a80607eb126f759e1cfe8e323a69e0f7da05647f3536e.svg" class="inline-math"> and <img src="img-math/d136f2df496380f51b723714c88c8abd712434bcbe5cce52f50ac0056ac17ef7.svg" class="inline-math">.
The right adjoint extends <img src="img-math/058a0e00a68e1131c9aa4f8bd9d0e56f03e14180114befecf4eccfefb05fb83d.svg" class="inline-math"> to a relational <img src="img-math/cbfabbb29da9f4535a9a58b92a3d92a678943b924cef71709a582e00078d4879.svg" class="inline-math"> structure <img src="img-math/f4557c0c69246eebdc26b3eac3b92271067ea93d75024fba31d74d8d3564ba4f.svg" class="inline-math"> such that <img src="img-math/32c6a3e7c46141fab8c4a4e6749d5784345925f87ee5a7ea95a22c7c7aac857c.svg" class="inline-math"> is a singleton set and <img src="img-math/38323b16e59650e30665624e2ebde1142f153b04ad6b2d4785a52b8e24c5ef47.svg" class="inline-math">.</div>
</div>
<div id="prop-rel-cocomplete" class="theorem-like theorem-style-theorem">
<div class="paragraph">
<h4>Proposition 21.
</h4>
Let <img src="img-math/e94a30cee0214f847bdd9fd94bd185ce58e109ee4c9196e76f806ead42454c79.svg" class="inline-math"> be a relational signature.
Then <img src="img-math/2a848f9d861e1b801356d9c69359f0c93fb8118e315aedabba7031e6457792c7.svg" class="inline-math"> is complete and cocomplete, and the forgetful functor <img src="img-math/7d7a5e89e5db909df178f0e512a206ac629658a10f9aaf88009acd61045e3d47.svg" class="inline-math"> preserves limits and colimits.</div>
</div>
<div class="proof">
<div class="paragraph">
<i class="proof">Proof.</i>
Limit and colimit preservation follows from Proposition <a href="#prop-adjoints-signature-inclusion">20</a>, since the forgetful functor is induced by the inclusion <img src="img-math/9d5ad94f40a12063770dd5bb497d2b2ee68de07b3a0a67ff072b34987e7f262c.svg" class="inline-math">.
Limits commute with other limits and in particular products.
Thus, limits of relational structures can be constructed as limits of carriers endowed with the limits of relation sets.</div>
<div class="paragraph">
Colimits are slightly more involved because products do not generally commute with quotients.
Let <img src="img-math/3fa57f0a206e5b97e3743bf6669875a0adb2b9ac9969c3857734622a7870473d.svg" class="inline-math"> be a diagram of relational structures.
We define the carrier sets of our candidate colimit structure <img src="img-math/058a0e00a68e1131c9aa4f8bd9d0e56f03e14180114befecf4eccfefb05fb83d.svg" class="inline-math"> by the colimit of carrier sets.
That is,
<div class="display-math-row">
<img src="img-math/4bd62c82e030bf0beef90202fe6eec82468cd9850aa05f98a5c0430daa8a6895.svg">
</div>
for all <img src="img-math/d53b76ba7dd62a8b4c29d4609b13844e774a64afa734cc26b21e2fead3ebaacf.svg" class="inline-math">.
We obtain evident maps <img src="img-math/8e615d05ec9b6b9bacba3ccd1831ec08c220186355aee7245fee752ae0b18ed7.svg" class="inline-math"> for all objects <img src="img-math/d42d5862aea05b2fd7aa9c5bb07e9c13754585c17cee2cf95c36c2d9fc35ebeb.svg" class="inline-math"> in <img src="img-math/f6cf97bfa9e50ab18203d10ce01677a20c00e3c84b54146a8e4d73ea55dc8db9.svg" class="inline-math"> and <img src="img-math/d53b76ba7dd62a8b4c29d4609b13844e774a64afa734cc26b21e2fead3ebaacf.svg" class="inline-math">.
Let <img src="img-math/1811f68eb74929ecb6edffe855e69d59f231c07bbc85eda64f0b42728156e759.svg" class="inline-math"> be a relation symbol.
Then we define <img src="img-math/4c2e65ce670f4149d053f1213ff22dff0c01c2cf47d67a61b068e5c8d29a6885.svg" class="inline-math"> as union over the images of the <img src="img-math/83e5baa167be2ff4fc399c9bf1bce7468b270f4d94d03ced990aa28e0b9dfc74.svg" class="inline-math">.
Thus,
<div class="display-math-row">
<img src="img-math/1f893f6293ef41bae1c5ea08bec4a7cee81ef2c9ace0be788865be0f97cc21b1.svg">
</div>
where <img src="img-math/b7e673ca40833affc8e8595369022b675b43e97c6f59fd2fac487fcd4e39095f.svg" class="inline-math">.</div>
</div>
<div id="def-finite-relational-structure" class="theorem-like theorem-style-definition">
<div class="paragraph">
<h4>Definition 22.
</h4>
Let <img src="img-math/e94a30cee0214f847bdd9fd94bd185ce58e109ee4c9196e76f806ead42454c79.svg" class="inline-math"> be a relational signature.
A relational structure <img src="img-math/058a0e00a68e1131c9aa4f8bd9d0e56f03e14180114befecf4eccfefb05fb83d.svg" class="inline-math"> for <img src="img-math/3f48b0f68758e065321bb41ffd846b3ae8096d7d26a252cc38ec1b01aaedf9a2.svg" class="inline-math"> is <em>finite</em> if
<div id="eq-finite-relational-structure" class="display-math-row">
<img src="img-math/ccb9b8d8333f14a587b2c8548329fee696e3df93d090602e4061e1cbea095ac0.svg">
</div>
that is, if all the <img src="img-math/69ca06f3a8e0c73ea0a4a22f998b12768df8b0cb30389e1961bd442291669af2.svg" class="inline-math"> and <img src="img-math/4c2e65ce670f4149d053f1213ff22dff0c01c2cf47d67a61b068e5c8d29a6885.svg" class="inline-math"> are finite and almost always empty.</div>
</div>
<div id="prop-finite-equiv-finitely-presentable" class="theorem-like theorem-style-theorem">
<div class="paragraph">
<h4>Proposition 23.
</h4>
Let <img src="img-math/e94a30cee0214f847bdd9fd94bd185ce58e109ee4c9196e76f806ead42454c79.svg" class="inline-math"> be a relational signature.
Then a relational structure for <img src="img-math/3f48b0f68758e065321bb41ffd846b3ae8096d7d26a252cc38ec1b01aaedf9a2.svg" class="inline-math"> is finite if and only if it is a finitely presentable object in <img src="img-math/2a848f9d861e1b801356d9c69359f0c93fb8118e315aedabba7031e6457792c7.svg" class="inline-math">.</div>
</div>
<div class="proof">
<div class="paragraph">
<i class="proof">Proof.</i>
Let <img src="img-math/058a0e00a68e1131c9aa4f8bd9d0e56f03e14180114befecf4eccfefb05fb83d.svg" class="inline-math"> be a finite relational structure and let
<div class="display-math-row">
<img src="img-math/1f3515c8332edf99e3bddca8017a7d23a11ad10c44a7a7a5348c025bcbf26923.svg">
</div>
be a map to a filtered colimit.
Then the image of each element <img src="img-math/113fb91cc7d1f6e0146fe362d9331a949fba05fa510417002447baa42cfb4d1f.svg" class="inline-math"> is represented by some element <img src="img-math/971e2c5f24e50db0449404b6657998dc2c13d78b5abc6a52e3c182f6e85b1831.svg" class="inline-math">.
Since <img src="img-math/058a0e00a68e1131c9aa4f8bd9d0e56f03e14180114befecf4eccfefb05fb83d.svg" class="inline-math"> contains only finitely many elements and <img src="img-math/a90b4e51dd125acad890bbecb4236db2b31cd04f2285c5cd5a39e83a7123fc4e.svg" class="inline-math"> is directed, we may assume that <img src="img-math/f3958d201a60108d8d6566850865794c7c4884be576fa248aeb6b34e51e2600a.svg" class="inline-math"> is constant over all <img src="img-math/807941f5497448f56929f7bfd52306b5ecd067a95e6ef995909c42209336e0d8.svg" class="inline-math">.
For each tuple <img src="img-math/e6d29a3696549e3bd544876430015b877ffeed8e4704d8e9492b488774f409e1.svg" class="inline-math"> for some <img src="img-math/eb8a0ae53bfae72796e1352feea1dea35fd9884f2e749b6aeab6f52fd03277ab.svg" class="inline-math"> we have that <img src="img-math/a394bed29cb9cfb2a6bcdc9a671c973cb0d35af4f15f6f54f56061a0b9dd6674.svg" class="inline-math">.
Since there are only finitely many <img src="img-math/18e5e78375303bc5487910c10a2ce9e156e961a4865f78069b5e5d98e4281061.svg" class="inline-math">, we may again increase <img src="img-math/d42d5862aea05b2fd7aa9c5bb07e9c13754585c17cee2cf95c36c2d9fc35ebeb.svg" class="inline-math"> so that <img src="img-math/c410b30281081c440aef1bcb8b93c39df32d8bc28a5350e0dbd9424caca54609.svg" class="inline-math">.
Now <img src="img-math/9a9555b00a2e9e38c0fc318528b8cda749c39320d3515f25aa9126a990ba8107.svg" class="inline-math"> factors via <img src="img-math/135f5b7e637401e0a49f2cb3f6f68e0a6f1b583f31ae30c158d58383cf5e70b8.svg" class="inline-math">.</div>
<div class="paragraph">
Conversely, if a relational structure <img src="img-math/058a0e00a68e1131c9aa4f8bd9d0e56f03e14180114befecf4eccfefb05fb83d.svg" class="inline-math"> is not finite, then there exists a strictly increasing sequence of relational substructures
<div class="display-math-row">
<img src="img-math/7e3695956fd7f8c9c98eaedc476b31b22f2016d4d87a7bf4c26f92e9aba11062.svg">
</div>
such that <img src="img-math/c4226bea44dc847948abcc82dd36f72b2f3c43daa35314529ad48f11bd533a53.svg" class="inline-math">.
Then the canonical map <img src="img-math/e80f9848b4bf76f6a8e20fc1c6f780065b6f0986d11be475b6a3e53be045e477.svg" class="inline-math"> does not factor via any <img src="img-math/c99cb71ac37bbb60bd470fd882c3288061f0f40d5309cee309948a6cb14a669c.svg" class="inline-math">, so <img src="img-math/058a0e00a68e1131c9aa4f8bd9d0e56f03e14180114befecf4eccfefb05fb83d.svg" class="inline-math"> is not finitely presentable.</div>
</div>
<h3 id="subsec-rhl-semantics">
3.2 Syntax and Semantics</h3>
<div class="paragraph">
Fix a relational signature <img src="img-math/e94a30cee0214f847bdd9fd94bd185ce58e109ee4c9196e76f806ead42454c79.svg" class="inline-math">.
We assume a countable supply of variable symbols <img src="img-math/35611dd170074cd8301fedd4d5924c6cebf1fa1d77e601af80bff825c42676a9.svg" class="inline-math">, each annotated with a sort <img src="img-math/d53b76ba7dd62a8b4c29d4609b13844e774a64afa734cc26b21e2fead3ebaacf.svg" class="inline-math">.</div>
<div id="def-relational-syntax" class="theorem-like theorem-style-definition">
<div class="paragraph">
<h4>Definition 24.
</h4>
An <em>RHL atom</em> is a statement of one of the following forms:
<ol>
<li id="itm-relation-atom">
<div class="paragraph">
<img src="img-math/72b97bbfd4d8280f058093ac3e6e269b2701cc3600603a31876d9b8156094425.svg" class="inline-math">, where <img src="img-math/1811f68eb74929ecb6edffe855e69d59f231c07bbc85eda64f0b42728156e759.svg" class="inline-math"> is a relation symbol and the <img src="img-math/90275abc21a6a4571eb3f15d9be4f18696c8b105a04d93af93da257466bd0d96.svg" class="inline-math"> are variables of sort <img src="img-math/baf65a1761f8845318b6d260476ad9483528d03101a79244cd644cd984f26f02.svg" class="inline-math"> for all <img src="img-math/ceec897e2982ac3e9a8a0fe65f23f5caaf56b422384e50d177d99b89ce584b59.svg" class="inline-math">.</div>
</li>
<li>
<div class="paragraph">
<img src="img-math/3847348cd93d06ac59b59e21238c28ea661356d3bbb4178706cd29bebe6c6bed.svg" class="inline-math"> where <img src="img-math/35611dd170074cd8301fedd4d5924c6cebf1fa1d77e601af80bff825c42676a9.svg" class="inline-math"> is a variable.</div>
</li>
<li>
<div class="paragraph">
<img src="img-math/9cd2b0fcede7653e1b74d39d80f93075066d668d15e1482494016ff0f94e433f.svg" class="inline-math">, where <img src="img-math/3fc9857a0a4cb8aa18910afc040daa9ceaa9be94fb1f436d1beef9da603fae45.svg" class="inline-math"> and <img src="img-math/35611dd170074cd8301fedd4d5924c6cebf1fa1d77e601af80bff825c42676a9.svg" class="inline-math"> are variables of the same sort.</div>
</li>
</ol>

A <em>relational formula</em> is a finite conjunction of flat atoms.
A <em>relational sequent</em> is an implication of flat formulas.
An <em>relational theory</em> is a set of relational sequents.</div>
</div>
<div id="def-relational-semantics" class="theorem-like theorem-style-definition">
<div class="paragraph">
<h4>Definition 25.
</h4>
Let <img src="img-math/058a0e00a68e1131c9aa4f8bd9d0e56f03e14180114befecf4eccfefb05fb83d.svg" class="inline-math"> be a relational structure.
An <em>interpretation of a set of variables <img src="img-math/097341643da03f834dcfc1c269e14dd1882b799fef693ffd387bad12e0df2571.svg" class="inline-math"></em> in <img src="img-math/058a0e00a68e1131c9aa4f8bd9d0e56f03e14180114befecf4eccfefb05fb83d.svg" class="inline-math"> is a map <img src="img-math/f6cf97bfa9e50ab18203d10ce01677a20c00e3c84b54146a8e4d73ea55dc8db9.svg" class="inline-math"> that assigns to each variable <img src="img-math/05e5683efb61ab79128663a218255c95faaeec72ceafb200fc37646d0fad2210.svg" class="inline-math"> of sort <img src="img-math/c97a8fe633f85e531699955fb905d5a68ebdd81d9622ddcedb8f550da2473f85.svg" class="inline-math"> an element <img src="img-math/7323ce2933bb55a9ea1287f9676d1ce05370f1aeedf863cae6fe02f408e6f8a5.svg" class="inline-math">.
An <em>interpretation of a relational atom <img src="img-math/e6602cbfa7788f74e914319dd9b4cae6f7ab2eda9b10a1d27222a73d7ebff434.svg" class="inline-math"></em> in <img src="img-math/058a0e00a68e1131c9aa4f8bd9d0e56f03e14180114befecf4eccfefb05fb83d.svg" class="inline-math"> is an interpretation <img src="img-math/f6cf97bfa9e50ab18203d10ce01677a20c00e3c84b54146a8e4d73ea55dc8db9.svg" class="inline-math"> of the variables occuring in <img src="img-math/e6602cbfa7788f74e914319dd9b4cae6f7ab2eda9b10a1d27222a73d7ebff434.svg" class="inline-math"> such that one of the following conditions holds:
<ol>
<li>
<div class="paragraph">
<img src="img-math/fde92b884cd61a05f563f5dad8518ad69244b1019f53732519380f8a1bb59a73.svg" class="inline-math"> for some relation symbol <img src="img-math/3a1de76e144a3a79a90c93f2763a2b1a152e8321cc10b1b6949020cbdd8b3ff7.svg" class="inline-math"> and <img src="img-math/91693dee7c75be2ed138a5ae03278ab13db32a8cd8e3f099ccf1b1d09f26d116.svg" class="inline-math">.</div>
</li>
<li>
<div class="paragraph">
<img src="img-math/7f9eeb15ec638cabf6b30cdeaa9dda87afc4c2b2c41590f104978e69ba08794f.svg" class="inline-math"> for some variable <img src="img-math/35611dd170074cd8301fedd4d5924c6cebf1fa1d77e601af80bff825c42676a9.svg" class="inline-math">, without further assumptions.</div>
</li>
<li>
<div class="paragraph">
<img src="img-math/586baaece37d78fa041472c19db1fc1d894f53852a1452971850301b8d8f7a12.svg" class="inline-math"> for some variables <img src="img-math/3fc9857a0a4cb8aa18910afc040daa9ceaa9be94fb1f436d1beef9da603fae45.svg" class="inline-math"> and <img src="img-math/35611dd170074cd8301fedd4d5924c6cebf1fa1d77e601af80bff825c42676a9.svg" class="inline-math">, and <img src="img-math/b04d57a239523b5511154fba2941191a9ab389483b60c3229ed5a7f548735f31.svg" class="inline-math">.</div>
</li>
</ol>

An <em>interpretation of a relational formula <img src="img-math/44c763111130122b65031bed2248460bf1dcf8c7ca72bbdc684b533107497c41.svg" class="inline-math"></em> in <img src="img-math/058a0e00a68e1131c9aa4f8bd9d0e56f03e14180114befecf4eccfefb05fb83d.svg" class="inline-math"> is an interpretation of the variables occuring in <img src="img-math/49d82e153ba9554774e5cf42f2a25ead34b1889dbce1ca32cde9582177e2e192.svg" class="inline-math"> that restricts to an interpretation of <img src="img-math/07a47d98126e3bd35068f453fc1f4a459d9226bd9caf8ef8c35f8bc9ddda24e4.svg" class="inline-math"> for each <img src="img-math/ceec897e2982ac3e9a8a0fe65f23f5caaf56b422384e50d177d99b89ce584b59.svg" class="inline-math">.</div>
<div class="paragraph">
A relational structure <img src="img-math/058a0e00a68e1131c9aa4f8bd9d0e56f03e14180114befecf4eccfefb05fb83d.svg" class="inline-math"> <em>satisfies</em> a relational sequent <img src="img-math/121cfe734ff5ad02c5c220036e8387f3cd32c0d74ea3fcafefc50437b8f7e11e.svg" class="inline-math"> if each interpretation of <img src="img-math/49d82e153ba9554774e5cf42f2a25ead34b1889dbce1ca32cde9582177e2e192.svg" class="inline-math"> in <img src="img-math/058a0e00a68e1131c9aa4f8bd9d0e56f03e14180114befecf4eccfefb05fb83d.svg" class="inline-math"> can be extended to an interpretation of <img src="img-math/7f15aa55cf7cd571a1dadd12329de73d6b63b9dc06d98c638307e005d819d980.svg" class="inline-math"> in <img src="img-math/058a0e00a68e1131c9aa4f8bd9d0e56f03e14180114befecf4eccfefb05fb83d.svg" class="inline-math">.
A <em>model</em> of a theory <img src="img-math/4e5b4bad957cd570519bf7c2ccc79708841c401e107a29138dcdf3074f76551e.svg" class="inline-math"> is a relational structure that satisfies all sequents in <img src="img-math/4e5b4bad957cd570519bf7c2ccc79708841c401e107a29138dcdf3074f76551e.svg" class="inline-math">.
The <em>category of models</em> for a theory <img src="img-math/4e5b4bad957cd570519bf7c2ccc79708841c401e107a29138dcdf3074f76551e.svg" class="inline-math"> is the full subcategory of relational structures given by the models of <img src="img-math/4e5b4bad957cd570519bf7c2ccc79708841c401e107a29138dcdf3074f76551e.svg" class="inline-math"> and denoted by <img src="img-math/00113b2831f32d64f7bfe0edd7dfe73ea690eddf255baee2f18a00b9189e3672.svg" class="inline-math">.</div>
</div>
<div class="theorem-like theorem-style-definition">
<div class="paragraph">
<h4>Definition 26.
</h4>
We associate to each flat atom <img src="img-math/e6602cbfa7788f74e914319dd9b4cae6f7ab2eda9b10a1d27222a73d7ebff434.svg" class="inline-math"> a <em>classifying relational structure</em> <img src="img-math/213013bc223083dd8b2f7185919a1c79aaba8a05802f428c33605ca7eb6e3b1b.svg" class="inline-math"> and a <em>generic interpretation</em> <img src="img-math/97dd1eaaf2beb229d981c8c0d09227fefa9d41f6feb50a54315c7fd5b16b0306.svg" class="inline-math"> of <img src="img-math/e6602cbfa7788f74e914319dd9b4cae6f7ab2eda9b10a1d27222a73d7ebff434.svg" class="inline-math"> in <img src="img-math/213013bc223083dd8b2f7185919a1c79aaba8a05802f428c33605ca7eb6e3b1b.svg" class="inline-math"> as follows:
<ol>
<li>
<div class="paragraph">
If <img src="img-math/fde92b884cd61a05f563f5dad8518ad69244b1019f53732519380f8a1bb59a73.svg" class="inline-math"> where <img src="img-math/1811f68eb74929ecb6edffe855e69d59f231c07bbc85eda64f0b42728156e759.svg" class="inline-math">, then the carriers of <img src="img-math/213013bc223083dd8b2f7185919a1c79aaba8a05802f428c33605ca7eb6e3b1b.svg" class="inline-math"> are given by distinct elements <img src="img-math/46bb188b48af157265aaf892ddcbd2c32f5294e3e3e13221a2333bc9882a5441.svg" class="inline-math"> and a single tuple <img src="img-math/990dca9ebe4471bb9b4f98325818a657a0f929fbe6b3bfcb045b9d3665c04741.svg" class="inline-math">.
The relations <img src="img-math/8cd89c547786afaa1a920758b92f6ac4878cdefc6f25cd8567201f55910b9c74.svg" class="inline-math"> for <img src="img-math/d6469e8d5520135182823b8e43e6c1c1e245c2f282844286fbb31a4b5073da9c.svg" class="inline-math"> are empty.</div>
</li>
<li>
<div class="paragraph">
If <img src="img-math/7f9eeb15ec638cabf6b30cdeaa9dda87afc4c2b2c41590f104978e69ba08794f.svg" class="inline-math">, where <img src="img-math/35611dd170074cd8301fedd4d5924c6cebf1fa1d77e601af80bff825c42676a9.svg" class="inline-math"> has sort <img src="img-math/c97a8fe633f85e531699955fb905d5a68ebdd81d9622ddcedb8f550da2473f85.svg" class="inline-math">, then <img src="img-math/8ac8952910c244ab3eb5fe77dcaba4cce66e73c334884af9420609c192b9100b.svg" class="inline-math"> contains a single element <img src="img-math/83171b8110f9cfe502ae18d40ccee7e50ee899a8e512e0c32959f85ab97dcd7a.svg" class="inline-math">.
All other carrier sets and all relations are empty.</div>
</li>
<li>
<div class="paragraph">
If <img src="img-math/6860c0cb8d9a8a7a950011e3d8011df1b64474fc1616e4145b937f1ee2f0b40e.svg" class="inline-math">, where <img src="img-math/afc174558d8a33b0b0a210eb082d36a16991a9ffa987f2968b0420e104e2e0ae.svg" class="inline-math"> and <img src="img-math/d84c1acf307f480b52692517802a4e7665e018e718ceefb85eac6b8da7e7499a.svg" class="inline-math"> have sort <img src="img-math/c97a8fe633f85e531699955fb905d5a68ebdd81d9622ddcedb8f550da2473f85.svg" class="inline-math">, then <img src="img-math/8ac8952910c244ab3eb5fe77dcaba4cce66e73c334884af9420609c192b9100b.svg" class="inline-math"> contains a single element <img src="img-math/c188ca99ccb0db16f79fb6e86e88f395d25dc6f5988001e8ac4d665449395bad.svg" class="inline-math">.
All other carrier sets and all relations are empty.</div>
</li>
</ol>
</div>
<div class="paragraph">
Let <img src="img-math/44c763111130122b65031bed2248460bf1dcf8c7ca72bbdc684b533107497c41.svg" class="inline-math"> be a relational formula.
The classifying relational struture <img src="img-math/38ea0a85e8e091acaa0053b546b0f55124854385b49fe559e3e52dcba18a1abd.svg" class="inline-math"> of <img src="img-math/f6d86a6f28fc28643c288e8b9fb3bcea657f2db64f517b5b434f99c922bf160d.svg" class="inline-math"> is the quotient
<div class="display-math-row">
<img src="img-math/46ddcef49ec037c821c604c91472ac72a7699dc45c86afc878b9230a46284850.svg">
</div>
where <img src="img-math/7b75c8cac28cd194a6550187248242acae459224fb4eace57888b52d99fe8a35.svg" class="inline-math"> is the relation given by
<div class="display-math-row">
<img src="img-math/01514d89b6055bd8f3600b8e6648102cfab63ba0710eed63647e7e77fb604d6a.svg">
</div>
for all <img src="img-math/00fa28b6705c4996e7036b4006dcd7ab7e08f12c9aec6ed28f6b24c178b4f52e.svg" class="inline-math"> and variables <img src="img-math/35611dd170074cd8301fedd4d5924c6cebf1fa1d77e601af80bff825c42676a9.svg" class="inline-math"> occuring in both <img src="img-math/07a47d98126e3bd35068f453fc1f4a459d9226bd9caf8ef8c35f8bc9ddda24e4.svg" class="inline-math"> and <img src="img-math/d16a2ddc12fd8ac0ae5b2335d811edee09ea99cb86da28e936b12f109c792f9e.svg" class="inline-math">, and the generic interpretation <img src="img-math/deeb4f21ec9b0e5fe23f759e86556b7237699475494e8bfa016238422cae44b4.svg" class="inline-math"> is the amalgamation of the interpretations <img src="img-math/73357ae5677085a7de9c0bade420ecaccfd59b5740fd90148d40f79fe752f4b0.svg" class="inline-math">.</div>
</div>
<div id="prop-relational-formula-structure-universal" class="theorem-like theorem-style-theorem">
<div class="paragraph">
<h4>Proposition 27.
</h4>
Let <img src="img-math/49d82e153ba9554774e5cf42f2a25ead34b1889dbce1ca32cde9582177e2e192.svg" class="inline-math"> be a relational formula and let <img src="img-math/058a0e00a68e1131c9aa4f8bd9d0e56f03e14180114befecf4eccfefb05fb83d.svg" class="inline-math"> be a relational structure.
Then there is a bijection between interpretations of <img src="img-math/49d82e153ba9554774e5cf42f2a25ead34b1889dbce1ca32cde9582177e2e192.svg" class="inline-math"> in <img src="img-math/058a0e00a68e1131c9aa4f8bd9d0e56f03e14180114befecf4eccfefb05fb83d.svg" class="inline-math"> and maps <img src="img-math/988ea3b9f738b6ccc887a2c2dba2eba42f7049f33d27dc71cc9ac06e50d58d40.svg" class="inline-math">.</div>
</div>
<div class="proof">
<div class="paragraph">
<i class="proof">Proof.</i>
If <img src="img-math/71b262258c7b80fbfb314ea7c965e9433fc8880ef1dd4eaf07d99334b43c74b7.svg" class="inline-math">, then <img src="img-math/ae78b4066112203af12f969432937e2d53c3dc947134ccfa6c0ebeae0c7606b8.svg" class="inline-math"> is an interpretation of <img src="img-math/49d82e153ba9554774e5cf42f2a25ead34b1889dbce1ca32cde9582177e2e192.svg" class="inline-math"> in <img src="img-math/058a0e00a68e1131c9aa4f8bd9d0e56f03e14180114befecf4eccfefb05fb83d.svg" class="inline-math">.
For the converse, let <img src="img-math/44c763111130122b65031bed2248460bf1dcf8c7ca72bbdc684b533107497c41.svg" class="inline-math"> for relational atoms <img src="img-math/07a47d98126e3bd35068f453fc1f4a459d9226bd9caf8ef8c35f8bc9ddda24e4.svg" class="inline-math">.
Then every interpretation <img src="img-math/f6cf97bfa9e50ab18203d10ce01677a20c00e3c84b54146a8e4d73ea55dc8db9.svg" class="inline-math"> of <img src="img-math/49d82e153ba9554774e5cf42f2a25ead34b1889dbce1ca32cde9582177e2e192.svg" class="inline-math"> restricts to an interpretation of <img src="img-math/07a47d98126e3bd35068f453fc1f4a459d9226bd9caf8ef8c35f8bc9ddda24e4.svg" class="inline-math"> for each <img src="img-math/d42d5862aea05b2fd7aa9c5bb07e9c13754585c17cee2cf95c36c2d9fc35ebeb.svg" class="inline-math">.
The carrier sets of <img src="img-math/aa2ba950387d85c4237e08981eeff0493339e1f209dba23fb5eb78ce69f81f6f.svg" class="inline-math"> are defined using the variables of <img src="img-math/07a47d98126e3bd35068f453fc1f4a459d9226bd9caf8ef8c35f8bc9ddda24e4.svg" class="inline-math">, which defines an evident map <img src="img-math/0fd99ac251897bebbe89faa35423ad03ad41ddb34c7737d96fb1ad4680d54a09.svg" class="inline-math">.
Since the restrictions of <img src="img-math/f6cf97bfa9e50ab18203d10ce01677a20c00e3c84b54146a8e4d73ea55dc8db9.svg" class="inline-math"> to the variables in each <img src="img-math/07a47d98126e3bd35068f453fc1f4a459d9226bd9caf8ef8c35f8bc9ddda24e4.svg" class="inline-math"> agree on variables that occur in simultaneously in two atoms, the individual maps <img src="img-math/0fd99ac251897bebbe89faa35423ad03ad41ddb34c7737d96fb1ad4680d54a09.svg" class="inline-math"> glue to a map <img src="img-math/988ea3b9f738b6ccc887a2c2dba2eba42f7049f33d27dc71cc9ac06e50d58d40.svg" class="inline-math">.</div>
</div>
<div class="theorem-like theorem-style-definition">
<div class="paragraph">
<h4>Definition 28.
</h4>
Let <img src="img-math/3ee054267b2482dd601e7989eee8fddbaed341d4d976512c352d54149be9a72a.svg" class="inline-math"> be a relational sequent.
The <em>classifying morphism</em> of <img src="img-math/f6d86a6f28fc28643c288e8b9fb3bcea657f2db64f517b5b434f99c922bf160d.svg" class="inline-math"> is the map <img src="img-math/ce36923cecd5df0297700ff93246be0de597221ec59f3f304daa8f7ddd542e9b.svg" class="inline-math"> that is induced by the canonical interpretation of <img src="img-math/49d82e153ba9554774e5cf42f2a25ead34b1889dbce1ca32cde9582177e2e192.svg" class="inline-math"> in <img src="img-math/5e54a1f805cc1db6c174c02a8b23256b39f57a019f0c0495e7e15122c76ff08e.svg" class="inline-math">.</div>
</div>
<div id="prop-relational-sequent-morphism-lifts" class="theorem-like theorem-style-theorem">
<div class="paragraph">
<h4>Proposition 29.
</h4>
Let <img src="img-math/f6d86a6f28fc28643c288e8b9fb3bcea657f2db64f517b5b434f99c922bf160d.svg" class="inline-math"> be a relational sequent and let <img src="img-math/058a0e00a68e1131c9aa4f8bd9d0e56f03e14180114befecf4eccfefb05fb83d.svg" class="inline-math"> be a relational structure.
Then <img src="img-math/058a0e00a68e1131c9aa4f8bd9d0e56f03e14180114befecf4eccfefb05fb83d.svg" class="inline-math"> satisfies <img src="img-math/f6d86a6f28fc28643c288e8b9fb3bcea657f2db64f517b5b434f99c922bf160d.svg" class="inline-math"> if and only if <img src="img-math/058a0e00a68e1131c9aa4f8bd9d0e56f03e14180114befecf4eccfefb05fb83d.svg" class="inline-math"> is injective to <img src="img-math/6ff9f6433f9a2ff1291b28de007b9ce9524af3cd4449c64a6f2fa0a7e855b7c1.svg" class="inline-math">.</div>
</div>
<div class="proof">
<div class="paragraph">
<i class="proof">Proof.</i>
Let <img src="img-math/3ee054267b2482dd601e7989eee8fddbaed341d4d976512c352d54149be9a72a.svg" class="inline-math">.
By Proposition <a href="#prop-relational-formula-structure-universal">27</a>, interpretations <img src="img-math/f6cf97bfa9e50ab18203d10ce01677a20c00e3c84b54146a8e4d73ea55dc8db9.svg" class="inline-math"> of the premise <img src="img-math/49d82e153ba9554774e5cf42f2a25ead34b1889dbce1ca32cde9582177e2e192.svg" class="inline-math"> correspond to maps <img src="img-math/a500290da262e451d6d328beb196c19a7d0497906cd520d7b9cba979c0445acf.svg" class="inline-math">, and interpretations <img src="img-math/85d617f9ec5b3c3579342ff68281cc3c898f2ed55d8dc66f8323c228b5577eaf.svg" class="inline-math"> of <img src="img-math/7f15aa55cf7cd571a1dadd12329de73d6b63b9dc06d98c638307e005d819d980.svg" class="inline-math"> correspond to maps <img src="img-math/0cab64d0532ead0e7cd0fac131f5573af265d69a5a67545a7d4ede40d9ec489d.svg" class="inline-math">.
The map <img src="img-math/ce36923cecd5df0297700ff93246be0de597221ec59f3f304daa8f7ddd542e9b.svg" class="inline-math"> can be obtained by restriction of the generic interpretation of <img src="img-math/7f15aa55cf7cd571a1dadd12329de73d6b63b9dc06d98c638307e005d819d980.svg" class="inline-math"> in <img src="img-math/5e54a1f805cc1db6c174c02a8b23256b39f57a019f0c0495e7e15122c76ff08e.svg" class="inline-math"> to the variables occurring in <img src="img-math/49d82e153ba9554774e5cf42f2a25ead34b1889dbce1ca32cde9582177e2e192.svg" class="inline-math">.
It follows that
<div class="display-math-row">
<img src="img-math/670d55d9a790d006cd6656564f93b1be872e0c6d2cfab79674ceac874fabe623.svg">
</div>
commutes if and only if <img src="img-math/f6cf97bfa9e50ab18203d10ce01677a20c00e3c84b54146a8e4d73ea55dc8db9.svg" class="inline-math"> is a restriction of <img src="img-math/85d617f9ec5b3c3579342ff68281cc3c898f2ed55d8dc66f8323c228b5577eaf.svg" class="inline-math">.</div>
</div>
<div id="prop-free-models" class="theorem-like theorem-style-theorem">
<div class="paragraph">
<h4>Proposition 30.
</h4>
Let <img src="img-math/4e5b4bad957cd570519bf7c2ccc79708841c401e107a29138dcdf3074f76551e.svg" class="inline-math"> be a relational theory.
Then <img src="img-math/c192b4063ac4e8cd6d40e0c63d029efe1fedfd02db29f1d3cfd0cd3d8554392c.svg" class="inline-math"> is a weakly reflective category.
If <img src="img-math/e808fd067db113de8bf5ec6fca77a9eaff0ab38b3c34b40e6bf795e62d9f4d83.svg" class="inline-math"> is strong, then <img src="img-math/00113b2831f32d64f7bfe0edd7dfe73ea690eddf255baee2f18a00b9189e3672.svg" class="inline-math"> is a reflective subcategory.</div>
</div>
<div class="proof">
<div class="paragraph">
<i class="proof">Proof.</i>
By application of the small object argument (Propositions <a href="#prop-small-object-argument-prop">15</a> and <a href="#prop-small-object-argument-exist">16</a>) to <img src="img-math/e808fd067db113de8bf5ec6fca77a9eaff0ab38b3c34b40e6bf795e62d9f4d83.svg" class="inline-math">.</div>
</div>
<div class="theorem-like theorem-style-remark">
<div class="paragraph">
<h4>Remark 31.
</h4>
Let us reflect on the similarities between the proof of Proposition <a href="#prop-free-models">30</a> and Datalog evaluation.
Note that Datalog is a strict subset of RHL, so we have to specialize Proposition <a href="#prop-free-models">30</a> to Datalog theories <img src="img-math/4e5b4bad957cd570519bf7c2ccc79708841c401e107a29138dcdf3074f76551e.svg" class="inline-math"> in order to compare.
Thus, we assume that the conclusions of sequents in <img src="img-math/4e5b4bad957cd570519bf7c2ccc79708841c401e107a29138dcdf3074f76551e.svg" class="inline-math"> only contain atoms <img src="img-math/72b97bbfd4d8280f058093ac3e6e269b2701cc3600603a31876d9b8156094425.svg" class="inline-math"> for variables that occur in the premise (see Section <a href="#subsec-datalog-vs-rhl">3.4</a> for detailed discussion of fragments of RHL).</div>
<div class="paragraph">
Now, unfolding the small object argument, we see that the reflection of a relational structure <img src="img-math/058a0e00a68e1131c9aa4f8bd9d0e56f03e14180114befecf4eccfefb05fb83d.svg" class="inline-math"> into the category of models is given by the colimit of a chain
<div id="eq-datalog-small-object-argument" class="display-math-row">
<span>(2)</span>
<img src="img-math/f7fc5c8cc2c81740fd2a0b79bb61f3663768f5c1c30fe3f3c4a3fb99b7408c60.svg">
<span>(2)</span>
</div>
of relational structures.
The relational structure <img src="img-math/058a0e00a68e1131c9aa4f8bd9d0e56f03e14180114befecf4eccfefb05fb83d.svg" class="inline-math"> corresponds to the set of input facts to the Datalog program, and each <img src="img-math/d51daa3072f2248b5dd96c1be894b078399e8b5a342aa9190dbd535c7eb44f9f.svg" class="inline-math"> represents the total set of derived facts after the <img src="img-math/d42d5862aea05b2fd7aa9c5bb07e9c13754585c17cee2cf95c36c2d9fc35ebeb.svg" class="inline-math">th iteration of Datalog evaluation.
Because <img src="img-math/4e5b4bad957cd570519bf7c2ccc79708841c401e107a29138dcdf3074f76551e.svg" class="inline-math"> contains Datalog sequents only, the transition maps <img src="img-math/05e1ba6a605bc109a581e7a30a1cab089424e91cda8c086cc27a5d9f9b36aa23.svg" class="inline-math"> are bijective on carriers.
The data of the sequence <a href="#eq-datalog-small-object-argument">(2)</a> is thus equivalent to a sequence of inclusions
<div class="display-math-row">
<img src="img-math/c33562d4c1eeb7f07d98f790f716c736c3895b9be0efa7ee023fc25b4e350b44.svg">
</div>
on the carrier of <img src="img-math/058a0e00a68e1131c9aa4f8bd9d0e56f03e14180114befecf4eccfefb05fb83d.svg" class="inline-math"> for all relation symbols <img src="img-math/3a1de76e144a3a79a90c93f2763a2b1a152e8321cc10b1b6949020cbdd8b3ff7.svg" class="inline-math">, mirroring the monotonically growing relations during Datalog evaluation.</div>
<div class="paragraph">
Unfolding our existence proof of the small object argument (Proposition <a href="#prop-small-object-argument-exist">16</a>) and the universal property of classifying structures (Proposition <a href="#prop-relational-formula-structure-universal">27</a>), we see that <img src="img-math/f882f8e79aacbd5c865a4c4a1440d49abac15be1ecf4bb6fb225f1fe8e2f60a0.svg" class="inline-math"> is obtained from <img src="img-math/d51daa3072f2248b5dd96c1be894b078399e8b5a342aa9190dbd535c7eb44f9f.svg" class="inline-math"> via the following pushout square:
<div id="eq-small-object-argument-step-datalog" class="display-math-row">
<span>(3)</span>
<img src="img-math/66e32375a40bd5fad9f945f919e911d7bc5a876470de5fe2a24d801ba531ecab.svg">
<span>(3)</span>
</div>
Here <img src="img-math/bbe5cc62db3c4a7c10e82a1dd874cf11721cf4749c18a673bb56499ec8237707.svg" class="inline-math"> is the set of of pairs of sequents <img src="img-math/60fa6b69f6dbcf3473b74e3d93f8689552c0ea5798e531980f246eb2e65f0a51.svg" class="inline-math"> and interpretations <img src="img-math/c1c1d846005a81eca467a07d6347a5a0f80acdc9740d50c9897aa1f5f2f86bcb.svg" class="inline-math">.
Thus the left vertical map corresponds to the set of matches of premises among the facts established after the <img src="img-math/d42d5862aea05b2fd7aa9c5bb07e9c13754585c17cee2cf95c36c2d9fc35ebeb.svg" class="inline-math">th iteration of Datalog evaluation.
Defining <img src="img-math/f882f8e79aacbd5c865a4c4a1440d49abac15be1ecf4bb6fb225f1fe8e2f60a0.svg" class="inline-math"> using the pushout square above has the effect of adjoining matches of the conclusion for each match of the premise.
Since <img src="img-math/4e5b4bad957cd570519bf7c2ccc79708841c401e107a29138dcdf3074f76551e.svg" class="inline-math"> is a Datalog theory, the conclusions are relation atoms, hence <img src="img-math/f882f8e79aacbd5c865a4c4a1440d49abac15be1ecf4bb6fb225f1fe8e2f60a0.svg" class="inline-math"> is obtained from <img src="img-math/d51daa3072f2248b5dd96c1be894b078399e8b5a342aa9190dbd535c7eb44f9f.svg" class="inline-math"> by adjoining new tuples to relations.</div>
</div>
<div class="theorem-like theorem-style-remark">
<div class="paragraph">
<h4>Remark 32.
</h4>
Semi-naive evaluation is an optimized version of Datalog evaluation, where we consider only matches of premises at the <img src="img-math/d42d5862aea05b2fd7aa9c5bb07e9c13754585c17cee2cf95c36c2d9fc35ebeb.svg" class="inline-math">th stage that have not been present already in the <img src="img-math/de2c7e0bbd57228036fdbb2b1b2816b3cbcbe182c8e9e130c591bcbf22daf63f.svg" class="inline-math">th stage.
This does not change the result of Datalog evaluation since conclusions of matches that have been found in a previous iteration have already been adjoined.
In terms of the small object argument, this optimization can be understood as a more economic choice of the set <img src="img-math/bbe5cc62db3c4a7c10e82a1dd874cf11721cf4749c18a673bb56499ec8237707.svg" class="inline-math">:
In Diagram <a href="#eq-small-object-argument-step-datalog">(3)</a>, we can replace <img src="img-math/bbe5cc62db3c4a7c10e82a1dd874cf11721cf4749c18a673bb56499ec8237707.svg" class="inline-math"> by the set of interpretations <img src="img-math/c1c1d846005a81eca467a07d6347a5a0f80acdc9740d50c9897aa1f5f2f86bcb.svg" class="inline-math"> that do not factor via <img src="img-math/8de24616b4e5e3ad2dfebf667d8ac45a8ce43b415d210fdfd034116b6dd9e6d2.svg" class="inline-math">.</div>
</div>
<div class="theorem-like theorem-style-remark">
<div class="paragraph">
<h4>Remark 33.
</h4>
Still, there are properties of Datalog evaluation that Proposition <a href="#prop-free-models">30</a> does not entirely capture.
First, the result of Datalog evaluation is determined uniquely via fixed point semantics, whereas Proposition <a href="#prop-free-models">30</a> guarantees uniqueness (up to ismorphism) only in the case of strong theories.
Since classifying morphisms of Datalog sequents are surjective, all Datalog theories are strong (Proposition <a href="#prop-epi-strong">4</a>).
Thus, Proposition <a href="#prop-free-models">30</a> does indeed determine the result of Datalog computation uniquely.
However, not all strong theories are Datalog theories or even contain epimorphisms only.
For example, Proposition <a href="#prop-strongbization">5</a> allows extending every RHL theory to a strong theory.
A syntactic characterization of strong RHL theories is the main purpose of Section <a href="#sec-phl">4</a>, where we discuss partial Horn logic.</div>
<div class="paragraph">
A second feature of Datalog evaluation we have not discussed is that it always terminates:
Since each Datalog evaluation monotonically increases the size of relations on a fixed carrier, we reach a fixed point after a finite number of iterations.
This is not generally true for RHL theories, since the carrier sets change during evaluation.
We can, however, prove termination for <em>surjective</em> theories, which subsume and generalize Datalog theories (Corollary <a href="#cor-surjective-rhl-theories-terminate">38</a>).
In general, however, termination of RHL evaluation is undecidable.</div>
</div>
<h3 id="subsec-rhl-completeness">
3.3 Completeness Results</h3>
<div class="theorem-like theorem-style-definition">
<div class="paragraph">
<h4>Definition 34.
</h4>
Let <img src="img-math/48066c92e9c1389e9d01471a09b3377bc1b8af0ac5cb934e689031d4b7e0b765.svg" class="inline-math"> be a map of relational structures.
We say that <img src="img-math/f2738b187b384a32bc0ae64c168ec48b7bb1dcd95d507720952f97e1cfe178ee.svg" class="inline-math"> is <em>surjective</em> if <img src="img-math/45897b5e62d11df6fc0bbc805809763e20ddf7e466032d382f19eeae2eca2cf6.svg" class="inline-math"> is a surjective map for all <img src="img-math/d53b76ba7dd62a8b4c29d4609b13844e774a64afa734cc26b21e2fead3ebaacf.svg" class="inline-math">.</div>
</div>
<div id="prop-epimorphisms-classification" class="theorem-like theorem-style-theorem">
<div class="paragraph">
<h4>Proposition 35.
</h4>
Let <img src="img-math/e94a30cee0214f847bdd9fd94bd185ce58e109ee4c9196e76f806ead42454c79.svg" class="inline-math"> be a relational signature.
Let <img src="img-math/48066c92e9c1389e9d01471a09b3377bc1b8af0ac5cb934e689031d4b7e0b765.svg" class="inline-math"> be a map of relational structures.
<ol>
<li id="itm-relational-epimorphisms">
<div class="paragraph">
<img src="img-math/f2738b187b384a32bc0ae64c168ec48b7bb1dcd95d507720952f97e1cfe178ee.svg" class="inline-math"> is an epimorphism if and only if <img src="img-math/f2738b187b384a32bc0ae64c168ec48b7bb1dcd95d507720952f97e1cfe178ee.svg" class="inline-math"> is surjective.</div>
</li>
<li id="itm-relational-effective-epimorphisms">
<div class="paragraph">
<img src="img-math/f2738b187b384a32bc0ae64c168ec48b7bb1dcd95d507720952f97e1cfe178ee.svg" class="inline-math"> is an effective epimorphism if and only if <img src="img-math/f2738b187b384a32bc0ae64c168ec48b7bb1dcd95d507720952f97e1cfe178ee.svg" class="inline-math"> is surjective and furthermore the induced maps <img src="img-math/f5b93a8376a490a546f8ff021d0f790dbcc2c21efd5df6ed1ca6be3309cc0d3e.svg" class="inline-math"> are surjective for all <img src="img-math/eb8a0ae53bfae72796e1352feea1dea35fd9884f2e749b6aeab6f52fd03277ab.svg" class="inline-math">.</div>
</li>
</ol>
</div>
</div>
<div class="proof">
<div class="paragraph">
<i class="proof">Proof.</i>
<a href="#itm-relational-epimorphisms">1</a>.
Note that, for every morphism <img src="img-math/48066c92e9c1389e9d01471a09b3377bc1b8af0ac5cb934e689031d4b7e0b765.svg" class="inline-math"> in a cocomplete category <img src="img-math/dc523e12504d2f9a179ee90b400d2e5b29b05d6ee1e496dda0eed156a4ef0a2c.svg" class="inline-math">, <img src="img-math/f2738b187b384a32bc0ae64c168ec48b7bb1dcd95d507720952f97e1cfe178ee.svg" class="inline-math"> is an epimorphism if and only if
<div class="display-math-row">
<img src="img-math/7bff95b51dc97d10c2d00426113ff080ea4b61ccf716d563a7b94d41d4a6f2d3.svg">
</div>
is a pushout square.
Because the forgetful functor from relational structures to <img src="img-math/afd87c23c65e17b0c51f83111752692ab0030bfc9716c0a0c3b2483e4fbf7ba7.svg" class="inline-math">-indexed families of sets preserves colimits, it follows that it preserves epimorphisms, i.e. that every epimorphism of relational structures must be surjective.
The same forgetful functor is faithful, hence reflects epimorphisms.</div>
<div class="paragraph">
<a href="#itm-relational-effective-epimorphisms">2</a>.
This follows from the construction of colimits in Proposition <a href="#prop-rel-cocomplete">21</a>.</div>
</div>
<div id="prop-semantics-relational-sequents" class="theorem-like theorem-style-theorem">
<div class="paragraph">
<h4>Proposition 36.
</h4>
The image of (surjective, effectively epic) relational sequents under the assignment <img src="img-math/ef9a5d285c5aa120ef228ab92938f55dc21eef66b38d2b11694f1f3dfe05dbef.svg" class="inline-math"> can be described as follows:
<ol>
<li id="itm-semantics-arbitrary-relational-sequent">
<div class="paragraph">
If <img src="img-math/f6d86a6f28fc28643c288e8b9fb3bcea657f2db64f517b5b434f99c922bf160d.svg" class="inline-math"> is a relational sequent, then <img src="img-math/6ff9f6433f9a2ff1291b28de007b9ce9524af3cd4449c64a6f2fa0a7e855b7c1.svg" class="inline-math"> is a map finite relational structures.
Conversely, every map of finite relational structures is isomorphic to a map of the form <img src="img-math/6ff9f6433f9a2ff1291b28de007b9ce9524af3cd4449c64a6f2fa0a7e855b7c1.svg" class="inline-math"> for a relational sequent <img src="img-math/f6d86a6f28fc28643c288e8b9fb3bcea657f2db64f517b5b434f99c922bf160d.svg" class="inline-math">.</div>
</li>
<li id="itm-semantics-surjective-relational-sequent">
<div class="paragraph">
If <img src="img-math/f6d86a6f28fc28643c288e8b9fb3bcea657f2db64f517b5b434f99c922bf160d.svg" class="inline-math"> is surjective, then <img src="img-math/6ff9f6433f9a2ff1291b28de007b9ce9524af3cd4449c64a6f2fa0a7e855b7c1.svg" class="inline-math"> is a surjection of finite relational structures.
Conversely, every surjection of finite relational structures is isomorphic to a map of the form <img src="img-math/6ff9f6433f9a2ff1291b28de007b9ce9524af3cd4449c64a6f2fa0a7e855b7c1.svg" class="inline-math"> for a surjective relational sequent <img src="img-math/f6d86a6f28fc28643c288e8b9fb3bcea657f2db64f517b5b434f99c922bf160d.svg" class="inline-math">.</div>
</li>
<li id="itm-semantics-quotient-relational-sequent">
<div class="paragraph">
If <img src="img-math/f6d86a6f28fc28643c288e8b9fb3bcea657f2db64f517b5b434f99c922bf160d.svg" class="inline-math"> is effectively epic, then <img src="img-math/6ff9f6433f9a2ff1291b28de007b9ce9524af3cd4449c64a6f2fa0a7e855b7c1.svg" class="inline-math"> is an effective epimorphism of finite relational structures.
Conversely, every effective epimorphism of finite relational structures is isomorphic to a map of the form <img src="img-math/6ff9f6433f9a2ff1291b28de007b9ce9524af3cd4449c64a6f2fa0a7e855b7c1.svg" class="inline-math"> for an effectively epic relational sequent <img src="img-math/f6d86a6f28fc28643c288e8b9fb3bcea657f2db64f517b5b434f99c922bf160d.svg" class="inline-math">.</div>
</li>
</ol>
</div>
</div>
<div class="proof">
<div class="paragraph">
<i class="proof">Proof.</i>
<a href="#itm-semantics-arbitrary-relational-sequent">1</a>.
Relational sequents <img src="img-math/f6d86a6f28fc28643c288e8b9fb3bcea657f2db64f517b5b434f99c922bf160d.svg" class="inline-math"> are by definition finite formulas, so it follows from the definition of the map <img src="img-math/6ff9f6433f9a2ff1291b28de007b9ce9524af3cd4449c64a6f2fa0a7e855b7c1.svg" class="inline-math"> that its domain and codomain are finite.</div>
<div class="paragraph">
Conversely let <img src="img-math/ce45e690d14c519d518a69b5d8fbeef4fc1bdb717fda749b3ce014728cb1807c.svg" class="inline-math"> be a map of finite relational structures.
Choose distinct variables <img src="img-math/535cb63eb49c38124a87627c60a7b5f454c44682ea0743ce612aa67804923900.svg" class="inline-math"> of sort <img src="img-math/c97a8fe633f85e531699955fb905d5a68ebdd81d9622ddcedb8f550da2473f85.svg" class="inline-math"> for all sorts <img src="img-math/c97a8fe633f85e531699955fb905d5a68ebdd81d9622ddcedb8f550da2473f85.svg" class="inline-math"> and <img src="img-math/92b20520fca4748e34ac885a7d7b20e067206a6a709aab2c44a4773712c221bf.svg" class="inline-math">.
The formulas
<div class="display-math-row">
<img src="img-math/9a91aefe9ab4bd6d5f818676983656e09f5b36fd71b49351424325487e2fe791.svg">
</div>
are finite (and hence well-defined) because <img src="img-math/40886b1745a36e9b8a947c1ebc2f64c47d47f7465154c3aa49b1a2a7d80a5ab1.svg" class="inline-math"> is finite.
The formula <img src="img-math/9dd316fb94c6715f010279bfb0742c93cd696ee8abdd4771ba6a842530e0493c.svg" class="inline-math"> encodes the carrier sets of <img src="img-math/40886b1745a36e9b8a947c1ebc2f64c47d47f7465154c3aa49b1a2a7d80a5ab1.svg" class="inline-math">, and <img src="img-math/9f1cd1c097aa0037ef41cbaf62309cb3c4ddec6d8ccdb051c68a72743fc46eb4.svg" class="inline-math"> encodes the relations.
Thus if <img src="img-math/4f98d327f10ce629395dc7e5d35296d19727ae8f7a2662de6e5b98ef84ec9f46.svg" class="inline-math">, then <img src="img-math/2a091dfcf1f25f96ed99167716e611df2d310ee7283063026ada67aee4bc5bd8.svg" class="inline-math">.</div>
<div class="paragraph">
Define similarly variables <img src="img-math/fb45a3786a8193ad653a12761f405b970e39e37f34a76a45017f4533d4c55a52.svg" class="inline-math"> for each <img src="img-math/768512a61d2cdb4322ae50274810a29d9ed9b669dcc8bbda513f795908a4299c.svg" class="inline-math"> and formulas <img src="img-math/929c202ec35a302e3608daa1ec64ade9d106aac4760c3a6bfd8420917964e5f7.svg" class="inline-math"> for <img src="img-math/d86feac55d82bcc77c1cc615c0236fbd0d614da286d7046334827cfc5912fc12.svg" class="inline-math">.
Set
<div class="display-math-row">
<img src="img-math/a88bfa122de305d0def48a604ecd76ded6d994d31695f3de578c4099d62c1ec6.svg">
</div>
and let <img src="img-math/f6d5ea51965193074ccee3f1f891593cb184a81f2284db966aea8b279970e32d.svg" class="inline-math">.
Then
<div class="display-math-row">
<img src="img-math/9513431a942c6f520b7f27602ba0ef775ed13a2cc4fd10069bfab1fa0c4ad20a.svg">
</div>
and it can be verified using the universal property of <img src="img-math/38ea0a85e8e091acaa0053b546b0f55124854385b49fe559e3e52dcba18a1abd.svg" class="inline-math"> (Proposition <a href="#prop-relational-formula-structure-universal">27</a>) that
<div class="display-math-row">
<img src="img-math/858a9458831a535c53469bcdc71c7016eecf6e4c987dd784e9375f204ba71e7b.svg">
</div>
commutes.</div>
<div class="paragraph">
<a href="#itm-semantics-surjective-relational-sequent">2</a>.
The carrier of a relational structure <img src="img-math/38ea0a85e8e091acaa0053b546b0f55124854385b49fe559e3e52dcba18a1abd.svg" class="inline-math"> obtained from a formula <img src="img-math/49d82e153ba9554774e5cf42f2a25ead34b1889dbce1ca32cde9582177e2e192.svg" class="inline-math"> is a quotient of the set of variables occuring in <img src="img-math/49d82e153ba9554774e5cf42f2a25ead34b1889dbce1ca32cde9582177e2e192.svg" class="inline-math">.
Thus if every variable in the conclusion <img src="img-math/f01bc8a000c08d15aed25ef15f5acd71cf0134bc807b3f0564102b2ed8197abc.svg" class="inline-math"> of a sequent <img src="img-math/121cfe734ff5ad02c5c220036e8387f3cd32c0d74ea3fcafefc50437b8f7e11e.svg" class="inline-math"> occurs also in the premise <img src="img-math/49d82e153ba9554774e5cf42f2a25ead34b1889dbce1ca32cde9582177e2e192.svg" class="inline-math">, then the resulting map <img src="img-math/f423f4f1e501ba5aacae13a14a4c5db10f539ee1eede95a5110890421d30a195.svg" class="inline-math"> is surjective.
Conversely, let <img src="img-math/ce45e690d14c519d518a69b5d8fbeef4fc1bdb717fda749b3ce014728cb1807c.svg" class="inline-math"> be a surjective map of finite relational structures.
Let <img src="img-math/535cb63eb49c38124a87627c60a7b5f454c44682ea0743ce612aa67804923900.svg" class="inline-math"> for <img src="img-math/205b33806536c522ad1e99864f9b2a667c790c327be3fab82e03b2c4628f9f81.svg" class="inline-math"> and <img src="img-math/aa083e01074a476d184059bfa3395522f1ba2fa22b02db539fd35c0b64fa7ea1.svg" class="inline-math"> be as in the proof of <a href="#itm-semantics-arbitrary-relational-sequent">1</a>, so that <img src="img-math/4bca7514a74e3a5d806b2281673a795be6d30fb94fd8eaad13c99fd4ed910338.svg" class="inline-math">.
Set
<div class="display-math-row">
<img src="img-math/1a59fa206bf014befa076c34b25cd7ebaf706a981178686502e7016929e0ece9.svg">
</div>
and <img src="img-math/627324afeb312c7f370ae477358d18bf62649b95345cdc17a5c8eb6eb48f6434.svg" class="inline-math">.
Because all the <img src="img-math/535cb63eb49c38124a87627c60a7b5f454c44682ea0743ce612aa67804923900.svg" class="inline-math"> occur in <img src="img-math/49d82e153ba9554774e5cf42f2a25ead34b1889dbce1ca32cde9582177e2e192.svg" class="inline-math">, all the variables of <img src="img-math/f01bc8a000c08d15aed25ef15f5acd71cf0134bc807b3f0564102b2ed8197abc.svg" class="inline-math"> occur in <img src="img-math/49d82e153ba9554774e5cf42f2a25ead34b1889dbce1ca32cde9582177e2e192.svg" class="inline-math">.
By definition of <img src="img-math/f083279d836bd31b6184ecacfd5092bd448527e253b02eae6521edb8bf2d5f6d.svg" class="inline-math">, the map <img src="img-math/8299c08df565a11472033f86de332c89f254bdc83995e927604d71078fe33657.svg" class="inline-math"> is an isomorphism on carrier sets, which then implies that <img src="img-math/fc56640aed0bad30c3b4b62417c79e303faffefbc5ede744c66d3f46036c3531.svg" class="inline-math"> by definition of <img src="img-math/0236ce1802e00475702708a90854889f7f05e7ca05bfcf6f1600d60505703247.svg" class="inline-math">.
Thus <img src="img-math/da355831e25757a668033fed67fc74c948e532ed88a31c6a0703f72f487b2d8b.svg" class="inline-math">.</div>
<div class="paragraph">
<a href="#itm-semantics-quotient-relational-sequent">3</a>.
If <img src="img-math/f6d86a6f28fc28643c288e8b9fb3bcea657f2db64f517b5b434f99c922bf160d.svg" class="inline-math"> is effectively epic and <img src="img-math/5d2246ff94f1fa4f10972b22e22d09523f9369e3446fce07c9c947bd8378320f.svg" class="inline-math">, then the maps <img src="img-math/8c1f6595c1c55bf8f2fde7eb9c956ec9cec3d2f3ce99ab16e36448768229b881.svg" class="inline-math"> are surjective for all relation symbols <img src="img-math/3a1de76e144a3a79a90c93f2763a2b1a152e8321cc10b1b6949020cbdd8b3ff7.svg" class="inline-math">.
Thus by Proposition <a href="#prop-epimorphisms-classification">35</a>, <img src="img-math/f2738b187b384a32bc0ae64c168ec48b7bb1dcd95d507720952f97e1cfe178ee.svg" class="inline-math"> is an effective epimorphism.</div>
<div class="paragraph">
Conversely, let <img src="img-math/ce45e690d14c519d518a69b5d8fbeef4fc1bdb717fda749b3ce014728cb1807c.svg" class="inline-math"> be an effective epimorphism of finite relational structures.
Let <img src="img-math/535cb63eb49c38124a87627c60a7b5f454c44682ea0743ce612aa67804923900.svg" class="inline-math"> for <img src="img-math/205b33806536c522ad1e99864f9b2a667c790c327be3fab82e03b2c4628f9f81.svg" class="inline-math"> and <img src="img-math/aa083e01074a476d184059bfa3395522f1ba2fa22b02db539fd35c0b64fa7ea1.svg" class="inline-math"> be as in the proof of <a href="#itm-semantics-arbitrary-relational-sequent">1</a>, so that <img src="img-math/4bca7514a74e3a5d806b2281673a795be6d30fb94fd8eaad13c99fd4ed910338.svg" class="inline-math">.
Let
<div class="display-math-row">
<img src="img-math/f591f53d35970dfceaa95b19d7a79754c9cf73ab7814709c2612f05e202d1aaa.svg">
</div>
By the same argument as in the proof of <a href="#itm-semantics-surjective-relational-sequent">2</a>, it follows that <img src="img-math/0bd99272540aa75f93f905ba8fea2f85654579421ed6276045b1ae7d6f1cc88d.svg" class="inline-math"> is an isomorphism on carrier sets.
Let <img src="img-math/3a1de76e144a3a79a90c93f2763a2b1a152e8321cc10b1b6949020cbdd8b3ff7.svg" class="inline-math"> be a relation symbol and let <img src="img-math/3797ee5dfea92d89ebf4fe13524b91f68795aee7b96303288e40c48811d37807.svg" class="inline-math">.
Then because <img src="img-math/f2738b187b384a32bc0ae64c168ec48b7bb1dcd95d507720952f97e1cfe178ee.svg" class="inline-math"> is an effective epimorphism, there exist <img src="img-math/702c9efe5e46f35dfad1efd3f8eaf8f8ca28bfe5429287f774ddebe1b5bd524b.svg" class="inline-math"> such <img src="img-math/43fac9fcd1dbc0d77c8c6e5b133056b62e702a851a7db8ea40acfcffbf5fc9ff.svg" class="inline-math"> for all <img src="img-math/d42d5862aea05b2fd7aa9c5bb07e9c13754585c17cee2cf95c36c2d9fc35ebeb.svg" class="inline-math"> and <img src="img-math/9d90e99fd6923d4ae6ba0bc28606fd00778d7c11ffa54ae354a9046692b7ab37.svg" class="inline-math">.
Thus <img src="img-math/49d82e153ba9554774e5cf42f2a25ead34b1889dbce1ca32cde9582177e2e192.svg" class="inline-math"> contains the atom <img src="img-math/25b18908fdd2fe4d7e75f9c29ba03fc73453d4441ad02e6e3e9fff9adf5cc783.svg" class="inline-math">, hence <img src="img-math/fc01369948f2ede968f6f8265bf590794054dd11a427f26dceb7513e04a8d267.svg" class="inline-math"> is in the image of <img src="img-math/f3b4a5d2fbe3a8715e101207dca73bafbcaffc8196c4134d5c904efaf1feb8d5.svg" class="inline-math">.
We conclude <img src="img-math/fc56640aed0bad30c3b4b62417c79e303faffefbc5ede744c66d3f46036c3531.svg" class="inline-math">, hence <img src="img-math/38cd98adaaa8096a43b098bbb777453de40fd241d3c22e4d437dafb3a409601e.svg" class="inline-math">.</div>
</div>
<div id="prop-surjective-small-object-argument" class="theorem-like theorem-style-theorem">
<div class="paragraph">
<h4>Proposition 37.
</h4>
Let <img src="img-math/33f0af6adb082f260ea68be9c97080c9a6c235a7dab602edf2e620f833b4a5e9.svg" class="inline-math"> be a finite set of epimorphisms of finite relational structures.
Let
<div class="display-math-row">
<img src="img-math/6699194b9b41acb2612e24f5ce61456efc1d521444765ee816011d8fbd9edf0f.svg">
</div>
be any sequence of maps of relational structures satisfying the conditions of Proposition <a href="#prop-small-object-argument-prop">15</a> such that furthermore <img src="img-math/cf0b3bb40535937022093c5f7369e5b91b187c1a50b08d95f6d905891fa87444.svg" class="inline-math"> is finite.
Then the sequence is eventually stationary, in the sense that <img src="img-math/41a98b302dc8d6b3ff252a20c42d9845cdb7664b552cff13b695f1e751e1836e.svg" class="inline-math"> is an isomorphism for all sufficiently large <img src="img-math/509fe7e8ba852248c1de4dfc8c752f04a501aa15dc740f89268b2dd4cb0e9155.svg" class="inline-math">.</div>
</div>
<div class="proof">
<div class="paragraph">
<i class="proof">Proof.</i>
Since all maps in <img src="img-math/33f0af6adb082f260ea68be9c97080c9a6c235a7dab602edf2e620f833b4a5e9.svg" class="inline-math"> are surjective and colimits of relational structures commute with colimits on carrier sets, it follows that all maps in <img src="img-math/a603ba9c120beeb4cc13d75afd4bffb964f013db497ed642147503edd36cd7b5.svg" class="inline-math"> are surjective.
Thus the cardinality of the carriers of the <img src="img-math/c99cb71ac37bbb60bd470fd882c3288061f0f40d5309cee309948a6cb14a669c.svg" class="inline-math"> decreases monotonically with <img src="img-math/509fe7e8ba852248c1de4dfc8c752f04a501aa15dc740f89268b2dd4cb0e9155.svg" class="inline-math">.
Since <img src="img-math/058a0e00a68e1131c9aa4f8bd9d0e56f03e14180114befecf4eccfefb05fb83d.svg" class="inline-math"> is finite, the carriers <img src="img-math/69ca06f3a8e0c73ea0a4a22f998b12768df8b0cb30389e1961bd442291669af2.svg" class="inline-math"> are empty for almost all sorts <img src="img-math/c97a8fe633f85e531699955fb905d5a68ebdd81d9622ddcedb8f550da2473f85.svg" class="inline-math">.
Eventually, the sum of the cardinalities of the carriers of <img src="img-math/c99cb71ac37bbb60bd470fd882c3288061f0f40d5309cee309948a6cb14a669c.svg" class="inline-math"> must thus become stable, say after <img src="img-math/49d839c81ab5d353c46a9bdbef99ef0232f5a843bf93ca4938fb4f3b4c93b211.svg" class="inline-math">.
Without loss of generality, we may assume that <img src="img-math/41a98b302dc8d6b3ff252a20c42d9845cdb7664b552cff13b695f1e751e1836e.svg" class="inline-math"> is the identity map on carriers for <img src="img-math/11d22cc2ff505d88edc5ff4d0ee1617d90bae508d7dea04ec9f4927709588246.svg" class="inline-math">.
Let <img src="img-math/eb8a0ae53bfae72796e1352feea1dea35fd9884f2e749b6aeab6f52fd03277ab.svg" class="inline-math">.
Then for all <img src="img-math/11d22cc2ff505d88edc5ff4d0ee1617d90bae508d7dea04ec9f4927709588246.svg" class="inline-math">, we have that
<div class="display-math-row">
<img src="img-math/f921c3f71178a60ad0748f979b7f4bedbda6351216a7b874bb89e279e73ce2b8.svg">
</div>
and the latter is a finite set.
Thus, we eventually have <img src="img-math/c0de2aec93b5a9dc538f3a9387dc6f99bfe51cda2032d898c2bba60fc136201e.svg" class="inline-math">.
Even when <img src="img-math/88e6d395b7900929a401d65dcee050a86691c175ed68c004157b3650a3a23252.svg" class="inline-math"> is infinite, we have <img src="img-math/ee00f339154ce8e904b62bb34fad03445f5e92b1bdc23154a2500b917d3297b4.svg" class="inline-math"> for all <img src="img-math/509fe7e8ba852248c1de4dfc8c752f04a501aa15dc740f89268b2dd4cb0e9155.svg" class="inline-math"> and almost all <img src="img-math/3a1de76e144a3a79a90c93f2763a2b1a152e8321cc10b1b6949020cbdd8b3ff7.svg" class="inline-math">, since only finitely many relations are non-empty in any of the involved relational structures (<img src="img-math/058a0e00a68e1131c9aa4f8bd9d0e56f03e14180114befecf4eccfefb05fb83d.svg" class="inline-math"> or a domain or codomain of a map in <img src="img-math/33f0af6adb082f260ea68be9c97080c9a6c235a7dab602edf2e620f833b4a5e9.svg" class="inline-math">).
For sufficiently large <img src="img-math/6292e27c03bd37bfad4c40c7b385ee2a195e16e0f0cd87d3bb432a1bf9a8a86e.svg" class="inline-math"> we thus have <img src="img-math/c0de2aec93b5a9dc538f3a9387dc6f99bfe51cda2032d898c2bba60fc136201e.svg" class="inline-math"> for all <img src="img-math/3a1de76e144a3a79a90c93f2763a2b1a152e8321cc10b1b6949020cbdd8b3ff7.svg" class="inline-math"> and hence <img src="img-math/5eb56838ce2565c21da2ae8a610eef16df507969658439ea71e2912663f1c4da.svg" class="inline-math">.</div>
</div>
<div id="cor-surjective-rhl-theories-terminate" class="theorem-like theorem-style-theorem">
<div class="paragraph">
<h4>Corollary 38.
</h4>
Let <img src="img-math/4e5b4bad957cd570519bf7c2ccc79708841c401e107a29138dcdf3074f76551e.svg" class="inline-math"> be an RHL theory containing only surjective sequents.
Then the reflection of a finite relational structure into <img src="img-math/00113b2831f32d64f7bfe0edd7dfe73ea690eddf255baee2f18a00b9189e3672.svg" class="inline-math"> is a finite relational structure.
</div>
</div>
<div class="theorem-like theorem-style-remark">
<div class="paragraph">
<h4>Remark 39.
</h4>
Proposition <a href="#prop-surjective-small-object-argument">37</a> can likely be generalized to locally finitely presentable categories (perhaps with further conditions on the cardinality of <img src="img-math/33f0af6adb082f260ea68be9c97080c9a6c235a7dab602edf2e620f833b4a5e9.svg" class="inline-math">) as such categories are always co-wellpowered:
For every object <img src="img-math/058a0e00a68e1131c9aa4f8bd9d0e56f03e14180114befecf4eccfefb05fb83d.svg" class="inline-math">, there exists up to isomorphism only a <em>set</em> of epimorphism <img src="img-math/5d0fffd65cffebf0debdc19d763a9cc565243331c349ac7863feac23c20b57af.svg" class="inline-math">.
We would now have to identify objects for which this set is finite.</div>
</div>
<h3 id="subsec-datalog-vs-rhl">
3.4 Datalog and Relational Horn Logic</h3>
<div class="theorem-like theorem-style-definition">
<div class="paragraph">
<h4>Definition 40.
</h4>
Let <img src="img-math/f6d86a6f28fc28643c288e8b9fb3bcea657f2db64f517b5b434f99c922bf160d.svg" class="inline-math"> be an RHL sequent.
<ol>
<li>
<div class="paragraph">
<img src="img-math/f6d86a6f28fc28643c288e8b9fb3bcea657f2db64f517b5b434f99c922bf160d.svg" class="inline-math"> is a <em>Datalog sequent</em> if all atoms in <img src="img-math/f6d86a6f28fc28643c288e8b9fb3bcea657f2db64f517b5b434f99c922bf160d.svg" class="inline-math"> are of the form <img src="img-math/7b60fb809a4f511c5fea9a685075798c4a7beb8be660a3690554b7122cfa1cdf.svg" class="inline-math"> and all variables in the conclusion of <img src="img-math/f6d86a6f28fc28643c288e8b9fb3bcea657f2db64f517b5b434f99c922bf160d.svg" class="inline-math"> also occur in the premise.</div>
</li>
<li>
<div class="paragraph">
<img src="img-math/f6d86a6f28fc28643c288e8b9fb3bcea657f2db64f517b5b434f99c922bf160d.svg" class="inline-math"> is a <em>Datalog sequent with sort quantification</em> if all atoms in <img src="img-math/f6d86a6f28fc28643c288e8b9fb3bcea657f2db64f517b5b434f99c922bf160d.svg" class="inline-math"> are of the form <img src="img-math/7b60fb809a4f511c5fea9a685075798c4a7beb8be660a3690554b7122cfa1cdf.svg" class="inline-math"> or <img src="img-math/3847348cd93d06ac59b59e21238c28ea661356d3bbb4178706cd29bebe6c6bed.svg" class="inline-math">, and all variables in the conclusion of <img src="img-math/f6d86a6f28fc28643c288e8b9fb3bcea657f2db64f517b5b434f99c922bf160d.svg" class="inline-math"> also occur in the premise.</div>
</li>
<li id="itm-datalog-with-choice">
<div class="paragraph">
<img src="img-math/f6d86a6f28fc28643c288e8b9fb3bcea657f2db64f517b5b434f99c922bf160d.svg" class="inline-math"> is a <em>Datalog sequent with choice</em> if all atoms in <img src="img-math/f6d86a6f28fc28643c288e8b9fb3bcea657f2db64f517b5b434f99c922bf160d.svg" class="inline-math"> are of the form <img src="img-math/7b60fb809a4f511c5fea9a685075798c4a7beb8be660a3690554b7122cfa1cdf.svg" class="inline-math"> or <img src="img-math/3847348cd93d06ac59b59e21238c28ea661356d3bbb4178706cd29bebe6c6bed.svg" class="inline-math">.</div>
</li>
</ol>
</div>
</div>
<div class="paragraph">
Note that in standard Datalog, usually only sequents with a single atom as conclusion are allowed.
However, our generalized Datalog sequents have the same descriptive power as standard Datalog, since a single sequent with <img src="img-math/509fe7e8ba852248c1de4dfc8c752f04a501aa15dc740f89268b2dd4cb0e9155.svg" class="inline-math"> conclusions can equivalently be replaced by <img src="img-math/509fe7e8ba852248c1de4dfc8c752f04a501aa15dc740f89268b2dd4cb0e9155.svg" class="inline-math"> sequents with single conclusions.
The name <em>Datalog with choice</em> in <a href="#itm-datalog-with-choice">3</a> alludes to the choice construct in Souffle [<a href="#souffle-choice">1</a>] with similar semantics.</div>
<div class="theorem-like theorem-style-definition">
<div class="paragraph">
<h4>Definition 41.
</h4>
An element <img src="img-math/113fb91cc7d1f6e0146fe362d9331a949fba05fa510417002447baa42cfb4d1f.svg" class="inline-math"> in a relational structure is <em>unbound</em> if it does not appear in any tuple <img src="img-math/ed30778bb92408a5f11dfb0d2bee4e5047be84be762d0348f788a721babc8535.svg" class="inline-math"> for all <img src="img-math/eb8a0ae53bfae72796e1352feea1dea35fd9884f2e749b6aeab6f52fd03277ab.svg" class="inline-math">.</div>
</div>
<div class="theorem-like theorem-style-definition">
<div class="paragraph">
<h4>Definition 42.
</h4>
A morphism <img src="img-math/48066c92e9c1389e9d01471a09b3377bc1b8af0ac5cb934e689031d4b7e0b765.svg" class="inline-math"> of relational structures is <em>injective</em> if <img src="img-math/2fc8944a69ab8ecefed8e427133b07f1fa857f568e6933cf69ecac510d406adb.svg" class="inline-math"> is an injective map for all <img src="img-math/d53b76ba7dd62a8b4c29d4609b13844e774a64afa734cc26b21e2fead3ebaacf.svg" class="inline-math">.</div>
</div>
<div class="theorem-like theorem-style-theorem">
<div class="paragraph">
<h4>Proposition 43.
</h4>
The classifying morphisms of Datalog sequents can be characterized up to isomorphism as follows:
<ol>
<li id="itm-semantics-datalog">
<div class="paragraph">
The classifying morphisms of Datalog sequents are precisely the injective surjective morphisms of finite relational structures that do not contain unbound variables.</div>
</li>
<li id="itm-semantics-datalog-with-sort-quantification">
<div class="paragraph">
The classifying morphisms of Datalog sequents with sort quantification are precisely the injective surjective morphisms of finite relational structures.</div>
</li>
<li id="itm-semantics-datalog-with-choice">
<div class="paragraph">
The classifying morphisms of Datalog sequents with choice are precisely the injective surjective morphisms of finite relational structures.</div>
</li>
</ol>



</div>
</div>
<div class="theorem-like theorem-style-definition">
<div class="paragraph">
<h4>Definition 44.
</h4>
A <em>setoid</em> consists of a set <img src="img-math/058a0e00a68e1131c9aa4f8bd9d0e56f03e14180114befecf4eccfefb05fb83d.svg" class="inline-math"> and an equivalence relation <img src="img-math/790e7fe250959eee5f1526a9fed44396f1f8d2fcf355e1403ef0522f01b7cc79.svg" class="inline-math"> on <img src="img-math/058a0e00a68e1131c9aa4f8bd9d0e56f03e14180114befecf4eccfefb05fb83d.svg" class="inline-math">.
A morphism <img src="img-math/48066c92e9c1389e9d01471a09b3377bc1b8af0ac5cb934e689031d4b7e0b765.svg" class="inline-math"> is a map of underlying sets that respects the equivalence relations.
Two morphisms <img src="img-math/b56fab323938458b38b4f57eb49a8300894db1b2625b2d4740ba22f01ccd365f.svg" class="inline-math"> of setoids are equal if <img src="img-math/538c5ca941e47f9fb746de33579fbb7c69aa6fbb215b99e52d4a30698a14cd9b.svg" class="inline-math"> for all <img src="img-math/113fb91cc7d1f6e0146fe362d9331a949fba05fa510417002447baa42cfb4d1f.svg" class="inline-math">.
The category of setoids is denoted by <img src="img-math/9e2312dd7c175db5706972c7f5862e83d1eeea22c24507a76927f3e15262854f.svg" class="inline-math">.</div>
</div>
<div id="prop-setoid-quotient-equivalence" class="theorem-like theorem-style-theorem">
<div class="paragraph">
<h4>Proposition 45.
</h4>
The categories <img src="img-math/9e2312dd7c175db5706972c7f5862e83d1eeea22c24507a76927f3e15262854f.svg" class="inline-math"> and <img src="img-math/722b686db72121b21d03fd570178bcf88cf932cd6f81f7f46a8a6d4fd3532c82.svg" class="inline-math"> are equivalent.
An equivalence is given by the functor <img src="img-math/aff05cb166e035f6c4f83ee0faca352386d9500bbb896101589288474a9ec204.svg" class="inline-math"> defined by <img src="img-math/876eb587a466648f4f79c972e7252c460279ce800f99eeeaffdd3986273b3ec1.svg" class="inline-math"> and the functor <img src="img-math/7fb62377b1b2d4ad9b258823a0d63f76683953b8dbe582f00fb9f61e880d42c5.svg" class="inline-math"> defined by <img src="img-math/b5cd423ef236d8abc0416f63acae8f96a55d8a5f54c4c00717a5fd31f02d83c5.svg" class="inline-math">.
</div>
</div>
<div id="def-setoid-transformation" class="theorem-like theorem-style-definition">
<div class="paragraph">
<h4>Definition 46.
</h4>
The <em>setoid transformation</em> of an RHL theory <img src="img-math/4e5b4bad957cd570519bf7c2ccc79708841c401e107a29138dcdf3074f76551e.svg" class="inline-math"> defined on a signature <img src="img-math/e94a30cee0214f847bdd9fd94bd185ce58e109ee4c9196e76f806ead42454c79.svg" class="inline-math"> is a Datalog with choice theory <img src="img-math/f24a7839080827e962f5824997687f4f6bc05f9bae00e47932450e60b837a389.svg" class="inline-math"> defined on a relational signature <img src="img-math/cbfabbb29da9f4535a9a58b92a3d92a678943b924cef71709a582e00078d4879.svg" class="inline-math"> as follows.
The signature <img src="img-math/cbfabbb29da9f4535a9a58b92a3d92a678943b924cef71709a582e00078d4879.svg" class="inline-math"> extends <img src="img-math/3f48b0f68758e065321bb41ffd846b3ae8096d7d26a252cc38ec1b01aaedf9a2.svg" class="inline-math"> by a relation symbol <img src="img-math/35121ea63e821f497ac49db17388c67da41e521e873c9af1928511085549a193.svg" class="inline-math"> for each sort <img src="img-math/d53b76ba7dd62a8b4c29d4609b13844e774a64afa734cc26b21e2fead3ebaacf.svg" class="inline-math">.
The sequents of <img src="img-math/f24a7839080827e962f5824997687f4f6bc05f9bae00e47932450e60b837a389.svg" class="inline-math"> are given as follows:
<ol>
<li id="itm-setoid-theory-equivalence">
<div class="paragraph">
For each sort <img src="img-math/c97a8fe633f85e531699955fb905d5a68ebdd81d9622ddcedb8f550da2473f85.svg" class="inline-math">, sequents asserting that <img src="img-math/a50df76b8191bd8b36228fa54c137a70529eb4635e49a2a5f53174063bbebb78.svg" class="inline-math"> is an equivalence relation:
<div class="display-math-row">
<img src="img-math/8cf4e1ff21b1400471269307e6a6a55068be5d67d4ad35e3f42072fe84afa9c8.svg">
</div></div>
</li>
<li id="itm-setoid-theory-congruence">
<div class="paragraph">
For each relation <img src="img-math/1811f68eb74929ecb6edffe855e69d59f231c07bbc85eda64f0b42728156e759.svg" class="inline-math">, a sequent asserting that the equivalence relations <img src="img-math/a50df76b8191bd8b36228fa54c137a70529eb4635e49a2a5f53174063bbebb78.svg" class="inline-math"> behave as congruences with respect to <img src="img-math/3a1de76e144a3a79a90c93f2763a2b1a152e8321cc10b1b6949020cbdd8b3ff7.svg" class="inline-math">:
<div class="display-math-row">
<img src="img-math/d1c95c72ef895627875652b2eef51cc18f5af5d6d26dba9ea0dfdf0cd1f9d18f.svg">
</div></div>
</li>
<li>
<div class="paragraph">
For each sequent <img src="img-math/f6d86a6f28fc28643c288e8b9fb3bcea657f2db64f517b5b434f99c922bf160d.svg" class="inline-math"> in <img src="img-math/4e5b4bad957cd570519bf7c2ccc79708841c401e107a29138dcdf3074f76551e.svg" class="inline-math">, the sequent which is obtained from <img src="img-math/f6d86a6f28fc28643c288e8b9fb3bcea657f2db64f517b5b434f99c922bf160d.svg" class="inline-math"> by replacing each equality atom <img src="img-math/9cd2b0fcede7653e1b74d39d80f93075066d668d15e1482494016ff0f94e433f.svg" class="inline-math"> with the atom <img src="img-math/129ed8219a8ef54f3d860158e34778c66337a20ff447a8a78a403aa7b5625252.svg" class="inline-math">, where <img src="img-math/c97a8fe633f85e531699955fb905d5a68ebdd81d9622ddcedb8f550da2473f85.svg" class="inline-math"> is the sort of <img src="img-math/3fc9857a0a4cb8aa18910afc040daa9ceaa9be94fb1f436d1beef9da603fae45.svg" class="inline-math"> and <img src="img-math/35611dd170074cd8301fedd4d5924c6cebf1fa1d77e601af80bff825c42676a9.svg" class="inline-math">.</div>
</li>
</ol>

The <em>category of setoid models</em> <img src="img-math/36285aad81ba673aeab3b3c9dab7f20eaef86b0acb37145b33c41ccf0d754960.svg" class="inline-math"> is given by the models of <img src="img-math/ab3dd81a7c311e54dd69f2b81062eeb8280426c24928eae5ad6a08e457282453.svg" class="inline-math">, where we consider morphisms <img src="img-math/b56fab323938458b38b4f57eb49a8300894db1b2625b2d4740ba22f01ccd365f.svg" class="inline-math"> as equal if <img src="img-math/2cbed36f6a251ff5773d4d4d00a271b951fdc07b8277de94b056f2eda7724bad.svg" class="inline-math"> are equal as setoid morphisms for all sorts <img src="img-math/c97a8fe633f85e531699955fb905d5a68ebdd81d9622ddcedb8f550da2473f85.svg" class="inline-math">.</div>
</div>
<div id="prop-setoid-model-equivalence" class="theorem-like theorem-style-theorem">
<div class="paragraph">
<h4>Proposition 47.
</h4>
Let <img src="img-math/72bb8e5b66461b29c01b0b449190df7b0e8b2c1c35997d0b3dbea7039d447f66.svg" class="inline-math"> be an RHL theory.
Then <img src="img-math/36285aad81ba673aeab3b3c9dab7f20eaef86b0acb37145b33c41ccf0d754960.svg" class="inline-math"> and <img src="img-math/da6f42262b7bed8fc1e0b8ced99c90975d1d5d6f94f3e1b9a481ba4f5c078b24.svg" class="inline-math"> are equivalent categories.</div>
<div class="paragraph">
An equivalence is given as follows.
The functor <img src="img-math/dfcc6d405d1461925dc118e65554a95301cdc2aab749f056fc4503cf05ec47a3.svg" class="inline-math"> extends a relational <img src="img-math/3f48b0f68758e065321bb41ffd846b3ae8096d7d26a252cc38ec1b01aaedf9a2.svg" class="inline-math">-structure <img src="img-math/058a0e00a68e1131c9aa4f8bd9d0e56f03e14180114befecf4eccfefb05fb83d.svg" class="inline-math"> to a relational <img src="img-math/cbfabbb29da9f4535a9a58b92a3d92a678943b924cef71709a582e00078d4879.svg" class="inline-math">-structure <img src="img-math/aaf41e75007e8b35fea4ee7af4de5e9fdd76690dca7fa0570b74cec33fab10df.svg" class="inline-math"> on the same carrier by <img src="img-math/d3d32ea7e070e8401c56b20a633e306ad74a0a6af8cc236c33a0a1953d16102b.svg" class="inline-math"> for all sorts <img src="img-math/d53b76ba7dd62a8b4c29d4609b13844e774a64afa734cc26b21e2fead3ebaacf.svg" class="inline-math">.
The functor <img src="img-math/2d4ff0688e6ea4f7a433ff77eb964489f1137528d2ecf98cf70e30261327d945.svg" class="inline-math"> assigns to a setoid mdel <img src="img-math/114fcb6328c864abf62596ade0d8558d94cfc13aad67dd29fc29433ac30f5146.svg" class="inline-math"> the relational <img src="img-math/3f48b0f68758e065321bb41ffd846b3ae8096d7d26a252cc38ec1b01aaedf9a2.svg" class="inline-math">-structure with carriers <img src="img-math/d394500fd44e1d058797610ad5097184e6dc94f40a2fb731672143076fb3f5fb.svg" class="inline-math"> and relations <img src="img-math/ec6e335fc5a03e53aea96f6dde4f31c418f260c7e125f88856611134dd6d487f.svg" class="inline-math">.</div>
</div>
<div class="proof">
<div class="paragraph">
<i class="proof">Proof.</i>
We must first verify that <img src="img-math/0bd1dd014813dbf1a42b3c0b20825409b27936aa98f9d794ad95bf959fb2d714.svg" class="inline-math"> and <img src="img-math/64ca379cf1c6924c8d37743a885e69f21e7591c2545042fa2acd48b58ce9cd51.svg" class="inline-math"> are well-defined, i.e. that the relational structures in their images are indeed models of the respective theories.
This is clear for <img src="img-math/0bd1dd014813dbf1a42b3c0b20825409b27936aa98f9d794ad95bf959fb2d714.svg" class="inline-math">.</div>
<div class="paragraph">
Let <img src="img-math/ef78d28c51d284b15776c296491236ae10808cafb103fd4009453d8b412aa47f.svg" class="inline-math"> for <img src="img-math/8c5b9ef95642fa35f28af00188798861c718733b585ee23f7d91eaeb6cdb32e1.svg" class="inline-math">.
Let <img src="img-math/49d82e153ba9554774e5cf42f2a25ead34b1889dbce1ca32cde9582177e2e192.svg" class="inline-math"> be a formula for the signature <img src="img-math/3f48b0f68758e065321bb41ffd846b3ae8096d7d26a252cc38ec1b01aaedf9a2.svg" class="inline-math"> and let <img src="img-math/f6cf97bfa9e50ab18203d10ce01677a20c00e3c84b54146a8e4d73ea55dc8db9.svg" class="inline-math"> be an interpretation of <img src="img-math/49d82e153ba9554774e5cf42f2a25ead34b1889dbce1ca32cde9582177e2e192.svg" class="inline-math"> in <img src="img-math/114fcb6328c864abf62596ade0d8558d94cfc13aad67dd29fc29433ac30f5146.svg" class="inline-math">.
Since the carriers of <img src="img-math/114fcb6328c864abf62596ade0d8558d94cfc13aad67dd29fc29433ac30f5146.svg" class="inline-math"> are defined as quotients of the carriers of <img src="img-math/058a0e00a68e1131c9aa4f8bd9d0e56f03e14180114befecf4eccfefb05fb83d.svg" class="inline-math">, every interpretation <img src="img-math/f6cf97bfa9e50ab18203d10ce01677a20c00e3c84b54146a8e4d73ea55dc8db9.svg" class="inline-math"> of <img src="img-math/49d82e153ba9554774e5cf42f2a25ead34b1889dbce1ca32cde9582177e2e192.svg" class="inline-math"> in <img src="img-math/114fcb6328c864abf62596ade0d8558d94cfc13aad67dd29fc29433ac30f5146.svg" class="inline-math"> lifts to an interpretation <img src="img-math/728249064090bd559518be7347eebaa2dc2c1b061c93be77f4aad85dcea5fe79.svg" class="inline-math"> of the same set of variables in <img src="img-math/058a0e00a68e1131c9aa4f8bd9d0e56f03e14180114befecf4eccfefb05fb83d.svg" class="inline-math">, so that we have <img src="img-math/a861f195df7fa6e20a4b8997e76379eb4e4bbacd17a83e739f02269638d49b0e.svg" class="inline-math"> for all variables <img src="img-math/35611dd170074cd8301fedd4d5924c6cebf1fa1d77e601af80bff825c42676a9.svg" class="inline-math">.
Note that <img src="img-math/728249064090bd559518be7347eebaa2dc2c1b061c93be77f4aad85dcea5fe79.svg" class="inline-math"> is an interpretation of the set of variables of <img src="img-math/49d82e153ba9554774e5cf42f2a25ead34b1889dbce1ca32cde9582177e2e192.svg" class="inline-math">, but not always of the formula <img src="img-math/49d82e153ba9554774e5cf42f2a25ead34b1889dbce1ca32cde9582177e2e192.svg" class="inline-math">.
Let <img src="img-math/f5224e46560312775de0cef6b6a0b6775bffbf0b0c48d6d096bcbc58bae0c9a8.svg" class="inline-math"> be the formula obtained from <img src="img-math/49d82e153ba9554774e5cf42f2a25ead34b1889dbce1ca32cde9582177e2e192.svg" class="inline-math"> by replacing every equality atom <img src="img-math/9cd2b0fcede7653e1b74d39d80f93075066d668d15e1482494016ff0f94e433f.svg" class="inline-math"> by the atom <img src="img-math/129ed8219a8ef54f3d860158e34778c66337a20ff447a8a78a403aa7b5625252.svg" class="inline-math">, where <img src="img-math/c97a8fe633f85e531699955fb905d5a68ebdd81d9622ddcedb8f550da2473f85.svg" class="inline-math"> is the sort of <img src="img-math/3fc9857a0a4cb8aa18910afc040daa9ceaa9be94fb1f436d1beef9da603fae45.svg" class="inline-math"> and <img src="img-math/35611dd170074cd8301fedd4d5924c6cebf1fa1d77e601af80bff825c42676a9.svg" class="inline-math">.
We claim that <img src="img-math/728249064090bd559518be7347eebaa2dc2c1b061c93be77f4aad85dcea5fe79.svg" class="inline-math"> is an interpretation of <img src="img-math/f5224e46560312775de0cef6b6a0b6775bffbf0b0c48d6d096bcbc58bae0c9a8.svg" class="inline-math">.
To show this, it suffices to consider the case where <img src="img-math/49d82e153ba9554774e5cf42f2a25ead34b1889dbce1ca32cde9582177e2e192.svg" class="inline-math"> is an atom:
<ul>
<li>
<div class="paragraph">
If <img src="img-math/ecc005b29071b602154ff7a7ec71a9235f42e1d4d41663278573346a4e940fc3.svg" class="inline-math">, then <img src="img-math/b04d57a239523b5511154fba2941191a9ab389483b60c3229ed5a7f548735f31.svg" class="inline-math">, so <img src="img-math/adb5782a8d8fd0ad9fb77c0d9da342f24b14efd02bffb5ecba741295bc984e1f.svg" class="inline-math">.
Thus <img src="img-math/21c7ca77187d73e17f26435c4624e09f154dac8c7cdb37396eb22cbdd57a47fd.svg" class="inline-math"> and <img src="img-math/1fb12cdd722db97095a40c2481d06fd21b47e2695d98c109025d9cbec41d2b26.svg" class="inline-math"> are in the same equivalence class, that is, <img src="img-math/8cdf36f7ab6e6990e961783fde47f1c40ee2085cdd282643892af45b1cacd85c.svg" class="inline-math">.</div>
</li>
<li>
<div class="paragraph">
If <img src="img-math/f5febbc7d312462849d99e73e174ee56e79ecbe6415706d50c28cae0a5045a78.svg" class="inline-math"> for some relation symbol <img src="img-math/3a1de76e144a3a79a90c93f2763a2b1a152e8321cc10b1b6949020cbdd8b3ff7.svg" class="inline-math">, then <img src="img-math/0c402e3f34984131ce441a02e422ad2834ed81c1b5a6dfc37a0eed22d98a1efd.svg" class="inline-math">.
By definition of <img src="img-math/4c2e65ce670f4149d053f1213ff22dff0c01c2cf47d67a61b068e5c8d29a6885.svg" class="inline-math">, there exist <img src="img-math/c9d52d356a758323c7792f80562f25f7c9ff5b52e39edd8bfadc5ec8a93c53b4.svg" class="inline-math"> such that <img src="img-math/df4c32305f80e68b4cc18ec3ed4e498994905d5500f48ced3b2384ca4003b764.svg" class="inline-math"> and <img src="img-math/320e3660b6689f272e73e4417ec601693f3520e68490349f1ea453d382918fca.svg" class="inline-math">.
Thus <img src="img-math/5da7491024ddf286384db9043c2cfabd199a6ee3aa5d019e09828fca0db69e5a.svg" class="inline-math">, so we have <img src="img-math/7e1a35d3501513a15c73c98694885c20944b0ccfbe718e56d228920ed57078bb.svg" class="inline-math"> for all <img src="img-math/d42d5862aea05b2fd7aa9c5bb07e9c13754585c17cee2cf95c36c2d9fc35ebeb.svg" class="inline-math">.
Since <img src="img-math/058a0e00a68e1131c9aa4f8bd9d0e56f03e14180114befecf4eccfefb05fb83d.svg" class="inline-math"> satisfies the congruence sequents <a href="#itm-setoid-theory-congruence">2</a>, <img src="img-math/4c2e65ce670f4149d053f1213ff22dff0c01c2cf47d67a61b068e5c8d29a6885.svg" class="inline-math"> is closed under equivalence in each argument, hence <img src="img-math/5d5e7400e0ae4b3e42781bd90440e37d99d4d51d94bfcfc062e82583cc86c0bf.svg" class="inline-math">.
Thus <img src="img-math/728249064090bd559518be7347eebaa2dc2c1b061c93be77f4aad85dcea5fe79.svg" class="inline-math"> is an interpretation of <img src="img-math/f5224e46560312775de0cef6b6a0b6775bffbf0b0c48d6d096bcbc58bae0c9a8.svg" class="inline-math">.</div>
</li>
<li>
<div class="paragraph">
The case <img src="img-math/9235c85f8591102e640b898c38f52e01fe87383027c29726daf8e65626494996.svg" class="inline-math"> is trivial.</div>
</li>
</ul>

Conversely, every interpretation <img src="img-math/728249064090bd559518be7347eebaa2dc2c1b061c93be77f4aad85dcea5fe79.svg" class="inline-math"> of <img src="img-math/f5224e46560312775de0cef6b6a0b6775bffbf0b0c48d6d096bcbc58bae0c9a8.svg" class="inline-math"> in <img src="img-math/058a0e00a68e1131c9aa4f8bd9d0e56f03e14180114befecf4eccfefb05fb83d.svg" class="inline-math"> descends to an interpretation of <img src="img-math/f6cf97bfa9e50ab18203d10ce01677a20c00e3c84b54146a8e4d73ea55dc8db9.svg" class="inline-math"> of <img src="img-math/49d82e153ba9554774e5cf42f2a25ead34b1889dbce1ca32cde9582177e2e192.svg" class="inline-math"> in <img src="img-math/114fcb6328c864abf62596ade0d8558d94cfc13aad67dd29fc29433ac30f5146.svg" class="inline-math"> by setting <img src="img-math/517a696150a8350009c8d5c10c6b47dc786923a18c034f259483e0d364fd00cd.svg" class="inline-math">.</div>
<div class="paragraph">
Now, let <img src="img-math/121cfe734ff5ad02c5c220036e8387f3cd32c0d74ea3fcafefc50437b8f7e11e.svg" class="inline-math"> be a sequent in <img src="img-math/4e5b4bad957cd570519bf7c2ccc79708841c401e107a29138dcdf3074f76551e.svg" class="inline-math">, and let <img src="img-math/f6cf97bfa9e50ab18203d10ce01677a20c00e3c84b54146a8e4d73ea55dc8db9.svg" class="inline-math"> be an interpretation of <img src="img-math/49d82e153ba9554774e5cf42f2a25ead34b1889dbce1ca32cde9582177e2e192.svg" class="inline-math"> in <img src="img-math/c6eb7e5a87ecea5691b08de9cebd5a960e4421e419eaa2be77903876c7ef02f5.svg" class="inline-math">.
We have just shown that <img src="img-math/728249064090bd559518be7347eebaa2dc2c1b061c93be77f4aad85dcea5fe79.svg" class="inline-math"> lifts to an interpretation of <img src="img-math/f5224e46560312775de0cef6b6a0b6775bffbf0b0c48d6d096bcbc58bae0c9a8.svg" class="inline-math"> in <img src="img-math/058a0e00a68e1131c9aa4f8bd9d0e56f03e14180114befecf4eccfefb05fb83d.svg" class="inline-math">.
Because <img src="img-math/058a0e00a68e1131c9aa4f8bd9d0e56f03e14180114befecf4eccfefb05fb83d.svg" class="inline-math"> satisfies <img src="img-math/c47f07fd2f060aef2d1554a013ca5b733baf087e4a73352dc8a57be6b3f71072.svg" class="inline-math">, we can extend <img src="img-math/728249064090bd559518be7347eebaa2dc2c1b061c93be77f4aad85dcea5fe79.svg" class="inline-math"> to an interpretation <img src="img-math/945bff13137e568af05089a5b61d6cb6bc985da73bb66a6ffbbd1c02c17d3b9f.svg" class="inline-math"> of <img src="img-math/d47fc42374e93361542bd41ac4a928e7a10da5d9c29ee593537124036e7cfb1d.svg" class="inline-math"> in <img src="img-math/058a0e00a68e1131c9aa4f8bd9d0e56f03e14180114befecf4eccfefb05fb83d.svg" class="inline-math">, and then <img src="img-math/945bff13137e568af05089a5b61d6cb6bc985da73bb66a6ffbbd1c02c17d3b9f.svg" class="inline-math"> descends to an interpretation of <img src="img-math/f01bc8a000c08d15aed25ef15f5acd71cf0134bc807b3f0564102b2ed8197abc.svg" class="inline-math"> in <img src="img-math/114fcb6328c864abf62596ade0d8558d94cfc13aad67dd29fc29433ac30f5146.svg" class="inline-math"> that extends <img src="img-math/f6cf97bfa9e50ab18203d10ce01677a20c00e3c84b54146a8e4d73ea55dc8db9.svg" class="inline-math">.
Thus <img src="img-math/64ca379cf1c6924c8d37743a885e69f21e7591c2545042fa2acd48b58ce9cd51.svg" class="inline-math"> is well-defined.</div>
<div class="paragraph">
The composition <img src="img-math/7353bf419cb0123af0c75c82e74e4a16a8377c8d8568fc63dac293244d4f4721.svg" class="inline-math"> is equivalent to the identity functor since a quotient by the diagonal does not change the original set.
As for <img src="img-math/69a78583d3c8a31c67d062a91128e2baedcc92212980cd48f9e240977025302f.svg" class="inline-math">, note that there is a canonical map <img src="img-math/7a6b5259e1f14b77017163d4375509b5eb187db22593b919af13a0f7b0a963b4.svg" class="inline-math"> for all setoid models <img src="img-math/058a0e00a68e1131c9aa4f8bd9d0e56f03e14180114befecf4eccfefb05fb83d.svg" class="inline-math">.
The restriction <img src="img-math/1c5d377569e0a1011d0559bfc16e1d2ba30ae0b75df91c73c42673433e75349f.svg" class="inline-math"> of <img src="img-math/f2738b187b384a32bc0ae64c168ec48b7bb1dcd95d507720952f97e1cfe178ee.svg" class="inline-math"> to a setoid carrier <img src="img-math/82d2663f0a18f1afb23d4608eea0815a1bfa308d6078e178ec11647237a33510.svg" class="inline-math"> is an isomorphism of setoids for all sorts <img src="img-math/c97a8fe633f85e531699955fb905d5a68ebdd81d9622ddcedb8f550da2473f85.svg" class="inline-math">, with inverses <img src="img-math/2cd986d202ee03d33482e2b9a6be1d56829ff948842ab660f5d75b5e962ec5a7.svg" class="inline-math"> given by a choice of representative in each equivalence class.
Since the relations of <img src="img-math/058a0e00a68e1131c9aa4f8bd9d0e56f03e14180114befecf4eccfefb05fb83d.svg" class="inline-math"> are closed under equivalence in each argument, it follows that <img src="img-math/177573b798181d45acc4d40ee1d44a201a42e266a3bf77e23894840c697c4e3a.svg" class="inline-math"> is a morphism of relational structures.
Thus <img src="img-math/f2738b187b384a32bc0ae64c168ec48b7bb1dcd95d507720952f97e1cfe178ee.svg" class="inline-math"> and <img src="img-math/177573b798181d45acc4d40ee1d44a201a42e266a3bf77e23894840c697c4e3a.svg" class="inline-math"> are isomorphisms.</div>
</div>
<div id="cor-setoid-model-free" class="theorem-like theorem-style-theorem">
<div class="paragraph">
<h4>Corollary 48.
</h4>
Let <img src="img-math/72bb8e5b66461b29c01b0b449190df7b0e8b2c1c35997d0b3dbea7039d447f66.svg" class="inline-math"> be an RHL theory with setoid transformation <img src="img-math/ab3dd81a7c311e54dd69f2b81062eeb8280426c24928eae5ad6a08e457282453.svg" class="inline-math">.
Then the reflection <img src="img-math/fd73116fad7fac50902e97636224bea3153d79e01f6e315eda6c37f50dade4b7.svg" class="inline-math"> can be computed as composite
<div class="display-math-row">
<img src="img-math/4683ea9ef49916d25e794a376ce27ea671483a27237cfdb684d5c55c5811efaa.svg">
</div>
where
<ul>
<li>
<div class="paragraph">
<img src="img-math/4e07e888ccd254b7ef20173583c358c4a07d129f1a31ddf510e3ba1640c6e76e.svg" class="inline-math"> is the functors that extends relational <img src="img-math/3f48b0f68758e065321bb41ffd846b3ae8096d7d26a252cc38ec1b01aaedf9a2.svg" class="inline-math">-structures <img src="img-math/058a0e00a68e1131c9aa4f8bd9d0e56f03e14180114befecf4eccfefb05fb83d.svg" class="inline-math"> to relational <img src="img-math/cbfabbb29da9f4535a9a58b92a3d92a678943b924cef71709a582e00078d4879.svg" class="inline-math">-structures with empty relations <img src="img-math/a50df76b8191bd8b36228fa54c137a70529eb4635e49a2a5f53174063bbebb78.svg" class="inline-math">,</div>
</li>
<li>
<div class="paragraph">
<img src="img-math/d717113a9551cd127bdc0c3f8919aee0b3e094c72f111fe3ece62bb93644f4eb.svg" class="inline-math"> is the free <img src="img-math/f24a7839080827e962f5824997687f4f6bc05f9bae00e47932450e60b837a389.svg" class="inline-math">-model functor, and</div>
</li>
<li>
<div class="paragraph">
<img src="img-math/bc68c787cde8c0c0c9b3196c249925ce3284ea5137a2a934782c7aa64629b489.svg" class="inline-math"> is one half of the equivalence constructed in Proposition <a href="#prop-setoid-model-equivalence">47</a>.</div>
</li>
</ul>
</div>
</div>
<div class="proof">
<div class="paragraph">
<i class="proof">Proof.</i>
<img src="img-math/4e07e888ccd254b7ef20173583c358c4a07d129f1a31ddf510e3ba1640c6e76e.svg" class="inline-math"> and <img src="img-math/d717113a9551cd127bdc0c3f8919aee0b3e094c72f111fe3ece62bb93644f4eb.svg" class="inline-math"> are left adjoints and <img src="img-math/bc68c787cde8c0c0c9b3196c249925ce3284ea5137a2a934782c7aa64629b489.svg" class="inline-math"> is an equivalence.
The composite of the respective right adjoints is the inclusion <img src="img-math/d0617c25bf2c9507c6deec02d26d01a0e896ea8baa787748cbbff41c95acf7a9.svg" class="inline-math">, so the composite of the <img src="img-math/26c1470e7cb6218df782164e61f12505402fc87494efdbbf612515c85518b197.svg" class="inline-math"> is the reflection into <img src="img-math/da6f42262b7bed8fc1e0b8ced99c90975d1d5d6f94f3e1b9a481ba4f5c078b24.svg" class="inline-math">.</div>
</div>
<div class="theorem-like theorem-style-remark">
<div class="paragraph">
<h4>Remark 49.
</h4>
Proposition <a href="#prop-setoid-model-equivalence">47</a> shows that RHL can be reduced to Datalog (with minor extensions).
In practice, however, using the resulting Datalog programs to compute free models is often unfeasible even for small inputs.</div>
<div class="paragraph">
One issue is that storing the equivalence relations <img src="img-math/a50df76b8191bd8b36228fa54c137a70529eb4635e49a2a5f53174063bbebb78.svg" class="inline-math"> naively requires quadratic memory with respect to the size of equivalence classes.
This problem can be largely addressed by using a union-find data structure, which only requires linear memory.
Union-find data structures are available in the Souffle Datalog engine [<a href="#souffle-union-find">5</a>].</div>
<div class="paragraph">
A more significant issue are the congruence axioms <a href="#itm-setoid-theory-congruence">2</a>, which result in an exponential increase in memory requirements with respect to the arity of relations.
Every equality inferred during evaluation can significantly increase the total size of the relational structure in the next stage.
Semantically, however, every inferred equality should in fact <em>reduce</em> the size of the relational structure at the next stage.
The Eqlog engine, which evaluates RHL theories directly, takes advantage of this observation by maintaining a union-find data structure on each sort, allowing for a canonical representative of each equivalence class.
The relations then contain entries only for these canonical representatives.
An inferred equality results in a merge of two equivalence classes, with one of the canonical representatives ceasing to be representative.
Eqlog then <em>canonicalizes</em> all tuples by replacing each occurrence of the old representative with the new representative.
Since relations are stored without duplicates, this often results in a decrease in the size of the relations, so that later stages can be computed faster.</div>
</div>
<div class="theorem-like theorem-style-remark">
<div class="paragraph">
<h4>Remark 50.
</h4>
The following alternative <em>sparse</em> setoid transformation <img src="img-math/d211001ebf41036de8bacdeb7246dfba4b1ef2895726d89445c12c2c7fb7f5ee.svg" class="inline-math"> of an RHL theory <img src="img-math/72bb8e5b66461b29c01b0b449190df7b0e8b2c1c35997d0b3dbea7039d447f66.svg" class="inline-math"> can result in a more efficient Datalog program.
The signature <img src="img-math/cbfabbb29da9f4535a9a58b92a3d92a678943b924cef71709a582e00078d4879.svg" class="inline-math"> of the sparse setoid transformation is the same as in the standard setoid transformation (Definition <a href="#def-setoid-transformation">46</a>), so <img src="img-math/cbfabbb29da9f4535a9a58b92a3d92a678943b924cef71709a582e00078d4879.svg" class="inline-math"> contains additional equivalence relations <img src="img-math/a50df76b8191bd8b36228fa54c137a70529eb4635e49a2a5f53174063bbebb78.svg" class="inline-math"> for all sorts <img src="img-math/c97a8fe633f85e531699955fb905d5a68ebdd81d9622ddcedb8f550da2473f85.svg" class="inline-math">.
As before, <img src="img-math/70af2828b2e4d676a41d5df95e3c48bcb86dd3b65a268e8f5c14fd0c6aec78c7.svg" class="inline-math"> contains the equivalence relation axioms <a href="#itm-setoid-theory-equivalence">1</a>.
However, the congruence axioms <a href="#itm-setoid-theory-congruence">2</a> are omitted.</div>
<div class="paragraph">
Instead, we modify the premise of each sequent <img src="img-math/121cfe734ff5ad02c5c220036e8387f3cd32c0d74ea3fcafefc50437b8f7e11e.svg" class="inline-math"> in <img src="img-math/4e5b4bad957cd570519bf7c2ccc79708841c401e107a29138dcdf3074f76551e.svg" class="inline-math"> so that the different occurences of a variable can be interpreted by distinct but equivalent elements.
As before, we replace equality atoms <img src="img-math/9cd2b0fcede7653e1b74d39d80f93075066d668d15e1482494016ff0f94e433f.svg" class="inline-math"> by atoms <img src="img-math/129ed8219a8ef54f3d860158e34778c66337a20ff447a8a78a403aa7b5625252.svg" class="inline-math"> in premise and conclusion.
Next, for each variable <img src="img-math/35611dd170074cd8301fedd4d5924c6cebf1fa1d77e601af80bff825c42676a9.svg" class="inline-math"> that occurs <img src="img-math/97cf4bb3132b254ec1ba3c1b9bb9ad4160c43e821c1ed102d698e4f63d1cfa52.svg" class="inline-math"> times in the premise <img src="img-math/49d82e153ba9554774e5cf42f2a25ead34b1889dbce1ca32cde9582177e2e192.svg" class="inline-math">, we choose a list <img src="img-math/261eeee0b5afe580c6e61512ff0fb648202c5a212ee61c05de362f3b8ad714e1.svg" class="inline-math"> of variables of the same sort, where <img src="img-math/e0972a15dbd0c9bf7d1c0e514ec522388c89383da38c58a0f669fdf55ee8fca6.svg" class="inline-math"> are fresh.
We now replace the <img src="img-math/d42d5862aea05b2fd7aa9c5bb07e9c13754585c17cee2cf95c36c2d9fc35ebeb.svg" class="inline-math">th occurence of <img src="img-math/35611dd170074cd8301fedd4d5924c6cebf1fa1d77e601af80bff825c42676a9.svg" class="inline-math"> in <img src="img-math/49d82e153ba9554774e5cf42f2a25ead34b1889dbce1ca32cde9582177e2e192.svg" class="inline-math"> with <img src="img-math/82b3b2660b2da5de663dae7feae1cc541b1cd561157597e838dfa365d3536b0b.svg" class="inline-math">, and add the atoms <img src="img-math/c8d40f4919e789095702618d707370661d88c8983598b51d78986adc34b7577e.svg" class="inline-math"> for all <img src="img-math/9abe15d98eca72a8095dac7f444788dcf418bff1a96bc03735868db57b11e267.svg" class="inline-math"> to <img src="img-math/49d82e153ba9554774e5cf42f2a25ead34b1889dbce1ca32cde9582177e2e192.svg" class="inline-math">.</div>
<div class="paragraph">
The transformed premises <img src="img-math/ca7a980873f70e42e0bedce1bbd301f1a1a83e8a0255a8beda16592acdf664a2.svg" class="inline-math"> have the following property:
If <img src="img-math/058a0e00a68e1131c9aa4f8bd9d0e56f03e14180114befecf4eccfefb05fb83d.svg" class="inline-math"> is a relational <img src="img-math/cbfabbb29da9f4535a9a58b92a3d92a678943b924cef71709a582e00078d4879.svg" class="inline-math">-structure that satisfies the equivalence relation axioms and <img src="img-math/d0b31c01839fd24e6dc36aeb07092113a56fd1d7f4fb25158fbf6eafa17b90c9.svg" class="inline-math"> is the relational structure over <img src="img-math/058a0e00a68e1131c9aa4f8bd9d0e56f03e14180114befecf4eccfefb05fb83d.svg" class="inline-math"> that furthermore satisfies the congruence axioms, then maps <img src="img-math/09751aff796728dbcb5eabcdfd490cc6502ab739567ffc58b5047ec432dff724.svg" class="inline-math"> are in bijection to maps <img src="img-math/fd42e73c1bbd812131864ff03b2db1e852af33d152f5192ded02a824b437d14d.svg" class="inline-math"> up to setoid morphism equality.
From this it follows that Corollary <a href="#cor-setoid-model-free">48</a> holds also for the sparse transformation <img src="img-math/d211001ebf41036de8bacdeb7246dfba4b1ef2895726d89445c12c2c7fb7f5ee.svg" class="inline-math">.</div>
<div class="paragraph">
The sparse transformation avoids duplication in many cases, but data that can be infered twice for different but equivalent elements is still duplicated.
Furthermore, the transformed premises <img src="img-math/ca7a980873f70e42e0bedce1bbd301f1a1a83e8a0255a8beda16592acdf664a2.svg" class="inline-math"> can be more computationally expensive to match because all elements in an equivalence class must be considered for every occurence of a variable in the original premise <img src="img-math/49d82e153ba9554774e5cf42f2a25ead34b1889dbce1ca32cde9582177e2e192.svg" class="inline-math">.</div>
</div>
<h2 id="sec-phl">
4 Partial Horn Logic</h2>
<div class="paragraph">
Partial Horn logic is one of the many equivalent notions of essentially algebraic theory.
It was initially defined by Palmgren and Vickers [<a href="#phl">6</a>], who proved its equivalence to essentially algebraic theories.
Here we shall understand PHL as a syntactic extension, as <em>syntactic sugar</em>, over RHL.
The advantages of PHL, then, are entirely syntactical.
</div>
<div class="paragraph">
Observe that it cannot be read off from the individual sequents whether or not an RHL theory is strong or not.
Instead, one has to consider the interplay between the different sequents of the theory.
As a result, it is computationally undecidable whether or not a given RHL theory is strong.</div>
<div class="paragraph">
Our application for the semantics developed in this paper are tools that allow computations based on the small object argument.
Such tools compute (fragments of) free models of user-defined theories that encode problem domains.
It is highly desirable that these theories are strong, since otherwise the result of the computation is not uniquely determined.
As strong RHL theories are difficult to recognize for both humans and computers, we argue that RHL is not directly suitable as an input theory language for this purpose.
What is needed, then, is a language with the same expressive power of RHL, but where an easily recognizable subset allows axiomatizing all strong theories.</div>
<div class="paragraph">
PHL is indeed such a language:
Proposition <a href="#prop-strong-rhl-to-epic-phl">79</a> shows that every strong RHL theory is equivalent to a PHL theory containing <em>epic</em> sequents only.
PHL sequents are epic if no new variables are introduced in the conclusion, which is a criterion that can be easily checked separately for each sequent without regard for the theory the sequent appears in.
If tools wish to allow only strong theories, they can use PHL as input language and reject non-epic sequents.
Note that there exist PHL theories containing non-epic sequents which are nevertheless strong, but such theories can be equivalently axiomatized as epic PHL theories.
Thus, no generality is lost compared to general strong theories when rejecting non-epic PHL theories.</div>
<h3>
4.1 Algebraic Structures</h3>
<div class="theorem-like theorem-style-definition">
<div class="paragraph">
<h4>Definition 51.
</h4>
An <em>algebraic signature</em> is a relational signature <img src="img-math/eaa90800500b39e1f64c7a4f56fc6d8fb4406167432d98ed4345fa3b623ce3a6.svg" class="inline-math"> equipped with a partition <img src="img-math/b22d1b8a5b58da4fa7917fcec6da2e4a6f29cba20c2da6b72808cecd3ecfa7be.svg" class="inline-math"> of the set of relation symbol into disjoint sets <img src="img-math/43f1b852b27a5479cbe90e9235d0656d0c5b9d6646a83a61a3a05312babfdcca.svg" class="inline-math"> of <em>predicate symbols</em> and <img src="img-math/0bd1dd014813dbf1a42b3c0b20825409b27936aa98f9d794ad95bf959fb2d714.svg" class="inline-math"> of <em>function symbols</em> such that the arity of every function symbol is non-empty.
If <img src="img-math/cebe1a6f2576c629b07e31999a198208dbdbcc147ec0905280df3d1a3db280b4.svg" class="inline-math"> is a function symbol, then we write <img src="img-math/5ee8866e1dfe3865555727ff685371b3eb0ce586e23dd774ddbb5f80fde0ee5a.svg" class="inline-math"> if the arity of <img src="img-math/f2738b187b384a32bc0ae64c168ec48b7bb1dcd95d507720952f97e1cfe178ee.svg" class="inline-math"> as a relation symbol is <img src="img-math/85b7fe30ab12e9ccee0c8e2280e633cc1d6cea397a57863c7d413847ef06ec6f.svg" class="inline-math">.</div>
</div>
<div class="theorem-like theorem-style-definition">
<div class="paragraph">
<h4>Definition 52.
</h4>
Let <img src="img-math/57be56542331f5965669fd42c05dc9eb578780d6a00c512ae9563f7bcb9c1a48.svg" class="inline-math"> be an algebraic signature.
An <em>algebraic structure</em> for <img src="img-math/3f48b0f68758e065321bb41ffd846b3ae8096d7d26a252cc38ec1b01aaedf9a2.svg" class="inline-math"> is a relational structure <img src="img-math/058a0e00a68e1131c9aa4f8bd9d0e56f03e14180114befecf4eccfefb05fb83d.svg" class="inline-math"> for <img src="img-math/3f48b0f68758e065321bb41ffd846b3ae8096d7d26a252cc38ec1b01aaedf9a2.svg" class="inline-math"> such that <img src="img-math/c0f5b52488e5c9a32f7ab912cf91d0a000f24683591ad980a99149718e77b10e.svg" class="inline-math"> is the graph of a partial function for all <img src="img-math/cebe1a6f2576c629b07e31999a198208dbdbcc147ec0905280df3d1a3db280b4.svg" class="inline-math">.
Thus if <img src="img-math/c14b202babafc2439123b33d9eedf7234cdb535380731c67d3e082f453c0c004.svg" class="inline-math"> and <img src="img-math/eb170447795f2c03a9ec3aab629d897824315f97a16f4eb3a12901bd4912cabc.svg" class="inline-math">, then <img src="img-math/347c05e046aef0585d7a96fce7a3eed4debb17bcf75c2debb704c7b6847c0a77.svg" class="inline-math">.
We use <img src="img-math/1563e96948000a7f3cedddf12b2ec0095cedcaa49507c77a0cd275f12824f248.svg" class="inline-math"> to denote the unique element <img src="img-math/806de71b4bf42a05afaf38d65f7d5757b9406f0f158ae8009f7a8e0a8d0752f0.svg" class="inline-math"> such that <img src="img-math/c14b202babafc2439123b33d9eedf7234cdb535380731c67d3e082f453c0c004.svg" class="inline-math">, and we write <img src="img-math/ac43ae8444cc6991a407fe89ba6aa28191448f6d07787a9bceac570692a4c383.svg" class="inline-math"> to say that such an element <img src="img-math/806de71b4bf42a05afaf38d65f7d5757b9406f0f158ae8009f7a8e0a8d0752f0.svg" class="inline-math"> exists.
A <em>morphism of algebraic structures</em> is a morphism of underlying relational structures.
The <em>category of algebraic structures</em> is denoted by <img src="img-math/e98208345d01f594a884d2497b3e2bc1c7692123a6ab42972037403c4772dea0.svg" class="inline-math">.</div>
</div>
<div class="paragraph">
If the algebraic signature <img src="img-math/3f48b0f68758e065321bb41ffd846b3ae8096d7d26a252cc38ec1b01aaedf9a2.svg" class="inline-math"> is clear from context, we abbreviate <img src="img-math/e98208345d01f594a884d2497b3e2bc1c7692123a6ab42972037403c4772dea0.svg" class="inline-math"> as <img src="img-math/54d26a1db1f4d0a8bcd7c74c824594696282b559cacb7a8b016d6dc5bfca1323.svg" class="inline-math">.</div>
<div id="prop-functionality-axioms" class="theorem-like theorem-style-theorem">
<div class="paragraph">
<h4>Proposition 53.
</h4>
Let <img src="img-math/57be56542331f5965669fd42c05dc9eb578780d6a00c512ae9563f7bcb9c1a48.svg" class="inline-math"> be an algebraic signature and let <img src="img-math/058a0e00a68e1131c9aa4f8bd9d0e56f03e14180114befecf4eccfefb05fb83d.svg" class="inline-math"> be a relational structure.
Then <img src="img-math/058a0e00a68e1131c9aa4f8bd9d0e56f03e14180114befecf4eccfefb05fb83d.svg" class="inline-math"> is an algebraic structure if and only if it satisfies the relational sequent
<div id="eq-functionality-axiom" class="display-math-row">
<span>(4)</span>
<img src="img-math/5aa02c62e5f8ce48b5275de2dd205083dbc48d3ab6244733da67dde87cff0fdb.svg">
<span>(4)</span>
</div>
for each function symbol <img src="img-math/5ee8866e1dfe3865555727ff685371b3eb0ce586e23dd774ddbb5f80fde0ee5a.svg" class="inline-math">.</div>
</div>
<div class="proof">
<div class="paragraph">
<i class="proof">Proof.</i>
The relational structure <img src="img-math/058a0e00a68e1131c9aa4f8bd9d0e56f03e14180114befecf4eccfefb05fb83d.svg" class="inline-math"> satisfies the sequent <a href="#eq-functionality-axiom">(4)</a> if and only if <img src="img-math/c0f5b52488e5c9a32f7ab912cf91d0a000f24683591ad980a99149718e77b10e.svg" class="inline-math"> is right-unique, i.e. the graph of a partial function.</div>
</div>
<div class="theorem-like theorem-style-theorem">
<div class="paragraph">
<h4>Corollary 54.
</h4>
Let <img src="img-math/57be56542331f5965669fd42c05dc9eb578780d6a00c512ae9563f7bcb9c1a48.svg" class="inline-math"> be an algebraic signature.
The category of algebraic structures is a reflective subcategory of the category of relational structures.
The reflections <img src="img-math/c88a664ac27498766abf9d0245a073217ed494bfc80579ace13dfbe49f37a21c.svg" class="inline-math"> of relational structure <img src="img-math/058a0e00a68e1131c9aa4f8bd9d0e56f03e14180114befecf4eccfefb05fb83d.svg" class="inline-math"> into <img src="img-math/54d26a1db1f4d0a8bcd7c74c824594696282b559cacb7a8b016d6dc5bfca1323.svg" class="inline-math"> are effective epimorphisms.</div>
</div>
<div class="proof">
<div class="paragraph">
<i class="proof">Proof.</i>
That every reflection is an effective epimorphisms follows from the fact that the classifying morphisms of the functionality axioms <a href="#eq-functionality-axiom">(4)</a> are effective epimorphisms, hence so are all coproducts, pushouts and (infinite) compositions thereof.</div>
</div>
<div class="paragraph">
We denote the free algebraic structure functor by <img src="img-math/f74750395f237b5a9f0224c2148d5f8b7d7a1991fe3517416ccc09dadf0e8c2a.svg" class="inline-math">.</div>
<div class="theorem-like theorem-style-theorem">
<div class="paragraph">
<h4>Corollary 55.
</h4>
Let <img src="img-math/57be56542331f5965669fd42c05dc9eb578780d6a00c512ae9563f7bcb9c1a48.svg" class="inline-math"> be an algebraic signature.
The category of algebraic structures is complete and cocomplete.</div>
</div>
<div class="proof">
<div class="paragraph">
<i class="proof">Proof.</i>
This follows from general facts about reflective subcatgories:
They are stable under limits, and colimits are computed by reflecting colimits of the ambient category.</div>
</div>
<h3>
4.2 Syntax and Semantics</h3>
<div class="theorem-like theorem-style-definition">
<div class="paragraph">
<h4>Definition 56.
</h4>
Let <img src="img-math/57be56542331f5965669fd42c05dc9eb578780d6a00c512ae9563f7bcb9c1a48.svg" class="inline-math"> be an algebraic signature.
The set of <em>terms</em> and a sort assigned to each term is given by the following recursive definition:
<ol>
<li>
<div class="paragraph">
If <img src="img-math/35611dd170074cd8301fedd4d5924c6cebf1fa1d77e601af80bff825c42676a9.svg" class="inline-math"> is a variable of sort <img src="img-math/c97a8fe633f85e531699955fb905d5a68ebdd81d9622ddcedb8f550da2473f85.svg" class="inline-math">, then <img src="img-math/35611dd170074cd8301fedd4d5924c6cebf1fa1d77e601af80bff825c42676a9.svg" class="inline-math"> is a term of sort <img src="img-math/c97a8fe633f85e531699955fb905d5a68ebdd81d9622ddcedb8f550da2473f85.svg" class="inline-math">.</div>
</li>
<li>
<div class="paragraph">
If <img src="img-math/5ee8866e1dfe3865555727ff685371b3eb0ce586e23dd774ddbb5f80fde0ee5a.svg" class="inline-math"> is a function symbol and <img src="img-math/2961d78d9419c3d149ad64efcfe8bcb4fe21cbb65054f80006a9066ba6f89b71.svg" class="inline-math"> are terms such that <img src="img-math/0d8b2b8c16ab242ed7b01ff8a5f0640269720d9e0c760318ce7df4fd6122df0e.svg" class="inline-math"> has sort <img src="img-math/baf65a1761f8845318b6d260476ad9483528d03101a79244cd644cd984f26f02.svg" class="inline-math"> for all <img src="img-math/6ab5ab6db18a0ea568c6809c397b607f697669b39881a4710a17d80b69e093cb.svg" class="inline-math">, then <img src="img-math/16fd927f9179196fff0fe89945a3d3d1273c881b17f5c3bcb9b965bca6767aee.svg" class="inline-math"> is a term of sort <img src="img-math/c97a8fe633f85e531699955fb905d5a68ebdd81d9622ddcedb8f550da2473f85.svg" class="inline-math">.</div>
</li>
</ol>

<em>Algebraic atoms, formulas and sequents</em> are defined as in Definition <a href="#def-relational-syntax">24</a>, but with two changes:
<ol>
<li>
<div class="paragraph">
In each type of atom, also composite terms of the same sort are allowed in place of only variables.</div>
</li>
<li>
<div class="paragraph">
An algebraic atom <img src="img-math/08d361dc22717c20069bd1af2506dac0ee7d0ca68248ba583b173133424f7512.svg" class="inline-math"> is valid only if <img src="img-math/2f6b67d9e241e741c746f1d72cb99068861b071c52d302229b7ff98fdeee0ea4.svg" class="inline-math"> is a predicate symbol, but not if <img src="img-math/3a1de76e144a3a79a90c93f2763a2b1a152e8321cc10b1b6949020cbdd8b3ff7.svg" class="inline-math"> is a function symbol.</div>
</li>
</ol>
</div>
</div>
<div class="theorem-like theorem-style-definition">
<div class="paragraph">
<h4>Definition 57.
</h4>
Let <img src="img-math/57be56542331f5965669fd42c05dc9eb578780d6a00c512ae9563f7bcb9c1a48.svg" class="inline-math"> be an algebraic signature and let <img src="img-math/058a0e00a68e1131c9aa4f8bd9d0e56f03e14180114befecf4eccfefb05fb83d.svg" class="inline-math"> be an algebraic structure.
An <em>interpretation of a term <img src="img-math/18e5e78375303bc5487910c10a2ce9e156e961a4865f78069b5e5d98e4281061.svg" class="inline-math"></em> in <img src="img-math/058a0e00a68e1131c9aa4f8bd9d0e56f03e14180114befecf4eccfefb05fb83d.svg" class="inline-math"> is an interpretation <img src="img-math/f6cf97bfa9e50ab18203d10ce01677a20c00e3c84b54146a8e4d73ea55dc8db9.svg" class="inline-math"> of the variables occuring in <img src="img-math/18e5e78375303bc5487910c10a2ce9e156e961a4865f78069b5e5d98e4281061.svg" class="inline-math"> such that the following recursive extension of <img src="img-math/f6cf97bfa9e50ab18203d10ce01677a20c00e3c84b54146a8e4d73ea55dc8db9.svg" class="inline-math"> is well-defined on <img src="img-math/18e5e78375303bc5487910c10a2ce9e156e961a4865f78069b5e5d98e4281061.svg" class="inline-math">:
<div class="display-math-row">
<img src="img-math/0f79b01dfe9cb128b62a834d1d899a661df4142e32982f685d2e6a87b2ddfe04.svg">
</div>
Note that the right-hand side might not be defined; in this case also the left-hand side is undefined.</div>
<div class="paragraph">
An <em>interpretation of an algebraic atom</em> in <img src="img-math/058a0e00a68e1131c9aa4f8bd9d0e56f03e14180114befecf4eccfefb05fb83d.svg" class="inline-math"> is defined analogously to the interpretation of a relational atom, but with the additional condition that the interpretation is defined on all (possibly composite) terms occuring in the atom.</div>
<div class="paragraph">
An <em>interpretation of an algebraic formula <img src="img-math/44c763111130122b65031bed2248460bf1dcf8c7ca72bbdc684b533107497c41.svg" class="inline-math"></em> is an interpretation of the variables occuring in <img src="img-math/49d82e153ba9554774e5cf42f2a25ead34b1889dbce1ca32cde9582177e2e192.svg" class="inline-math"> that restricts to an interpretation of <img src="img-math/07a47d98126e3bd35068f453fc1f4a459d9226bd9caf8ef8c35f8bc9ddda24e4.svg" class="inline-math"> for each <img src="img-math/ceec897e2982ac3e9a8a0fe65f23f5caaf56b422384e50d177d99b89ce584b59.svg" class="inline-math">.
An algebraic structure <img src="img-math/058a0e00a68e1131c9aa4f8bd9d0e56f03e14180114befecf4eccfefb05fb83d.svg" class="inline-math"> <em>satisfies</em> an algebraic sequent <img src="img-math/121cfe734ff5ad02c5c220036e8387f3cd32c0d74ea3fcafefc50437b8f7e11e.svg" class="inline-math"> if each interpretation of <img src="img-math/49d82e153ba9554774e5cf42f2a25ead34b1889dbce1ca32cde9582177e2e192.svg" class="inline-math"> in <img src="img-math/058a0e00a68e1131c9aa4f8bd9d0e56f03e14180114befecf4eccfefb05fb83d.svg" class="inline-math"> can be extended to an interpretation of <img src="img-math/7f15aa55cf7cd571a1dadd12329de73d6b63b9dc06d98c638307e005d819d980.svg" class="inline-math"> in <img src="img-math/058a0e00a68e1131c9aa4f8bd9d0e56f03e14180114befecf4eccfefb05fb83d.svg" class="inline-math">.</div>
</div>
<div id="def-flattening" class="theorem-like theorem-style-definition">
<div class="paragraph">
<h4>Definition 58.
</h4>
Let <img src="img-math/57be56542331f5965669fd42c05dc9eb578780d6a00c512ae9563f7bcb9c1a48.svg" class="inline-math"> be an algebraic signature, and let <img src="img-math/18e5e78375303bc5487910c10a2ce9e156e961a4865f78069b5e5d98e4281061.svg" class="inline-math"> be a term.
The <em>flattening</em> of <img src="img-math/18e5e78375303bc5487910c10a2ce9e156e961a4865f78069b5e5d98e4281061.svg" class="inline-math"> consists of a relational formula <img src="img-math/2f1dd51301ae27d7d631aee8a794dee09e3582cfe8c1b00b59cba15224b368ce.svg" class="inline-math"> and a result variable <img src="img-math/86dc413d906dff81429b248a541a2bd53eefc427a941ec9c2f64c31e365ae8f4.svg" class="inline-math">.
Flattening is defined recursively as follows:
<ol>
<li>
<div class="paragraph">
If <img src="img-math/ec22ae6cd0bf625f554e9cd381f39e4a7d18ab21eae8c4067feb60cd199ffdde.svg" class="inline-math"> is a variable, then <img src="img-math/940f4ddf3d66dd8a8368a066ee0d5ab17afbc3ad4cabbb2a019902ad480197f4.svg" class="inline-math"> is the empty conjunction and <img src="img-math/ebc9e58aa9f684cc72ad3ad6e5349a12b3c5db3de60726cb514decea03696df4.svg" class="inline-math">.</div>
</li>
<li id="itm-flattening-composite">
<div class="paragraph">
If <img src="img-math/71b5cf35064b69f413c0f29204914e3dd48ff516bf15e110d0221080ffec01a1.svg" class="inline-math">, then
<div class="display-math-row">
<img src="img-math/aa07a645e080e7e47ff0258acfafc036b085a822d3ad7bc1531280343b416e0b.svg">
</div>
where <img src="img-math/cdefe95ead1b26032bb2e5011f30cbfe2680a3910f86905f27deb7b058f7a4b6.svg" class="inline-math"> is a fresh variable.</div>
</li>
</ol>
</div>
<div class="paragraph">
Let <img src="img-math/e6602cbfa7788f74e914319dd9b4cae6f7ab2eda9b10a1d27222a73d7ebff434.svg" class="inline-math"> be an algebraic atom.
The flattening <img src="img-math/b87d98185f0a71706ca8c4c7a20066e84dbc6d980334a86f8034a07bde48b2f1.svg" class="inline-math"> is a relational formula which is defined depending on the type of <img src="img-math/e6602cbfa7788f74e914319dd9b4cae6f7ab2eda9b10a1d27222a73d7ebff434.svg" class="inline-math"> as follows:
<ol>
<li>
<div class="paragraph">
If <img src="img-math/bcfa2c289eacb9b00ad88d4175b46c7e64969d16155a3c906fe1f3c017596b5b.svg" class="inline-math"> for some predicate <img src="img-math/b47da204460a2120599e5d8e5ca1bae68995e4c51ce9a02ba702f469f1be00ab.svg" class="inline-math">, then
<div class="display-math-row">
<img src="img-math/5a778c56847d326c1d25ab708bc4bd65480875d613f7789eb0add578b51eec90.svg">
</div></div>
</li>
<li>
<div class="paragraph">
If <img src="img-math/f4037a466edf19c566011b9d653e80ffbc5e98c6f3991f06dd2e833a8c62505f.svg" class="inline-math"> for some term <img src="img-math/18e5e78375303bc5487910c10a2ce9e156e961a4865f78069b5e5d98e4281061.svg" class="inline-math">, then
<div class="display-math-row">
<img src="img-math/8fd9d6abb013a51b029ee8bb7bd6d922b338c988aad3e7b1f9cd99c794d15465.svg">
</div></div>
</li>
<li>
<div class="paragraph">
If <img src="img-math/e6602cbfa7788f74e914319dd9b4cae6f7ab2eda9b10a1d27222a73d7ebff434.svg" class="inline-math"> is of the form <img src="img-math/d71ee7b8667326fea8d3f479cb62e851d0436b41a7ea442ee2a54528268e3139.svg" class="inline-math"> for terms <img src="img-math/2fcf8905e4a666d53f7719d2da55b13ae9842eb14fd78282daea61774bc1cec4.svg" class="inline-math">, then
<div class="display-math-row">
<img src="img-math/4fa50b7e2538d7b8f5c8d4e356b2042cb028549ec20bcab2441e509394cf3f79.svg">
</div></div>
</li>
</ol>

The flattening of an algebraic formula is the conjunction of the flattenings of each atom making up the formula.
The flattening of an algebraic sequent is given by flattening premise and conclusion.</div>
</div>
<div id="rem-flattening" class="theorem-like theorem-style-remark">
<div class="paragraph">
<h4>Remark 59.
</h4>
The flattening of a composite term <img src="img-math/71b5cf35064b69f413c0f29204914e3dd48ff516bf15e110d0221080ffec01a1.svg" class="inline-math"> involves the choice of a ``fresh'' variable <img src="img-math/3fc9857a0a4cb8aa18910afc040daa9ceaa9be94fb1f436d1beef9da603fae45.svg" class="inline-math">.
This notion can be made precise as follows:
The flattening operations take as additional parameter a sequence <img src="img-math/29ed1638d243440747531d0779d650c73fd2786182bbff24fe70ca52cd1e8415.svg" class="inline-math"> of variables, such that the variables <img src="img-math/92aef94bb94f1b17e863339581397814faa1407fb1e5bbef421c1d81ba717570.svg" class="inline-math"> do not occur in the syntactic objects that should be flattened.
Choosing a ``fresh'' variable <img src="img-math/3fc9857a0a4cb8aa18910afc040daa9ceaa9be94fb1f436d1beef9da603fae45.svg" class="inline-math"> now means that we set <img src="img-math/9acec921a00dcc1a4a1ee19ebc4f0d0b2804191a241853acdd8d0cd02bf669fb.svg" class="inline-math">, and for all further flattening operations we pass the sequence <img src="img-math/eab22a3fa3822e2f9c62a06bdcc9aca23eb49d095b92bfe185cd1fdb37b7fd87.svg" class="inline-math">.</div>
<div class="paragraph">
Note that a term <img src="img-math/18e5e78375303bc5487910c10a2ce9e156e961a4865f78069b5e5d98e4281061.svg" class="inline-math"> that appears twice in the same formula <img src="img-math/49d82e153ba9554774e5cf42f2a25ead34b1889dbce1ca32cde9582177e2e192.svg" class="inline-math"> will be flattened twice with different choices of fresh variables.
For example, if <img src="img-math/f2738b187b384a32bc0ae64c168ec48b7bb1dcd95d507720952f97e1cfe178ee.svg" class="inline-math"> is a binary function symbol and <img src="img-math/0749cd9a0de52fcf56c833781baba5d3e050a3a389bf11ebae3edcbee87a1584.svg" class="inline-math"> are variables, then the flattening of the algebraic formula
<div class="display-math-row">
<img src="img-math/0dd7dcb6a20ec78a0256329678468c1a7070dd4400685cd7c0ef7d39f91f8c41.svg">
</div>
is the relational formula
<div class="display-math-row">
<img src="img-math/c1e675c5826be3c29fa46a34ead307a4fb77464b2536ec1c410712a8609e9766.svg">
</div>
where <img src="img-math/2b6bf2bc85d054f31656a3b4205c98de03aaebc6f57a24673e052226d2ee7e7e.svg" class="inline-math">.</div>
</div>
<div id="prop-flattening-versus-interpretation" class="theorem-like theorem-style-theorem">
<div class="paragraph">
<h4>Proposition 60.
</h4>
Let <img src="img-math/57be56542331f5965669fd42c05dc9eb578780d6a00c512ae9563f7bcb9c1a48.svg" class="inline-math"> be an algebraic signature and let <img src="img-math/058a0e00a68e1131c9aa4f8bd9d0e56f03e14180114befecf4eccfefb05fb83d.svg" class="inline-math"> be an algebraic structure.
<ol>
<li>
<div class="paragraph">
Let <img src="img-math/18e5e78375303bc5487910c10a2ce9e156e961a4865f78069b5e5d98e4281061.svg" class="inline-math"> be a term and let <img src="img-math/f6cf97bfa9e50ab18203d10ce01677a20c00e3c84b54146a8e4d73ea55dc8db9.svg" class="inline-math"> be an interpretation of the variables of <img src="img-math/18e5e78375303bc5487910c10a2ce9e156e961a4865f78069b5e5d98e4281061.svg" class="inline-math"> in <img src="img-math/058a0e00a68e1131c9aa4f8bd9d0e56f03e14180114befecf4eccfefb05fb83d.svg" class="inline-math">.
Then <img src="img-math/f6cf97bfa9e50ab18203d10ce01677a20c00e3c84b54146a8e4d73ea55dc8db9.svg" class="inline-math"> can be extended to the term <img src="img-math/18e5e78375303bc5487910c10a2ce9e156e961a4865f78069b5e5d98e4281061.svg" class="inline-math"> if and only if <img src="img-math/f6cf97bfa9e50ab18203d10ce01677a20c00e3c84b54146a8e4d73ea55dc8db9.svg" class="inline-math"> can be extended to an interpretation of the relational formula <img src="img-math/2f1dd51301ae27d7d631aee8a794dee09e3582cfe8c1b00b59cba15224b368ce.svg" class="inline-math">.
In either case, if an extension <img src="img-math/85d617f9ec5b3c3579342ff68281cc3c898f2ed55d8dc66f8323c228b5577eaf.svg" class="inline-math"> exists, then it exists uniquely, and <img src="img-math/f094864556ce3ded74f0a5f5ccfc0d4632d1b8fb6c66fa7b84da0ecc5c1e4b7b.svg" class="inline-math">.</div>
</li>
<li>
<div class="paragraph">
Let <img src="img-math/e6602cbfa7788f74e914319dd9b4cae6f7ab2eda9b10a1d27222a73d7ebff434.svg" class="inline-math"> be an algebraic atom and let <img src="img-math/f6cf97bfa9e50ab18203d10ce01677a20c00e3c84b54146a8e4d73ea55dc8db9.svg" class="inline-math"> be an interpretation of the variables of <img src="img-math/e6602cbfa7788f74e914319dd9b4cae6f7ab2eda9b10a1d27222a73d7ebff434.svg" class="inline-math"> in <img src="img-math/058a0e00a68e1131c9aa4f8bd9d0e56f03e14180114befecf4eccfefb05fb83d.svg" class="inline-math">.
Then <img src="img-math/f6cf97bfa9e50ab18203d10ce01677a20c00e3c84b54146a8e4d73ea55dc8db9.svg" class="inline-math"> is an interpretation of <img src="img-math/e6602cbfa7788f74e914319dd9b4cae6f7ab2eda9b10a1d27222a73d7ebff434.svg" class="inline-math"> if and only if <img src="img-math/f6cf97bfa9e50ab18203d10ce01677a20c00e3c84b54146a8e4d73ea55dc8db9.svg" class="inline-math"> can be extended to an interpretation <img src="img-math/85d617f9ec5b3c3579342ff68281cc3c898f2ed55d8dc66f8323c228b5577eaf.svg" class="inline-math"> of the relational formula <img src="img-math/b87d98185f0a71706ca8c4c7a20066e84dbc6d980334a86f8034a07bde48b2f1.svg" class="inline-math">.
If <img src="img-math/85d617f9ec5b3c3579342ff68281cc3c898f2ed55d8dc66f8323c228b5577eaf.svg" class="inline-math"> exists, then it exists uniquely.</div>
</li>
<li>
<div class="paragraph">
Let <img src="img-math/f6d86a6f28fc28643c288e8b9fb3bcea657f2db64f517b5b434f99c922bf160d.svg" class="inline-math"> be an algebraic sequent.
Then <img src="img-math/058a0e00a68e1131c9aa4f8bd9d0e56f03e14180114befecf4eccfefb05fb83d.svg" class="inline-math"> satisfies <img src="img-math/f6d86a6f28fc28643c288e8b9fb3bcea657f2db64f517b5b434f99c922bf160d.svg" class="inline-math"> if and only if it satisfies the relational sequent <img src="img-math/9f4bed5ef6a2a0d02f0e4ee6205c4681072f29910b38ba97d5bdd699e6c39fae.svg" class="inline-math">.</div>
</li>
</ol>
</div>
</div>
<div class="proof">
<div class="paragraph">
<i class="proof">Proof.</i>
By construction.</div>
</div>
<div class="theorem-like theorem-style-definition">
<div class="paragraph">
<h4>Definition 61.
</h4>
Let <img src="img-math/57be56542331f5965669fd42c05dc9eb578780d6a00c512ae9563f7bcb9c1a48.svg" class="inline-math"> be an algebraic signature.
We associate to each algebraic formula <img src="img-math/49d82e153ba9554774e5cf42f2a25ead34b1889dbce1ca32cde9582177e2e192.svg" class="inline-math"> the following <em>classifying algebraic structure</em>:
<div class="display-math-row">
<img src="img-math/7b3abfaaa2dbecbfaf5df7ba2e842fa9265fb5b84a20429c8496d253d97ba959.svg">
</div>
The composition of the generic interpretion <img src="img-math/8680f760a5308eeac4b80d756502f95dccdb3d0f8daadffe6cd2a098fed90892.svg" class="inline-math"> with the reflection into <img src="img-math/54d26a1db1f4d0a8bcd7c74c824594696282b559cacb7a8b016d6dc5bfca1323.svg" class="inline-math"> induces an interpretation of <img src="img-math/0b476c70de0abb0dd00c9aae0734cc029eba3728d657ce50f464f93b4042455c.svg" class="inline-math"> in <img src="img-math/38ea0a85e8e091acaa0053b546b0f55124854385b49fe559e3e52dcba18a1abd.svg" class="inline-math">, which then restricts to an interpretation <img src="img-math/deeb4f21ec9b0e5fe23f759e86556b7237699475494e8bfa016238422cae44b4.svg" class="inline-math"> of <img src="img-math/49d82e153ba9554774e5cf42f2a25ead34b1889dbce1ca32cde9582177e2e192.svg" class="inline-math"> in <img src="img-math/38ea0a85e8e091acaa0053b546b0f55124854385b49fe559e3e52dcba18a1abd.svg" class="inline-math">.
We call <img src="img-math/deeb4f21ec9b0e5fe23f759e86556b7237699475494e8bfa016238422cae44b4.svg" class="inline-math"> the <em>generic interpretation</em> of <img src="img-math/49d82e153ba9554774e5cf42f2a25ead34b1889dbce1ca32cde9582177e2e192.svg" class="inline-math">.</div>
</div>
<div id="prop-algebraic-formula-structure-universal" class="theorem-like theorem-style-theorem">
<div class="paragraph">
<h4>Proposition 62.
</h4>
Let <img src="img-math/57be56542331f5965669fd42c05dc9eb578780d6a00c512ae9563f7bcb9c1a48.svg" class="inline-math"> be an algebraic signature.
Let <img src="img-math/49d82e153ba9554774e5cf42f2a25ead34b1889dbce1ca32cde9582177e2e192.svg" class="inline-math"> be an algebraic formula and let <img src="img-math/058a0e00a68e1131c9aa4f8bd9d0e56f03e14180114befecf4eccfefb05fb83d.svg" class="inline-math"> be an algebraic structure.
Then there is a bijection between interpretations of <img src="img-math/49d82e153ba9554774e5cf42f2a25ead34b1889dbce1ca32cde9582177e2e192.svg" class="inline-math"> in <img src="img-math/058a0e00a68e1131c9aa4f8bd9d0e56f03e14180114befecf4eccfefb05fb83d.svg" class="inline-math"> and maps <img src="img-math/988ea3b9f738b6ccc887a2c2dba2eba42f7049f33d27dc71cc9ac06e50d58d40.svg" class="inline-math">.</div>
</div>
<div class="proof">
<div class="paragraph">
<i class="proof">Proof.</i>
This follows by combining Proposition <a href="#prop-flattening-versus-interpretation">60</a>, Proposition <a href="#prop-algebraic-formula-structure-universal">62</a> and the universal property of the free algebraic structure functor.</div>
</div>
<div class="theorem-like theorem-style-definition">
<div class="paragraph">
<h4>Definition 63.
</h4>
Let <img src="img-math/3ee054267b2482dd601e7989eee8fddbaed341d4d976512c352d54149be9a72a.svg" class="inline-math"> be an algebraic sequent.
The <em>classifying morphism</em> of <img src="img-math/f6d86a6f28fc28643c288e8b9fb3bcea657f2db64f517b5b434f99c922bf160d.svg" class="inline-math"> is the map <img src="img-math/ce36923cecd5df0297700ff93246be0de597221ec59f3f304daa8f7ddd542e9b.svg" class="inline-math"> that is induced by the canonical interpretation of <img src="img-math/49d82e153ba9554774e5cf42f2a25ead34b1889dbce1ca32cde9582177e2e192.svg" class="inline-math"> in <img src="img-math/5e54a1f805cc1db6c174c02a8b23256b39f57a019f0c0495e7e15122c76ff08e.svg" class="inline-math">.</div>
</div>
<div class="theorem-like theorem-style-theorem">
<div class="paragraph">
<h4>Proposition 64.
</h4>
Let <img src="img-math/f6d86a6f28fc28643c288e8b9fb3bcea657f2db64f517b5b434f99c922bf160d.svg" class="inline-math"> be an algebraic sequent and let <img src="img-math/058a0e00a68e1131c9aa4f8bd9d0e56f03e14180114befecf4eccfefb05fb83d.svg" class="inline-math"> be an algebraic structure.
Then <img src="img-math/058a0e00a68e1131c9aa4f8bd9d0e56f03e14180114befecf4eccfefb05fb83d.svg" class="inline-math"> satisfies <img src="img-math/f6d86a6f28fc28643c288e8b9fb3bcea657f2db64f517b5b434f99c922bf160d.svg" class="inline-math"> if and only if <img src="img-math/058a0e00a68e1131c9aa4f8bd9d0e56f03e14180114befecf4eccfefb05fb83d.svg" class="inline-math"> is injective to <img src="img-math/6ff9f6433f9a2ff1291b28de007b9ce9524af3cd4449c64a6f2fa0a7e855b7c1.svg" class="inline-math">.</div>
</div>
<div class="proof">
<div class="paragraph">
<i class="proof">Proof.</i>
Analogous to the proof of Proposition <a href="#prop-relational-sequent-morphism-lifts">29</a>.</div>
</div>
<div id="prop-phl-models" class="theorem-like theorem-style-theorem">
<div class="paragraph">
<h4>Proposition 65.
</h4>
Let <img src="img-math/4e5b4bad957cd570519bf7c2ccc79708841c401e107a29138dcdf3074f76551e.svg" class="inline-math"> be an algebraic theory.
Denote the functionality sequent <a href="#eq-functionality-axiom">(4)</a> for function symbols <img src="img-math/cebe1a6f2576c629b07e31999a198208dbdbcc147ec0905280df3d1a3db280b4.svg" class="inline-math"> by <img src="img-math/3f634d8383b3e083c7f11b6c5e6b5cdbb11a3bf9553e6fc40a612a81a33f176a.svg" class="inline-math">.
Then <img src="img-math/00113b2831f32d64f7bfe0edd7dfe73ea690eddf255baee2f18a00b9189e3672.svg" class="inline-math"> is equivalent to the following injectivity classes:
<ol>
<li id="itm-phl-models-in-alg">
<div class="paragraph">
<img src="img-math/abb3665e04f93636a2c4f0d95e7805246a854aab6c7ce9e50b1bb42404f6fb28.svg" class="inline-math">, where <img src="img-math/823aae44dc57346bf944122464b6a35bfb37465b1448a47961c4418272404c44.svg" class="inline-math">.</div>
</li>
<li id="itm-phl-models-in-rel-alg-sequents">
<div class="paragraph">
<img src="img-math/a7b9dbad157a2c598fc7aaae9bd04422e9dbbe613b749ff09e84eb65fdeca844.svg" class="inline-math">, where <img src="img-math/b777e1f70ab894f1de62b623a7f9513a62961796524afbaa4f0c5ac1a1e626cb.svg" class="inline-math">.</div>
</li>
<li id="itm-phl-models-in-rel-rel-sequents">
<div class="paragraph">
<img src="img-math/ceb1fc10022524c02b47b2b580a1716ce0dd51816f76e5092c45844b9dda8006.svg" class="inline-math">, where <img src="img-math/b6cd237ddfd7f94cca29f993e090d165967010287e4ec357cb4fd3a6d91d917a.svg" class="inline-math">.</div>
</li>
</ol>

Here <img src="img-math/6ff9f6433f9a2ff1291b28de007b9ce9524af3cd4449c64a6f2fa0a7e855b7c1.svg" class="inline-math"> in the definition of <img src="img-math/1da1cf7a07ca08aeae7dd849c554d69210af68f91f080f37b9f2a939e205debe.svg" class="inline-math"> denotes the classifying morphism of the algebraic sequent <img src="img-math/f6d86a6f28fc28643c288e8b9fb3bcea657f2db64f517b5b434f99c922bf160d.svg" class="inline-math">, which we regard as a morphism of relational structures, and <img src="img-math/2aebef4ed3b1334a8bca42896cb7698ab5448785bebcf91bc2353ec517483074.svg" class="inline-math"> denotes the classifying morphism of the relational sequent <img src="img-math/9f4bed5ef6a2a0d02f0e4ee6205c4681072f29910b38ba97d5bdd699e6c39fae.svg" class="inline-math">.</div>
<div class="paragraph">
In particular, <img src="img-math/00113b2831f32d64f7bfe0edd7dfe73ea690eddf255baee2f18a00b9189e3672.svg" class="inline-math"> is a weakly reflective subcategory of both <img src="img-math/2a848f9d861e1b801356d9c69359f0c93fb8118e315aedabba7031e6457792c7.svg" class="inline-math"> and <img src="img-math/e98208345d01f594a884d2497b3e2bc1c7692123a6ab42972037403c4772dea0.svg" class="inline-math">.
If any one of <img src="img-math/af15e9fd36132640edb137d3b9e9e94069c1e19c1221cecfa476b0689cf66676.svg" class="inline-math"> or <img src="img-math/d8c177b04f2f9eb6b9538a884664508a6cc114b5fb30db229fe6deae123f55f0.svg" class="inline-math"> are strong, then all of them are strong, and <img src="img-math/00113b2831f32d64f7bfe0edd7dfe73ea690eddf255baee2f18a00b9189e3672.svg" class="inline-math"> is a reflective subcategory of <img src="img-math/2a848f9d861e1b801356d9c69359f0c93fb8118e315aedabba7031e6457792c7.svg" class="inline-math"> and <img src="img-math/e98208345d01f594a884d2497b3e2bc1c7692123a6ab42972037403c4772dea0.svg" class="inline-math">.</div>
</div>
<div class="proof">
<div class="paragraph">
<i class="proof">Proof.</i>
<a href="#itm-phl-models-in-alg">1</a> follows from Proposition <a href="#prop-algebraic-formula-structure-universal">62</a>, and then <a href="#itm-phl-models-in-rel-alg-sequents">2</a> and <a href="#itm-phl-models-in-rel-rel-sequents">3</a> follow from Proposition <a href="#prop-reflection-vs-injectivity">17</a>.</div>
</div>
<div id="prop-unflatten" class="theorem-like theorem-style-theorem">
<div class="paragraph">
<h4>Proposition 66.
</h4>
Let <img src="img-math/57be56542331f5965669fd42c05dc9eb578780d6a00c512ae9563f7bcb9c1a48.svg" class="inline-math"> be an algebraic signature.
Let <img src="img-math/e6602cbfa7788f74e914319dd9b4cae6f7ab2eda9b10a1d27222a73d7ebff434.svg" class="inline-math"> be a relational formula.
Then there exists an algebraic formula <img src="img-math/26405eb0eb797324cd8e51c3ea3bcb94ce5d491b5c3f97d8967e8dd4d35798b8.svg" class="inline-math"> with the following properties:
<ol>
<li>
<div class="paragraph">
Every variable occurs in <img src="img-math/e6602cbfa7788f74e914319dd9b4cae6f7ab2eda9b10a1d27222a73d7ebff434.svg" class="inline-math"> if and only if it occurs in <img src="img-math/26405eb0eb797324cd8e51c3ea3bcb94ce5d491b5c3f97d8967e8dd4d35798b8.svg" class="inline-math">.</div>
</li>
<li>
<div class="paragraph">
Let <img src="img-math/f6cf97bfa9e50ab18203d10ce01677a20c00e3c84b54146a8e4d73ea55dc8db9.svg" class="inline-math"> be an interpretation of the variables of <img src="img-math/e6602cbfa7788f74e914319dd9b4cae6f7ab2eda9b10a1d27222a73d7ebff434.svg" class="inline-math"> in an algebraic structure <img src="img-math/058a0e00a68e1131c9aa4f8bd9d0e56f03e14180114befecf4eccfefb05fb83d.svg" class="inline-math">.
Then <img src="img-math/f6cf97bfa9e50ab18203d10ce01677a20c00e3c84b54146a8e4d73ea55dc8db9.svg" class="inline-math"> is an interpretation of the algebraic formula <img src="img-math/e6602cbfa7788f74e914319dd9b4cae6f7ab2eda9b10a1d27222a73d7ebff434.svg" class="inline-math"> if and only if it is an interpretation of the relational formula <img src="img-math/26405eb0eb797324cd8e51c3ea3bcb94ce5d491b5c3f97d8967e8dd4d35798b8.svg" class="inline-math">.</div>
</li>
</ol>
</div>
</div>
<div class="proof">
<div class="paragraph">
<i class="proof">Proof.</i>
Replace every relational atom of the form <img src="img-math/ffa9dadb4f535fa158819c3436520fdfd85886a78f7f2c7eefb7fbb0e3011e5b.svg" class="inline-math"> for some function symbol <img src="img-math/5ee8866e1dfe3865555727ff685371b3eb0ce586e23dd774ddbb5f80fde0ee5a.svg" class="inline-math"> with the algebraic atom <img src="img-math/04bf0ba1ed8969f1d870227e235af39211a127c4620bb06944f501b450d8f290.svg" class="inline-math">.</div>
</div>
<div id="prop-composition-algebraic-sequent-morphisms" class="theorem-like theorem-style-theorem">
<div class="paragraph">
<h4>Proposition 67.
</h4>
Let <img src="img-math/3ee054267b2482dd601e7989eee8fddbaed341d4d976512c352d54149be9a72a.svg" class="inline-math"> and <img src="img-math/c63b051b50b2ce2aefe9544cfd0689d49cfb555a0396eff512bed5ed02cc4026.svg" class="inline-math"> be algebraic sequents.
Then
<div class="display-math-row">
<img src="img-math/825a9818bff6ae5c4d06b2ded61fa2e9d546b7e3d8f351fd0c5232b0556afb97.svg">
</div></div>
</div>
<div class="proof">
<div class="paragraph">
<i class="proof">Proof.</i>
This follows from Proposition <a href="#prop-algebraic-formula-structure-universal">62</a>.</div>
</div>
<h3>
4.3 Completeness Results</h3>
<div class="theorem-like theorem-style-definition">
<div class="paragraph">
<h4>Definition 68.
</h4>
Let <img src="img-math/f6d86a6f28fc28643c288e8b9fb3bcea657f2db64f517b5b434f99c922bf160d.svg" class="inline-math"> be an algebraic sequent.
We say that <img src="img-math/f6d86a6f28fc28643c288e8b9fb3bcea657f2db64f517b5b434f99c922bf160d.svg" class="inline-math"> is <em>epic</em> if every variable in the conclusion of <img src="img-math/f6d86a6f28fc28643c288e8b9fb3bcea657f2db64f517b5b434f99c922bf160d.svg" class="inline-math"> also occurs in the premise.
We say that <img src="img-math/f6d86a6f28fc28643c288e8b9fb3bcea657f2db64f517b5b434f99c922bf160d.svg" class="inline-math"> is <em>effectively epic</em> if every atom in the conclusion of <img src="img-math/f6d86a6f28fc28643c288e8b9fb3bcea657f2db64f517b5b434f99c922bf160d.svg" class="inline-math"> is of the form <img src="img-math/d71ee7b8667326fea8d3f479cb62e851d0436b41a7ea442ee2a54528268e3139.svg" class="inline-math"> for terms <img src="img-math/2fcf8905e4a666d53f7719d2da55b13ae9842eb14fd78282daea61774bc1cec4.svg" class="inline-math"> that also occur in the premise.</div>
</div>
<div class="theorem-like theorem-style-definition">
<div class="paragraph">
<h4>Definition 69.
</h4>
Let <img src="img-math/f2738b187b384a32bc0ae64c168ec48b7bb1dcd95d507720952f97e1cfe178ee.svg" class="inline-math"> be a function symbol.
The <em>totality sequent</em> <img src="img-math/0f7c4ff33b9847cee9a20ec653e079b4991038a883a60d5fb273fd90a36d1e12.svg" class="inline-math"> is given by
<div class="display-math-row">
<img src="img-math/bd1a933394d7acc5e0841dbc4d883fe4446770b05b564ff7d4ae0821f5828468.svg">
</div>

We denote by
<div class="display-math-row">
<img src="img-math/528f48ca35aa7bcd9904adba7d13f209c6e88ddae5cb4c3baf12d9365c2a8e38.svg">
</div>
the set of classifying morphisms of totality sequents.</div>
</div>
<div class="theorem-like theorem-style-theorem">
<div class="paragraph">
<h4>Proposition 70.
</h4>
Let <img src="img-math/f2738b187b384a32bc0ae64c168ec48b7bb1dcd95d507720952f97e1cfe178ee.svg" class="inline-math"> be a function symbol.
<ol>
<li>
<div class="paragraph">
An algebraic structure <img src="img-math/058a0e00a68e1131c9aa4f8bd9d0e56f03e14180114befecf4eccfefb05fb83d.svg" class="inline-math"> satisfies <img src="img-math/0f7c4ff33b9847cee9a20ec653e079b4991038a883a60d5fb273fd90a36d1e12.svg" class="inline-math"> if and only if <img src="img-math/c0f5b52488e5c9a32f7ab912cf91d0a000f24683591ad980a99149718e77b10e.svg" class="inline-math"> is a total function.</div>
</li>
<li>
<div class="paragraph">
<img src="img-math/162d88314ff34c63b23415e87c95f85dfc7c5706add6b02ece6d016a5b05bca3.svg" class="inline-math"> is an epimorphism of algebraic structures.
</div>
</li>
</ol>
</div>
</div>
<div class="theorem-like theorem-style-definition">
<div class="paragraph">
<h4>Definition 71.
</h4>
Let <img src="img-math/d3abad5e64aeeeecff50126d1de6df888127072d59848851d723510e7d4e5bd2.svg" class="inline-math"> be a map of algebraic structures.
We say that <img src="img-math/058a0e00a68e1131c9aa4f8bd9d0e56f03e14180114befecf4eccfefb05fb83d.svg" class="inline-math"> is <em>total over Y</em> (with respect to <img src="img-math/177573b798181d45acc4d40ee1d44a201a42e266a3bf77e23894840c697c4e3a.svg" class="inline-math">) if and only if for all function symbols <img src="img-math/f2738b187b384a32bc0ae64c168ec48b7bb1dcd95d507720952f97e1cfe178ee.svg" class="inline-math"> and elements <img src="img-math/c9d52d356a758323c7792f80562f25f7c9ff5b52e39edd8bfadc5ec8a93c53b4.svg" class="inline-math">, if <img src="img-math/2fd5a72653586cf2b57f23e43805c163273d1e10c967f5ef08726dc292cc54d6.svg" class="inline-math"> is defined, then <img src="img-math/1563e96948000a7f3cedddf12b2ec0095cedcaa49507c77a0cd275f12824f248.svg" class="inline-math"> is defined.</div>
</div>
<div id="prop-saturation" class="theorem-like theorem-style-theorem">
<div class="paragraph">
<h4>Proposition 72.
</h4>
Let <img src="img-math/d3abad5e64aeeeecff50126d1de6df888127072d59848851d723510e7d4e5bd2.svg" class="inline-math"> be a map of algebraic structures.
Then there exists a factorization
<div class="display-math-row">
<img src="img-math/1bd854ce4fcd8facc5afb5bd4fae487d535cd7d1f1203d60cfdbc62b72834b36.svg">
</div>
such that <img src="img-math/a377d23a5d42b7385429fc05b94bb6baf3dc6e993286ea1099d657ce9f31543e.svg" class="inline-math"> is a relative <img src="img-math/a37180210ed860fcfebbfb3d623c9322ee0fae718c71a2c628fc400331b29b96.svg" class="inline-math">-cell complex and <img src="img-math/d0b31c01839fd24e6dc36aeb07092113a56fd1d7f4fb25158fbf6eafa17b90c9.svg" class="inline-math"> is total over <img src="img-math/114fcb6328c864abf62596ade0d8558d94cfc13aad67dd29fc29433ac30f5146.svg" class="inline-math">.
Moreover, the triple <img src="img-math/bf128ea0f096350675f3e684726a8d11152d1cbe6aa3fb2473d6e43c1bada597.svg" class="inline-math"> is uniquely determined by <img src="img-math/177573b798181d45acc4d40ee1d44a201a42e266a3bf77e23894840c697c4e3a.svg" class="inline-math"> up to unique isomorphism.</div>
</div>
<div class="proof">
<div class="paragraph">
<i class="proof">Proof.</i>
Consider the set <img src="img-math/39895b75fd43d0b5d9eede73b598cd286d88539de29adb9b42ac1ed26301ee81.svg" class="inline-math"> of all triples <img src="img-math/e85e18b6fe55d61cad09c7c7eeedadffd198e84f51203d7c8b3bc57f7ef7918d.svg" class="inline-math"> corresponding to commuting triangles
<div class="display-math-row">
<img src="img-math/c67cef31f93bc3c60a784c2a08f93ba1f1756eb331e7fb1b056d904a2ec77be0.svg">
</div>
<img src="img-math/39895b75fd43d0b5d9eede73b598cd286d88539de29adb9b42ac1ed26301ee81.svg" class="inline-math"> is a set of epimorphisms in the slice category <img src="img-math/ececdec573c37e956f1fe6f9fb45574c3a245da66037131d6655292aac2c0585.svg" class="inline-math">.
It follows that <img src="img-math/39895b75fd43d0b5d9eede73b598cd286d88539de29adb9b42ac1ed26301ee81.svg" class="inline-math"> is strong, so <img src="img-math/4e45242d0d85b43881707b8c0816c5db8e81797eb811048f8aff2b88702dda5b.svg" class="inline-math"> is a reflective subcategory of <img src="img-math/ececdec573c37e956f1fe6f9fb45574c3a245da66037131d6655292aac2c0585.svg" class="inline-math">.
Partial algebras over <img src="img-math/114fcb6328c864abf62596ade0d8558d94cfc13aad67dd29fc29433ac30f5146.svg" class="inline-math"> are total over <img src="img-math/114fcb6328c864abf62596ade0d8558d94cfc13aad67dd29fc29433ac30f5146.svg" class="inline-math"> if and only if they are injective to <img src="img-math/33f0af6adb082f260ea68be9c97080c9a6c235a7dab602edf2e620f833b4a5e9.svg" class="inline-math">.
It follows that the triple <img src="img-math/e7cd052785871935e363d4cb32bdd444182bed53a823caef76fe405df82e5f33.svg" class="inline-math"> exists and is unique up to unique isomorphism, and that <img src="img-math/a377d23a5d42b7385429fc05b94bb6baf3dc6e993286ea1099d657ce9f31543e.svg" class="inline-math"> is a relative <img src="img-math/39895b75fd43d0b5d9eede73b598cd286d88539de29adb9b42ac1ed26301ee81.svg" class="inline-math">-cell complex.</div>
<div class="paragraph">
It remains to show that <img src="img-math/a377d23a5d42b7385429fc05b94bb6baf3dc6e993286ea1099d657ce9f31543e.svg" class="inline-math"> is a relative <img src="img-math/a37180210ed860fcfebbfb3d623c9322ee0fae718c71a2c628fc400331b29b96.svg" class="inline-math">-cell complex.
By definition, the class of relative <img src="img-math/33f0af6adb082f260ea68be9c97080c9a6c235a7dab602edf2e620f833b4a5e9.svg" class="inline-math">-cell complexes is obtained from <img src="img-math/33f0af6adb082f260ea68be9c97080c9a6c235a7dab602edf2e620f833b4a5e9.svg" class="inline-math"> by closure under certain classes of colimits.
The forgetful functor <img src="img-math/734657e37419668a35a846cc0238d6991a9682254b3c0b5a47478647a103b048.svg" class="inline-math"> preserves colimits and maps <img src="img-math/39895b75fd43d0b5d9eede73b598cd286d88539de29adb9b42ac1ed26301ee81.svg" class="inline-math"> into <img src="img-math/a37180210ed860fcfebbfb3d623c9322ee0fae718c71a2c628fc400331b29b96.svg" class="inline-math">.
From this it follows that the image of a relative <img src="img-math/39895b75fd43d0b5d9eede73b598cd286d88539de29adb9b42ac1ed26301ee81.svg" class="inline-math">-cell complex in <img src="img-math/54d26a1db1f4d0a8bcd7c74c824594696282b559cacb7a8b016d6dc5bfca1323.svg" class="inline-math"> is a relative <img src="img-math/a37180210ed860fcfebbfb3d623c9322ee0fae718c71a2c628fc400331b29b96.svg" class="inline-math">-complex.
In particular, <img src="img-math/a377d23a5d42b7385429fc05b94bb6baf3dc6e993286ea1099d657ce9f31543e.svg" class="inline-math"> is a relative <img src="img-math/a37180210ed860fcfebbfb3d623c9322ee0fae718c71a2c628fc400331b29b96.svg" class="inline-math">-cell complex.</div>
</div>
<div class="theorem-like theorem-style-definition">
<div class="paragraph">
<h4>Definition 73.
</h4>
Let <img src="img-math/d3abad5e64aeeeecff50126d1de6df888127072d59848851d723510e7d4e5bd2.svg" class="inline-math"> be a map of algebraic structures.
We call the unique factorization <img src="img-math/4cbfb4e377575461eefce04e607991a8474af82e9e115b27ee4c2324a660795a.svg" class="inline-math"> as in Proposition <a href="#prop-saturation">72</a> the <em>relative totalization</em> of <img src="img-math/058a0e00a68e1131c9aa4f8bd9d0e56f03e14180114befecf4eccfefb05fb83d.svg" class="inline-math">.</div>
</div>
<div id="prop-relatively-total-epis" class="theorem-like theorem-style-theorem">
<div class="paragraph">
<h4>Proposition 74.
</h4>
Let <img src="img-math/d3abad5e64aeeeecff50126d1de6df888127072d59848851d723510e7d4e5bd2.svg" class="inline-math"> be a map of algebraic structures such that <img src="img-math/058a0e00a68e1131c9aa4f8bd9d0e56f03e14180114befecf4eccfefb05fb83d.svg" class="inline-math"> is total over <img src="img-math/114fcb6328c864abf62596ade0d8558d94cfc13aad67dd29fc29433ac30f5146.svg" class="inline-math">.
Then <img src="img-math/177573b798181d45acc4d40ee1d44a201a42e266a3bf77e23894840c697c4e3a.svg" class="inline-math"> is an epimorphism in <img src="img-math/54d26a1db1f4d0a8bcd7c74c824594696282b559cacb7a8b016d6dc5bfca1323.svg" class="inline-math"> if and only if it is an epimorphism in <img src="img-math/dab63d9c5701419f4cd81f9adf6ffc5497518985f4e3b89083ac6364af084db1.svg" class="inline-math">.</div>
</div>
<div class="proof">
<div class="paragraph">
<i class="proof">Proof.</i>
The free algebraic structure functor <img src="img-math/1b433f74aebf6f9e9831c11eaf529c6964e6e110677469e2d26bd227fd051b50.svg" class="inline-math"> preserves epimorphisms, which shows necessity of the condition.</div>
<div class="paragraph">
Note that <img src="img-math/8713e7d5f50198ca6808e7749fb8dbf83a3053f6bdc334652ec897a5019dae4a.svg" class="inline-math">, that is, the image algebraic structure can be computed as image of relational structures.
Because <img src="img-math/177573b798181d45acc4d40ee1d44a201a42e266a3bf77e23894840c697c4e3a.svg" class="inline-math"> is an epimorphism in <img src="img-math/dab63d9c5701419f4cd81f9adf6ffc5497518985f4e3b89083ac6364af084db1.svg" class="inline-math"> or <img src="img-math/54d26a1db1f4d0a8bcd7c74c824594696282b559cacb7a8b016d6dc5bfca1323.svg" class="inline-math"> if and only if the inclusion of the image in the corresponding category is an epimorphism, we may assume that <img src="img-math/177573b798181d45acc4d40ee1d44a201a42e266a3bf77e23894840c697c4e3a.svg" class="inline-math"> is a monomorphism, i.e. injective on carrier sets.</div>
<div class="paragraph">
Consider the pushout <img src="img-math/17f4403c3fa05f606d04768e8a2e4f77281d057afe8f7d0e53bdb202685502e9.svg" class="inline-math"> in <img src="img-math/dab63d9c5701419f4cd81f9adf6ffc5497518985f4e3b89083ac6364af084db1.svg" class="inline-math">.
There are inclusions <img src="img-math/476cf16d24942daf93f2ed90984bcac111350ac1575ab5da9582899999c12e35.svg" class="inline-math">, <img src="img-math/a4808c6e8e5c421117a0ca62ca73b6e037c5b091870eea1cd3276be6fab9a6e3.svg" class="inline-math"> corresponding to the two components of <img src="img-math/f4557c0c69246eebdc26b3eac3b92271067ea93d75024fba31d74d8d3564ba4f.svg" class="inline-math"> such that <img src="img-math/2f832205cfebcbcecafad5a73176243d5c23f0cac36b844e216ab79ae6cbca60.svg" class="inline-math">, and an inclusions <img src="img-math/5cb781e7e6ee3eb5e0df04695c87b99cc13f159f55f6091463a4f61a578bfea3.svg" class="inline-math">.
We have <img src="img-math/98379376cf9e47edef61ae3b295ee23dce5c5c18f006e45f592daad4a37a0477.svg" class="inline-math"> for all sorts <img src="img-math/c97a8fe633f85e531699955fb905d5a68ebdd81d9622ddcedb8f550da2473f85.svg" class="inline-math">, but note that the analogous equation does not hold for relations:
Epimorphisms of relational structures need not be surjective on relations.</div>
<div class="paragraph">
We claim that <img src="img-math/f4557c0c69246eebdc26b3eac3b92271067ea93d75024fba31d74d8d3564ba4f.svg" class="inline-math"> is an algebraic structure.
Thus let <img src="img-math/f2738b187b384a32bc0ae64c168ec48b7bb1dcd95d507720952f97e1cfe178ee.svg" class="inline-math"> be a function symbol, and let <img src="img-math/eb761a3c980355044960b01a0461205d82fab8ba451ebcec00474d28a5073ca6.svg" class="inline-math"> such that <img src="img-math/7374f38b15d2e18feebeb4dfa6a0c6ecd22ca9f07649cdbddc64e6d77fb36023.svg" class="inline-math"> and <img src="img-math/ca12b7e35662d16391098ff7e95a7eede626172085c11cc7e0ca99c39b97557c.svg" class="inline-math">.
We need to show that <img src="img-math/b84e43197f188e843e7d9393e26f871f3582154975c1f2d472d4cfd3b0235a22.svg" class="inline-math">.</div>
<div class="paragraph">
If <img src="img-math/0dbc844add94a1305152e744e4e60f6353aa313774b105ee9801b5ad33be7b21.svg" class="inline-math"> or <img src="img-math/cabef2adaa1ef4aa8866458e9a4372a030f326dea96da0e3c4e6da5d2af249a5.svg" class="inline-math"> this follows from the fact that <img src="img-math/d4262abaf5768456259a1dece1893965b784980545764a26e7cd4f0050dd6067.svg" class="inline-math"> is an algebraic structure.
We may thus (by symmetry) assume that <img src="img-math/9c0915dc081f89473c63257eb5d18f7e3b82c502cab939bc75e39993f2be4198.svg" class="inline-math"> and <img src="img-math/56c03bf8b621902a3c8368e86a4979daca6c83579fc7d2a430a460bf0dae92b1.svg" class="inline-math">.
Because the first <img src="img-math/509fe7e8ba852248c1de4dfc8c752f04a501aa15dc740f89268b2dd4cb0e9155.svg" class="inline-math"> projections of <img src="img-math/52825f43140127e52996cca8fa912d9aa890918845f0e262256feea67ecae6bf.svg" class="inline-math"> and <img src="img-math/17126b749238f6da586d6c58765c0a57d8ebd35829d3910e9ff3c0104d10952c.svg" class="inline-math"> agree, we have <img src="img-math/b61d3a763f3d5f496201d3a05c4eb6e0f75d02079cf127a8f60de212b16188ed.svg" class="inline-math">, hence <img src="img-math/0a0b03c0149f5b4cfd7d78ce9f085a887cac9cf1de8f0fb2bc5f4785483f976e.svg" class="inline-math"> for <img src="img-math/f814716a6c3e175327354b0888f1f31a9b1cf296fb883ec3bf36cbfbde9a5ceb.svg" class="inline-math">.
Because <img src="img-math/058a0e00a68e1131c9aa4f8bd9d0e56f03e14180114befecf4eccfefb05fb83d.svg" class="inline-math"> is total over the <img src="img-math/084fc6700584e797b034e4c699c1c15a5d32981708cf51f81391d75907522abd.svg" class="inline-math"> with respect to the inclusions <img src="img-math/cd5bd6b63f90e014d7dccdf5ba3405923e5e67dda54ba86cf492cb07823710c2.svg" class="inline-math">, we have <img src="img-math/361f65b29c2eddaa56292a6ef4103eda135d29a56f9aa2855fbf2e8f1648a614.svg" class="inline-math"> for some <img src="img-math/83b5574846b2f6e0237dfff3fc29ee399e809a76483ba7a5bebf77f4f7852c4c.svg" class="inline-math">.
It follows that <img src="img-math/441754ab4f97deffae06b52c43476d9171860badf8224a72a065c7374ec24830.svg" class="inline-math"> and <img src="img-math/9a73afd466464fc9d47e1c58018d1e90423df5135d2efcdf4bc9bd39f52c2d0f.svg" class="inline-math">, hence <img src="img-math/b84e43197f188e843e7d9393e26f871f3582154975c1f2d472d4cfd3b0235a22.svg" class="inline-math">.</div>
<div class="paragraph">
As in every category with colimits, <img src="img-math/177573b798181d45acc4d40ee1d44a201a42e266a3bf77e23894840c697c4e3a.svg" class="inline-math"> is an epimorphism if and only if the two maps <img src="img-math/81796b1ca76b052aad5b4b94b28317273d07489a51c0bfae8682a05e512576b2.svg" class="inline-math"> agree.
But we have just shown that <img src="img-math/1fcf82524c597595e2d8ec6f9347e991de9f8afbbe48056362948bcc29f3084f.svg" class="inline-math">, so also the two maps <img src="img-math/b4119129ebd87fdbaa89caff1cea35b19da730a1d2c6a9fdf71805af83c05472.svg" class="inline-math"> agree.
Thus <img src="img-math/177573b798181d45acc4d40ee1d44a201a42e266a3bf77e23894840c697c4e3a.svg" class="inline-math"> is an epimorphism in <img src="img-math/dab63d9c5701419f4cd81f9adf6ffc5497518985f4e3b89083ac6364af084db1.svg" class="inline-math">.</div>
</div>
<div id="prop-algebraic-epis" class="theorem-like theorem-style-theorem">
<div class="paragraph">
<h4>Proposition 75.
</h4>
Let <img src="img-math/d3abad5e64aeeeecff50126d1de6df888127072d59848851d723510e7d4e5bd2.svg" class="inline-math"> be a map of algebraic structures.
Let <img src="img-math/3cd2844b3218b1a0923261fb6f417035ce21a807fe701c9d97a63e34247a4bfb.svg" class="inline-math"> be the relative totalization of <img src="img-math/058a0e00a68e1131c9aa4f8bd9d0e56f03e14180114befecf4eccfefb05fb83d.svg" class="inline-math">.
Then the following holds:
<ol>
<li id="itm-algebraic-epimorphisms">
<div class="paragraph">
<img src="img-math/177573b798181d45acc4d40ee1d44a201a42e266a3bf77e23894840c697c4e3a.svg" class="inline-math"> is an epimorphism in <img src="img-math/54d26a1db1f4d0a8bcd7c74c824594696282b559cacb7a8b016d6dc5bfca1323.svg" class="inline-math"> if and only if <img src="img-math/740647c4545c4e5b0908ae677b686487f1012afaac2d755ef836742bb35e1abf.svg" class="inline-math"> is an epimorphism in <img src="img-math/dab63d9c5701419f4cd81f9adf6ffc5497518985f4e3b89083ac6364af084db1.svg" class="inline-math">.</div>
</li>
<li id="itm-algebraic-effective-epimorphisms">
<div class="paragraph">
<img src="img-math/177573b798181d45acc4d40ee1d44a201a42e266a3bf77e23894840c697c4e3a.svg" class="inline-math"> is an effective epimorphism in <img src="img-math/54d26a1db1f4d0a8bcd7c74c824594696282b559cacb7a8b016d6dc5bfca1323.svg" class="inline-math"> if and only if it is an effective epimorphism in <img src="img-math/dab63d9c5701419f4cd81f9adf6ffc5497518985f4e3b89083ac6364af084db1.svg" class="inline-math">.</div>
</li>
</ol>
</div>
</div>
<div class="proof">
<div class="paragraph">
<i class="proof">Proof.</i>
<a href="#itm-algebraic-epimorphisms">1</a>.
Every morphism in <img src="img-math/a37180210ed860fcfebbfb3d623c9322ee0fae718c71a2c628fc400331b29b96.svg" class="inline-math"> is an epimorphism.
Since epimorphisms are stable under pushouts and transfinite compositions, every relative <img src="img-math/a37180210ed860fcfebbfb3d623c9322ee0fae718c71a2c628fc400331b29b96.svg" class="inline-math">-cell complex and in particular <img src="img-math/a377d23a5d42b7385429fc05b94bb6baf3dc6e993286ea1099d657ce9f31543e.svg" class="inline-math"> is an effective epimorphism.
Thus <img src="img-math/177573b798181d45acc4d40ee1d44a201a42e266a3bf77e23894840c697c4e3a.svg" class="inline-math"> is an epimorphism in <img src="img-math/54d26a1db1f4d0a8bcd7c74c824594696282b559cacb7a8b016d6dc5bfca1323.svg" class="inline-math"> if and only if <img src="img-math/740647c4545c4e5b0908ae677b686487f1012afaac2d755ef836742bb35e1abf.svg" class="inline-math"> is an epimorphism in <img src="img-math/54d26a1db1f4d0a8bcd7c74c824594696282b559cacb7a8b016d6dc5bfca1323.svg" class="inline-math">.
We conclude with Proposition <a href="#prop-relatively-total-epis">74</a>.</div>
<div class="paragraph">
<a href="#itm-algebraic-effective-epimorphisms">2</a>.
This follows from general properties of colimits and reflective subcategories.</div>
</div>
<div class="theorem-like theorem-style-definition">
<div class="paragraph">
<h4>Definition 76.
</h4>
An algebraic sequent <img src="img-math/f6d86a6f28fc28643c288e8b9fb3bcea657f2db64f517b5b434f99c922bf160d.svg" class="inline-math"> is called <em>epic</em> if every variable that occurs in the conclusion of <img src="img-math/f6d86a6f28fc28643c288e8b9fb3bcea657f2db64f517b5b434f99c922bf160d.svg" class="inline-math"> also occurs in the premise.
<img src="img-math/f6d86a6f28fc28643c288e8b9fb3bcea657f2db64f517b5b434f99c922bf160d.svg" class="inline-math"> is called <em>effectively epic</em> if every atom in the conclusion of <img src="img-math/f6d86a6f28fc28643c288e8b9fb3bcea657f2db64f517b5b434f99c922bf160d.svg" class="inline-math"> is of the form <img src="img-math/d71ee7b8667326fea8d3f479cb62e851d0436b41a7ea442ee2a54528268e3139.svg" class="inline-math">, where <img src="img-math/e8a0d3021220171c26623abd4719992d4125bbee4a1e254787570448cec09d0c.svg" class="inline-math"> and <img src="img-math/370616599a6791ae5d02aa20608a18751cfb4abde8db3166cee129fa198b1ac6.svg" class="inline-math"> are terms that occur in the premise of <img src="img-math/f6d86a6f28fc28643c288e8b9fb3bcea657f2db64f517b5b434f99c922bf160d.svg" class="inline-math">.</div>
</div>
<div id="prop-flattening-atoms" class="theorem-like theorem-style-theorem">
<div class="paragraph">
<h4>Proposition 77.
</h4>
Let <img src="img-math/57be56542331f5965669fd42c05dc9eb578780d6a00c512ae9563f7bcb9c1a48.svg" class="inline-math"> be an algebraic signature.
Let <img src="img-math/49d82e153ba9554774e5cf42f2a25ead34b1889dbce1ca32cde9582177e2e192.svg" class="inline-math"> be an algebraic formula and let <img src="img-math/097341643da03f834dcfc1c269e14dd1882b799fef693ffd387bad12e0df2571.svg" class="inline-math"> be the set of variables that occur in <img src="img-math/49d82e153ba9554774e5cf42f2a25ead34b1889dbce1ca32cde9582177e2e192.svg" class="inline-math">.
Let <img src="img-math/4153c7ec6fe17098ab81d08eb112e70a9ede58842b2fe14e191d02127e4a5c90.svg" class="inline-math"> for relational atoms <img src="img-math/07a47d98126e3bd35068f453fc1f4a459d9226bd9caf8ef8c35f8bc9ddda24e4.svg" class="inline-math">.
Let <img src="img-math/40dafec9d335701d6bc02842bae0b5a4d12cc9094dbeb6edbc1dca730e00720c.svg" class="inline-math"> for some <img src="img-math/ceec897e2982ac3e9a8a0fe65f23f5caaf56b422384e50d177d99b89ce584b59.svg" class="inline-math"> and let
<div class="display-math-row">
<img src="img-math/854088326dec03fda17b34695725b59029e0bde8bbc44fa75f4eec3d9b7f8845.svg">
</div>
Then <img src="img-math/e6602cbfa7788f74e914319dd9b4cae6f7ab2eda9b10a1d27222a73d7ebff434.svg" class="inline-math"> has one of the following forms:
<ol>
<li id="itm-flattened-predicate-case">
<div class="paragraph">
<img src="img-math/33868b631d683c45d3ce40f7de3e4c8e6890b0a6ea7ac9b0c2a74f2b8a8bc4cc.svg" class="inline-math">, where <img src="img-math/b47da204460a2120599e5d8e5ca1bae68995e4c51ce9a02ba702f469f1be00ab.svg" class="inline-math"> is a predicate symbol and <img src="img-math/f7449696f7361842a2102df49160ffa7091431fbba93d4091948f9733ed2294a.svg" class="inline-math">.</div>
</li>
<li id="itm-flattened-function-case">
<div class="paragraph">
<img src="img-math/95357ebec4508a6c89c4c7489dba5d0d6f4604af1331458d3776fea3d9b62477.svg" class="inline-math">, where <img src="img-math/f32f0c7b637a7eff80034494dd774e569b9ab68c0addc57d7e4a3ba83938ae5c.svg" class="inline-math"> is a function symbol, <img src="img-math/f7449696f7361842a2102df49160ffa7091431fbba93d4091948f9733ed2294a.svg" class="inline-math"> and <img src="img-math/c20cd3413540131d0f8fdf4fee99b1b65847a7e790da04b95ef711eb89069e4d.svg" class="inline-math">.</div>
</li>
<li id="itm-flattened-defined-case">
<div class="paragraph">
<img src="img-math/7f9eeb15ec638cabf6b30cdeaa9dda87afc4c2b2c41590f104978e69ba08794f.svg" class="inline-math">, where <img src="img-math/05e5683efb61ab79128663a218255c95faaeec72ceafb200fc37646d0fad2210.svg" class="inline-math">.</div>
</li>
<li id="itm-flattened-equals-case">
<div class="paragraph">
<img src="img-math/6860c0cb8d9a8a7a950011e3d8011df1b64474fc1616e4145b937f1ee2f0b40e.svg" class="inline-math">, where <img src="img-math/21b55f020338ebdfb98894dcf6329bb8dd50948f6b90d1194cdd2094e9512c9e.svg" class="inline-math">.</div>
</li>
</ol>
</div>
</div>
<div class="proof">
<div class="paragraph">
<i class="proof">Proof.</i>
Follows inductively from the definition of flattening; see also Remark <a href="#rem-flattening">59</a>.</div>
</div>
<div id="prop-semantics-algebraic-sequents" class="theorem-like theorem-style-theorem">
<div class="paragraph">
<h4>Proposition 78.
</h4>
Let <img src="img-math/57be56542331f5965669fd42c05dc9eb578780d6a00c512ae9563f7bcb9c1a48.svg" class="inline-math"> be an algebraic signature.
The image of (epic, effectively epic) algebraic sequents under the assignment <img src="img-math/ef9a5d285c5aa120ef228ab92938f55dc21eef66b38d2b11694f1f3dfe05dbef.svg" class="inline-math"> can be described as follows:
<ol>
<li id="itm-semantics-arbitrary-algebraic-sequent">
<div class="paragraph">
If <img src="img-math/f6d86a6f28fc28643c288e8b9fb3bcea657f2db64f517b5b434f99c922bf160d.svg" class="inline-math"> is an algebraic sequent, then <img src="img-math/6ff9f6433f9a2ff1291b28de007b9ce9524af3cd4449c64a6f2fa0a7e855b7c1.svg" class="inline-math"> is a map of finite algebraic structures.
Conversely, every map of finite relational structures is isomorphic to a map of the form <img src="img-math/6ff9f6433f9a2ff1291b28de007b9ce9524af3cd4449c64a6f2fa0a7e855b7c1.svg" class="inline-math"> for some algebraic sequent <img src="img-math/f6d86a6f28fc28643c288e8b9fb3bcea657f2db64f517b5b434f99c922bf160d.svg" class="inline-math">.</div>
</li>
<li id="itm-semantics-epic-algebraic-sequent">
<div class="paragraph">
If <img src="img-math/f6d86a6f28fc28643c288e8b9fb3bcea657f2db64f517b5b434f99c922bf160d.svg" class="inline-math"> is an epic algebraic sequent, then <img src="img-math/6ff9f6433f9a2ff1291b28de007b9ce9524af3cd4449c64a6f2fa0a7e855b7c1.svg" class="inline-math"> is an epimorphism of finite algebraic structures.
Conversely, every epimorphism of finite relational structures is isomorphic to a map of the form <img src="img-math/6ff9f6433f9a2ff1291b28de007b9ce9524af3cd4449c64a6f2fa0a7e855b7c1.svg" class="inline-math"> for some epic algebraic sequent <img src="img-math/f6d86a6f28fc28643c288e8b9fb3bcea657f2db64f517b5b434f99c922bf160d.svg" class="inline-math">.</div>
</li>
<li id="itm-semantics-effectively-epic-algebraic-sequent">
<div class="paragraph">
If <img src="img-math/f6d86a6f28fc28643c288e8b9fb3bcea657f2db64f517b5b434f99c922bf160d.svg" class="inline-math"> is a quotient algebraic sequent, then <img src="img-math/6ff9f6433f9a2ff1291b28de007b9ce9524af3cd4449c64a6f2fa0a7e855b7c1.svg" class="inline-math"> is an effective epimorphism of finite algebraic structures.
Conversely, every effective epimorphism of finite relational structures is isomorphic to a map of the form <img src="img-math/6ff9f6433f9a2ff1291b28de007b9ce9524af3cd4449c64a6f2fa0a7e855b7c1.svg" class="inline-math"> for some quotient algebraic sequent <img src="img-math/f6d86a6f28fc28643c288e8b9fb3bcea657f2db64f517b5b434f99c922bf160d.svg" class="inline-math">.</div>
</li>
</ol>
</div>
</div>
<div class="proof">
<div class="paragraph">
<i class="proof">Proof.</i>
<a href="#itm-semantics-arbitrary-algebraic-sequent">1</a>.
If <img src="img-math/f6d86a6f28fc28643c288e8b9fb3bcea657f2db64f517b5b434f99c922bf160d.svg" class="inline-math"> is an algebraic sequent, then by Proposition <a href="#prop-semantics-relational-sequents">36</a>, <img src="img-math/2aebef4ed3b1334a8bca42896cb7698ab5448785bebcf91bc2353ec517483074.svg" class="inline-math"> is a map of finite relational structures, hence <img src="img-math/fcb56ab581636942055929889018bbb404b73b11b56ced2c98b80a0917b8fa20.svg" class="inline-math"> is a map of finite algebraic structures.</div>
<div class="paragraph">
Conversely, let <img src="img-math/d3abad5e64aeeeecff50126d1de6df888127072d59848851d723510e7d4e5bd2.svg" class="inline-math"> be a map of finite algebraic structures.
Then <img src="img-math/177573b798181d45acc4d40ee1d44a201a42e266a3bf77e23894840c697c4e3a.svg" class="inline-math"> is, in particular, a map of finite relational structures.
By Proposition <a href="#prop-semantics-relational-sequents">36</a>, there exists a relational sequent <img src="img-math/f6d86a6f28fc28643c288e8b9fb3bcea657f2db64f517b5b434f99c922bf160d.svg" class="inline-math"> such that <img src="img-math/6679c81f78ba0430135d823ae8da533e24d9e206ee9de27d707603d841500334.svg" class="inline-math">.
We now invoke Proposition <a href="#prop-unflatten">66</a> to obtain an algebraic sequent <img src="img-math/3a7e1984242df88330a40dcb69619633825471746f28a53a2f537ea36bad7073.svg" class="inline-math"> such that <img src="img-math/0876f702903846bce8eed3d6b047424a33870fe4d2d574ff682fe84c299f22ee.svg" class="inline-math">.</div>
<div class="paragraph">
<a href="#itm-semantics-effectively-epic-algebraic-sequent">3</a>.
Let <img src="img-math/3ee054267b2482dd601e7989eee8fddbaed341d4d976512c352d54149be9a72a.svg" class="inline-math"> be an effectively epic algebraic sequent.
By Proposition <a href="#prop-composition-algebraic-sequent-morphisms">67</a>, we may assume by induction that the conclusion <img src="img-math/f01bc8a000c08d15aed25ef15f5acd71cf0134bc807b3f0564102b2ed8197abc.svg" class="inline-math"> consists of a single atom <img src="img-math/d71ee7b8667326fea8d3f479cb62e851d0436b41a7ea442ee2a54528268e3139.svg" class="inline-math"> for terms <img src="img-math/2fcf8905e4a666d53f7719d2da55b13ae9842eb14fd78282daea61774bc1cec4.svg" class="inline-math"> that also occur in the premise <img src="img-math/49d82e153ba9554774e5cf42f2a25ead34b1889dbce1ca32cde9582177e2e192.svg" class="inline-math">.
Let <img src="img-math/bd8b186867911bb5a46148657b27c336b796eb99cd8a6f0ef82eb1b4eec8f454.svg" class="inline-math"> and <img src="img-math/5dae280d83398bb41d8253df0f5953c6afd0f37851375b4d15f0610fe707843e.svg" class="inline-math"> be two variables corresponding to flattenings of <img src="img-math/e8a0d3021220171c26623abd4719992d4125bbee4a1e254787570448cec09d0c.svg" class="inline-math"> and <img src="img-math/370616599a6791ae5d02aa20608a18751cfb4abde8db3166cee129fa198b1ac6.svg" class="inline-math"> in the premise.
Then for the effectively epic relational sequent <img src="img-math/5b265c7e403380a8d0cdfe38254c590183fab18b76907cb3a661f748f4db71f8.svg" class="inline-math"> we have <img src="img-math/b6bff05b37152193d5d354a936f18b7233b88d569c6a32d9fbb22b98fe6da731.svg" class="inline-math">.
By Proposition <a href="#prop-semantics-relational-sequents">36</a>, <img src="img-math/f07da69a013327617a242531976ea7cce957e54b3f3e640ab58a0cb3acdb74f5.svg" class="inline-math"> is an effective epimorphism of relational structures.
Because the free algebra functor is a left adjoint, it preserves effective epimorphisms.
Thus <img src="img-math/3959abc83e99e09d84a33cf3fb070840b29418b758ff9babb192166287b3d7fa.svg" class="inline-math"> is an effective epimorphism of algebraic structures.</div>
<div class="paragraph">
Conversely, let <img src="img-math/d3abad5e64aeeeecff50126d1de6df888127072d59848851d723510e7d4e5bd2.svg" class="inline-math"> be an effective epimorphism of algebraic structures.
Then <img src="img-math/177573b798181d45acc4d40ee1d44a201a42e266a3bf77e23894840c697c4e3a.svg" class="inline-math"> is also effectively epic as morphism of relational structures.
By clause <a href="#itm-semantics-quotient-relational-sequent">3</a> of Proposition <a href="#prop-semantics-relational-sequents">36</a>, we find an effectively epic relational sequent <img src="img-math/f6d86a6f28fc28643c288e8b9fb3bcea657f2db64f517b5b434f99c922bf160d.svg" class="inline-math"> such that <img src="img-math/6679c81f78ba0430135d823ae8da533e24d9e206ee9de27d707603d841500334.svg" class="inline-math">.
Then <img src="img-math/b54d600f0a0091ab97cf0e35b2e3404602811c28e69a5114f2c10396210bea30.svg" class="inline-math"> is an effectively epic algebraic sequent such that <img src="img-math/f89e65ec81295619c2aef50c6c421450473b10907f15fbb87f6df4fac1c1faeb.svg" class="inline-math"> as desired.</div>
<div class="paragraph">
<a href="#itm-semantics-epic-algebraic-sequent">2</a>.
Let <img src="img-math/f7cd5dc99e61443fc9973ba797f23b4b3e9fffc7427f2defebc078e3e72a048f.svg" class="inline-math"> be the flattening of an epic algebraic formula.
We need to show that <img src="img-math/fc4288e344e61e8544655efff123c244796d51fe3186bd7ac02ba206585c3a60.svg" class="inline-math"> is an epimorphism in <img src="img-math/54d26a1db1f4d0a8bcd7c74c824594696282b559cacb7a8b016d6dc5bfca1323.svg" class="inline-math">.</div>
<div class="paragraph">
By Proposition <a href="#prop-composition-algebraic-sequent-morphisms">67</a>, we may without loss of generality assume that <img src="img-math/ac5c375642f1f44185a7c1e5412bd9ac7b2d0ead9364b5d727490bc04307b9f2.svg" class="inline-math"> is a relational atom of one of the types as in Proposition <a href="#prop-flattening-atoms">77</a>, where <img src="img-math/e6602cbfa7788f74e914319dd9b4cae6f7ab2eda9b10a1d27222a73d7ebff434.svg" class="inline-math"> is the set of variables in <img src="img-math/49d82e153ba9554774e5cf42f2a25ead34b1889dbce1ca32cde9582177e2e192.svg" class="inline-math">.
In cases <a href="#itm-flattened-predicate-case">1</a>, <a href="#itm-flattened-defined-case">3</a> and <a href="#itm-flattened-equals-case">4</a>, the morphism <img src="img-math/0bf313ed9cb4b04b69bfef119c94a46f04793823bbf8a35762e3bcf7b467b9af.svg" class="inline-math"> of relational structures is surjective.
Because the free algebraic structure functor preserves epimorphisms, this implies that <img src="img-math/de8bafb08cd35ac58b307b7a90e0d1dea651d504e0239e6801d511b14530889f.svg" class="inline-math"> is an epimorphism in <img src="img-math/54d26a1db1f4d0a8bcd7c74c824594696282b559cacb7a8b016d6dc5bfca1323.svg" class="inline-math">.
In case <a href="#itm-flattened-predicate-case">1</a>, <img src="img-math/0bf313ed9cb4b04b69bfef119c94a46f04793823bbf8a35762e3bcf7b467b9af.svg" class="inline-math"> is a pushout of <img src="img-math/162d88314ff34c63b23415e87c95f85dfc7c5706add6b02ece6d016a5b05bca3.svg" class="inline-math"> in <img src="img-math/dab63d9c5701419f4cd81f9adf6ffc5497518985f4e3b89083ac6364af084db1.svg" class="inline-math">.
Since <img src="img-math/dd879e6835798a6487f89858e48cbd7582f822a0d8fcf2f41abc40fe8f2ed71c.svg" class="inline-math"> is an epimorphism in <img src="img-math/54d26a1db1f4d0a8bcd7c74c824594696282b559cacb7a8b016d6dc5bfca1323.svg" class="inline-math"> and pushouts preserve epimorphisms, it follows that also in this case <img src="img-math/177573b798181d45acc4d40ee1d44a201a42e266a3bf77e23894840c697c4e3a.svg" class="inline-math"> is an epimorphism.</div>
<div class="paragraph">
Conversely, let <img src="img-math/d3abad5e64aeeeecff50126d1de6df888127072d59848851d723510e7d4e5bd2.svg" class="inline-math"> be an epimorphism of finite algebraic structures.
Let <img src="img-math/4cbfb4e377575461eefce04e607991a8474af82e9e115b27ee4c2324a660795a.svg" class="inline-math"> be the relative totalization of <img src="img-math/058a0e00a68e1131c9aa4f8bd9d0e56f03e14180114befecf4eccfefb05fb83d.svg" class="inline-math"> over <img src="img-math/114fcb6328c864abf62596ade0d8558d94cfc13aad67dd29fc29433ac30f5146.svg" class="inline-math">.
Since <img src="img-math/a377d23a5d42b7385429fc05b94bb6baf3dc6e993286ea1099d657ce9f31543e.svg" class="inline-math"> is a relative <img src="img-math/a37180210ed860fcfebbfb3d623c9322ee0fae718c71a2c628fc400331b29b96.svg" class="inline-math">-cell complex, there exists by Proposition <a href="#prop-iterative-relative-cell-complexes">9</a> a sequence of pushout squares
<div class="display-math-row">
<img src="img-math/5d8e4a24eb46014a75d267c8dd1f50ac8349a3d084cec1ee32e44de3219312a8.svg">
</div>
for a totality sequent <img src="img-math/10249b7cea21b8340498d31b908d576f66f3a888c17e4b424847ec0dd45255fc.svg" class="inline-math"> for all <img src="img-math/509fe7e8ba852248c1de4dfc8c752f04a501aa15dc740f89268b2dd4cb0e9155.svg" class="inline-math"> such that <img src="img-math/a377d23a5d42b7385429fc05b94bb6baf3dc6e993286ea1099d657ce9f31543e.svg" class="inline-math"> is the infinite composition of the <img src="img-math/c657b4f6c3c5d50bf6d616809658a11466ae9c12ec888a079f15ede44d4e249b.svg" class="inline-math">.
Note that, a priori, Proposition <a href="#prop-iterative-relative-cell-complexes">9</a> implies only that <img src="img-math/c657b4f6c3c5d50bf6d616809658a11466ae9c12ec888a079f15ede44d4e249b.svg" class="inline-math"> is a pushout of a <em>coproduct</em> of totality sequents.
However, finiteness of <img src="img-math/058a0e00a68e1131c9aa4f8bd9d0e56f03e14180114befecf4eccfefb05fb83d.svg" class="inline-math"> and <img src="img-math/114fcb6328c864abf62596ade0d8558d94cfc13aad67dd29fc29433ac30f5146.svg" class="inline-math"> implies inductively that these coproducts can be chosen to be finite, and then a single pushout of a finite coproduct can equivalently be written as a finite composition of pushout.</div>
<div class="paragraph">
We claim that <img src="img-math/5350d6ab85f463220d3461fd4385ccdccfc00ba348c0b13518d92fd6b8548da2.svg" class="inline-math"> for some epic algebraic sequent <img src="img-math/f6d86a6f28fc28643c288e8b9fb3bcea657f2db64f517b5b434f99c922bf160d.svg" class="inline-math"> for all <img src="img-math/282b49edc6a3215d6076dede282ec3a4bfc2f2be9b6367b3f30e86ac2e4bc42d.svg" class="inline-math">.
To verify this, choose first an algebraic formula <img src="img-math/49d82e153ba9554774e5cf42f2a25ead34b1889dbce1ca32cde9582177e2e192.svg" class="inline-math"> such that <img src="img-math/152276ff898f946e0195d9458a321e91f2871b48c7adb646ca546eec467142f7.svg" class="inline-math">.
A formula <img src="img-math/49d82e153ba9554774e5cf42f2a25ead34b1889dbce1ca32cde9582177e2e192.svg" class="inline-math"> with this property exists by clause <a href="#itm-semantics-arbitrary-algebraic-sequent">1</a> above because the identity on <img src="img-math/c99cb71ac37bbb60bd470fd882c3288061f0f40d5309cee309948a6cb14a669c.svg" class="inline-math"> is a map of finite algebraic structures.
The map <img src="img-math/a4bd19b1cdf1d5d5f761239964ebfba12682d12ccb248fe4b410276067940e15.svg" class="inline-math"> corresponds to elements <img src="img-math/c9d52d356a758323c7792f80562f25f7c9ff5b52e39edd8bfadc5ec8a93c53b4.svg" class="inline-math">, and these elements are the interpretations of terms <img src="img-math/2961d78d9419c3d149ad64efcfe8bcb4fe21cbb65054f80006a9066ba6f89b71.svg" class="inline-math"> that occur in <img src="img-math/49d82e153ba9554774e5cf42f2a25ead34b1889dbce1ca32cde9582177e2e192.svg" class="inline-math">.
Now
<div class="display-math-row">
<img src="img-math/de3af3bedc6569979e54a19192bb74b4bd85afc5bfd4f3af9d18e9ba67e8ea52.svg">
</div></div>
<div class="paragraph">
Let <img src="img-math/e6d8d7fcd67fd6d5ca73aaf60be3ac6bcdd4686a827730a73f479988cc201e28.svg" class="inline-math"> for <img src="img-math/282b49edc6a3215d6076dede282ec3a4bfc2f2be9b6367b3f30e86ac2e4bc42d.svg" class="inline-math">.
Because <img src="img-math/114fcb6328c864abf62596ade0d8558d94cfc13aad67dd29fc29433ac30f5146.svg" class="inline-math"> is finite, the chain
<div class="display-math-row">
<img src="img-math/374a55f8672bf0a564c56c9d1a4226a6373fc668ba7240e015ceb9032f39955c.svg">
</div>
is eventually stationary, say for <img src="img-math/11d22cc2ff505d88edc5ff4d0ee1617d90bae508d7dea04ec9f4927709588246.svg" class="inline-math">, and then <img src="img-math/b35d084b9f557fb114ab14e4f6da211533edaedd070f9d4289e867f6a60c4c11.svg" class="inline-math">.
<img src="img-math/177573b798181d45acc4d40ee1d44a201a42e266a3bf77e23894840c697c4e3a.svg" class="inline-math"> is an epimorphism, hence <img src="img-math/740647c4545c4e5b0908ae677b686487f1012afaac2d755ef836742bb35e1abf.svg" class="inline-math"> is a surjection by Proposition <a href="#prop-algebraic-epis">75</a>, hence also <img src="img-math/1ce4658b77517af423587aa78f26dc2ea63adfa1c2381a7020ba49487492f1a9.svg" class="inline-math"> is a surjection.
Thus <img src="img-math/13adaed903aae99f87149b918d12c89dd9731202342a2f7543eac8639d6b5f9c.svg" class="inline-math"> for some surjective relational sequent <img src="img-math/f6d86a6f28fc28643c288e8b9fb3bcea657f2db64f517b5b434f99c922bf160d.svg" class="inline-math">.
Note that the algebraic sequent <img src="img-math/3a7e1984242df88330a40dcb69619633825471746f28a53a2f537ea36bad7073.svg" class="inline-math"> is epic because the relational sequent <img src="img-math/f6d86a6f28fc28643c288e8b9fb3bcea657f2db64f517b5b434f99c922bf160d.svg" class="inline-math"> is surjective.</div>
<div class="paragraph">
We have thus decomposed <img src="img-math/177573b798181d45acc4d40ee1d44a201a42e266a3bf77e23894840c697c4e3a.svg" class="inline-math"> into a composition
<div class="display-math-row">
<img src="img-math/0981a75b2cf51d085ae40dccc925ed29a383f68ce74020c2db8fb954ec882294.svg">
</div>
in which each map is isomorphic to <img src="img-math/6ff9f6433f9a2ff1291b28de007b9ce9524af3cd4449c64a6f2fa0a7e855b7c1.svg" class="inline-math"> for some epic algebraic sequent <img src="img-math/f6d86a6f28fc28643c288e8b9fb3bcea657f2db64f517b5b434f99c922bf160d.svg" class="inline-math">.
If <img src="img-math/121cfe734ff5ad02c5c220036e8387f3cd32c0d74ea3fcafefc50437b8f7e11e.svg" class="inline-math"> is an epic algebraic sequent and <img src="img-math/9e67f109a2b5464aea03b0322ca64216782fd78a4990944a62dd0461b102859c.svg" class="inline-math"> is an epic algebraic sequent for algebraic formulas <img src="img-math/fdc9944431efc46236f48b940dd629a5fd6eadabc071751f54417c48139c9ee2.svg" class="inline-math">, then also <img src="img-math/9e6c71ed1e938db6b412e522bdc40037104b38de97b05c109bb6c4e0124510d3.svg" class="inline-math"> is epic.
Thus by Proposition <a href="#prop-composition-algebraic-sequent-morphisms">67</a>, <img src="img-math/16673c3bdf0117b1620696318feb9ab1317b53380e759e2746f562463693a2e7.svg" class="inline-math"> for some epic algebraic sequent <img src="img-math/f6d86a6f28fc28643c288e8b9fb3bcea657f2db64f517b5b434f99c922bf160d.svg" class="inline-math">.</div>
</div>
<div id="prop-strong-rhl-to-epic-phl" class="theorem-like theorem-style-theorem">
<div class="paragraph">
<h4>Proposition 79.
</h4>
Let <img src="img-math/e94a30cee0214f847bdd9fd94bd185ce58e109ee4c9196e76f806ead42454c79.svg" class="inline-math"> be a relational signature.
Let <img src="img-math/33f0af6adb082f260ea68be9c97080c9a6c235a7dab602edf2e620f833b4a5e9.svg" class="inline-math"> be a set of morphisms of finite relational <img src="img-math/3f48b0f68758e065321bb41ffd846b3ae8096d7d26a252cc38ec1b01aaedf9a2.svg" class="inline-math">-structures.
Then there exists an algebraic signature <img src="img-math/51f5a6143c91223020451e0ea5e5fc42d703a358da3eded7abe580c66b008b7a.svg" class="inline-math"> on the same set of sorts <img src="img-math/afd87c23c65e17b0c51f83111752692ab0030bfc9716c0a0c3b2483e4fbf7ba7.svg" class="inline-math"> such that <img src="img-math/1365168a267e7a9247dbbb8ccf5877598a7dde4d8914c8206b8f083f6455f0a9.svg" class="inline-math"> and a set <img src="img-math/80e65d4189b63ec760baf2cc5f368d2f754c868cfadda28a9104ba5d3d8efea5.svg" class="inline-math"> of epimorphisms of finite algebraic <img src="img-math/cbfabbb29da9f4535a9a58b92a3d92a678943b924cef71709a582e00078d4879.svg" class="inline-math">-structures such that the forgetful functor <img src="img-math/745e34a85d82a226db3c3551b07e2b96b7f351f275d82543e93a0c710813a816.svg" class="inline-math"> restricts to an equivalence <img src="img-math/cb2692742c4cbf32f4ee1354f0e5cb4a76185479a004c3f3a9631927894ab06e.svg" class="inline-math">.</div>
</div>
<div class="proof">
<div class="paragraph">
<i class="proof">Proof.</i>
Choosing a relational sequent <img src="img-math/6e3462786e7811be58e177bb886acbaa1e4dab5cf33487b86e93eb516b7dea56.svg" class="inline-math"> such that <img src="img-math/4df15ffe8be45db8b605dadd6bb66f8c8f357ca65243efe7c869916cf16429f5.svg" class="inline-math"> for each <img src="img-math/99af06fb07baea8311be4852dac999340ebdbebea94c098e123ad8483dd85820.svg" class="inline-math">, we identify <img src="img-math/33f0af6adb082f260ea68be9c97080c9a6c235a7dab602edf2e620f833b4a5e9.svg" class="inline-math"> with a set of relational sequents.</div>
<div class="paragraph">
Our set of function symbols <img src="img-math/0bd1dd014813dbf1a42b3c0b20825409b27936aa98f9d794ad95bf959fb2d714.svg" class="inline-math"> is given by
<div class="display-math-row">
<img src="img-math/6f5f82c59b80301405dea2c3a9a0a4efab9997519dc65504e5fadb28f96b6ef8.svg">
</div>
Let <img src="img-math/3ee054267b2482dd601e7989eee8fddbaed341d4d976512c352d54149be9a72a.svg" class="inline-math"> be in <img src="img-math/33f0af6adb082f260ea68be9c97080c9a6c235a7dab602edf2e620f833b4a5e9.svg" class="inline-math">.
Let <img src="img-math/66bf39caae985149c22c93e415ab33b5f583476bb1329ab9aa41683431380137.svg" class="inline-math"> be an enumeration of the variables in <img src="img-math/49d82e153ba9554774e5cf42f2a25ead34b1889dbce1ca32cde9582177e2e192.svg" class="inline-math">, let <img src="img-math/baf65a1761f8845318b6d260476ad9483528d03101a79244cd644cd984f26f02.svg" class="inline-math"> be the sort of <img src="img-math/90275abc21a6a4571eb3f15d9be4f18696c8b105a04d93af93da257466bd0d96.svg" class="inline-math"> and let <img src="img-math/c97a8fe633f85e531699955fb905d5a68ebdd81d9622ddcedb8f550da2473f85.svg" class="inline-math"> be the sort of <img src="img-math/35611dd170074cd8301fedd4d5924c6cebf1fa1d77e601af80bff825c42676a9.svg" class="inline-math">.
Let <img src="img-math/7de3fcabea69b38c20a2b244b1a7e3e5ca621eb5b31da56cf4bff23e16d95663.svg" class="inline-math">.
Then the signature of <img src="img-math/85f6f82bb2327bfa2e8fd838ba8b4cf5d32bdb53684f51fef6d061ed8f9e6432.svg" class="inline-math"> is given by <img src="img-math/79474e1bf2706b454094ee67ff52d13db55e4dece78fa5817911a64e4bdb7be1.svg" class="inline-math">.</div>
<div class="paragraph">
Note that each relation symbol in <img src="img-math/3f48b0f68758e065321bb41ffd846b3ae8096d7d26a252cc38ec1b01aaedf9a2.svg" class="inline-math"> corresponds to a predicate symbol in <img src="img-math/cbfabbb29da9f4535a9a58b92a3d92a678943b924cef71709a582e00078d4879.svg" class="inline-math">.
We thus implicitly coerce relational <img src="img-math/3f48b0f68758e065321bb41ffd846b3ae8096d7d26a252cc38ec1b01aaedf9a2.svg" class="inline-math">-sequents to algebraic <img src="img-math/cbfabbb29da9f4535a9a58b92a3d92a678943b924cef71709a582e00078d4879.svg" class="inline-math">-sequents (without invoking <img src="img-math/844b0daeb47f3a8eadaba36bc9d483d924134e74da0d484bf5fc5209900b2edb.svg" class="inline-math">).</div>
<div class="paragraph">
Let <img src="img-math/80e65d4189b63ec760baf2cc5f368d2f754c868cfadda28a9104ba5d3d8efea5.svg" class="inline-math"> be the set containing the following algebraic sequents, for all <img src="img-math/3ee054267b2482dd601e7989eee8fddbaed341d4d976512c352d54149be9a72a.svg" class="inline-math"> in <img src="img-math/33f0af6adb082f260ea68be9c97080c9a6c235a7dab602edf2e620f833b4a5e9.svg" class="inline-math">:
<ol>
<li id="itm-new-functions-satisfy">
<div class="paragraph">
The sequent <img src="img-math/e74412dd443af34870b57ce6cb7add60a487738b5ae6225f163812d985f99ead.svg" class="inline-math">, where <img src="img-math/d47fc42374e93361542bd41ac4a928e7a10da5d9c29ee593537124036e7cfb1d.svg" class="inline-math"> is obtained from <img src="img-math/f01bc8a000c08d15aed25ef15f5acd71cf0134bc807b3f0564102b2ed8197abc.svg" class="inline-math"> by replacing each variable <img src="img-math/35611dd170074cd8301fedd4d5924c6cebf1fa1d77e601af80bff825c42676a9.svg" class="inline-math"> in <img src="img-math/f01bc8a000c08d15aed25ef15f5acd71cf0134bc807b3f0564102b2ed8197abc.svg" class="inline-math"> with <img src="img-math/2326d0a15a8b9287a66c7f92c9ee6c67de08d7c8e28865bda63dfa41f8184381.svg" class="inline-math">.</div>
</li>
<li id="itm-new-functions-only-defined-if-premise">
<div class="paragraph">
The sequents
<div class="display-math-row">
<img src="img-math/7cec356e7eac5f792de6b8f4d79568d25c069b2fb5548cf633bb46852bbca507.svg">
</div>
for all variables <img src="img-math/35611dd170074cd8301fedd4d5924c6cebf1fa1d77e601af80bff825c42676a9.svg" class="inline-math"> in <img src="img-math/f01bc8a000c08d15aed25ef15f5acd71cf0134bc807b3f0564102b2ed8197abc.svg" class="inline-math">.</div>
</li>
<li id="itm-new-functions-uniquely">
<div class="paragraph">
The sequent
<div class="display-math-row">
<img src="img-math/0b6ac830f227d6edd5f5ad92867a3bcb493d9044e18f63e6fb971d200abb8e33.svg">
</div></div>
</li>
</ol>

Clearly all algebraic sequents in <img src="img-math/80e65d4189b63ec760baf2cc5f368d2f754c868cfadda28a9104ba5d3d8efea5.svg" class="inline-math"> are epic.
Let <img src="img-math/e0326260c34b0dab801ae7b8da136b3bfc2a965891adeaef5b0c5822dff57bac.svg" class="inline-math"> be the forgetful functor.</div>
<div class="paragraph">
We first show that <img src="img-math/64ca379cf1c6924c8d37743a885e69f21e7591c2545042fa2acd48b58ce9cd51.svg" class="inline-math"> maps algebraic structures <img src="img-math/4a5eceea41458078163d0f5e2e3d8b63d53ca03bd1a947d334bd89c514a6dae1.svg" class="inline-math"> to <img src="img-math/e6dad0925b8a4a15da0c3b9e68ab23258014b3f75d1b2319f935206c98eac23c.svg" class="inline-math">.
Let <img src="img-math/3ee054267b2482dd601e7989eee8fddbaed341d4d976512c352d54149be9a72a.svg" class="inline-math"> be a sequent in <img src="img-math/33f0af6adb082f260ea68be9c97080c9a6c235a7dab602edf2e620f833b4a5e9.svg" class="inline-math"> and let <img src="img-math/a2223cad13920051f66dfcd7a2bad3fb9b71b153c27ed91f3808eb3315faae40.svg" class="inline-math"> be the enumeration of variables in <img src="img-math/49d82e153ba9554774e5cf42f2a25ead34b1889dbce1ca32cde9582177e2e192.svg" class="inline-math"> that we chose in the definition of the signature of the function symbols <img src="img-math/85f6f82bb2327bfa2e8fd838ba8b4cf5d32bdb53684f51fef6d061ed8f9e6432.svg" class="inline-math">.
Let <img src="img-math/f6cf97bfa9e50ab18203d10ce01677a20c00e3c84b54146a8e4d73ea55dc8db9.svg" class="inline-math"> be an interpretation of <img src="img-math/49d82e153ba9554774e5cf42f2a25ead34b1889dbce1ca32cde9582177e2e192.svg" class="inline-math"> in <img src="img-math/1102b2a8f67a1333820062bd637e8275f1be2b6cc1f01df052b105cf37d21efa.svg" class="inline-math">.
As mentioned earlier, we implicitly treat <img src="img-math/49d82e153ba9554774e5cf42f2a25ead34b1889dbce1ca32cde9582177e2e192.svg" class="inline-math"> also as an algebraic sequent for the signature <img src="img-math/cbfabbb29da9f4535a9a58b92a3d92a678943b924cef71709a582e00078d4879.svg" class="inline-math">, and under this identification we can view <img src="img-math/f6cf97bfa9e50ab18203d10ce01677a20c00e3c84b54146a8e4d73ea55dc8db9.svg" class="inline-math"> as an interpretation of the algebraic sequent <img src="img-math/49d82e153ba9554774e5cf42f2a25ead34b1889dbce1ca32cde9582177e2e192.svg" class="inline-math"> in the algebraic structure <img src="img-math/058a0e00a68e1131c9aa4f8bd9d0e56f03e14180114befecf4eccfefb05fb83d.svg" class="inline-math">.
Because <img src="img-math/058a0e00a68e1131c9aa4f8bd9d0e56f03e14180114befecf4eccfefb05fb83d.svg" class="inline-math"> satisfies the sequent <a href="#itm-new-functions-satisfy">1</a>, it follows that <img src="img-math/f6cf97bfa9e50ab18203d10ce01677a20c00e3c84b54146a8e4d73ea55dc8db9.svg" class="inline-math"> is also an interpretation of <img src="img-math/d47fc42374e93361542bd41ac4a928e7a10da5d9c29ee593537124036e7cfb1d.svg" class="inline-math"> in <img src="img-math/058a0e00a68e1131c9aa4f8bd9d0e56f03e14180114befecf4eccfefb05fb83d.svg" class="inline-math">.
By definition of <img src="img-math/d47fc42374e93361542bd41ac4a928e7a10da5d9c29ee593537124036e7cfb1d.svg" class="inline-math">, it follows that we obtain an interpretation <img src="img-math/85d617f9ec5b3c3579342ff68281cc3c898f2ed55d8dc66f8323c228b5577eaf.svg" class="inline-math"> of <img src="img-math/7f15aa55cf7cd571a1dadd12329de73d6b63b9dc06d98c638307e005d819d980.svg" class="inline-math"> by setting <img src="img-math/8a215194c8f829e1d03576722bb29aeaca51580a1fd4de22e5f22c3a39102113.svg" class="inline-math"> if <img src="img-math/35611dd170074cd8301fedd4d5924c6cebf1fa1d77e601af80bff825c42676a9.svg" class="inline-math"> occurs in <img src="img-math/49d82e153ba9554774e5cf42f2a25ead34b1889dbce1ca32cde9582177e2e192.svg" class="inline-math"> and <img src="img-math/575ab86ba1aa6dd0e63e006cb6c6bbb734c68496f5237ad42144fd6395c19cc3.svg" class="inline-math"> if <img src="img-math/35611dd170074cd8301fedd4d5924c6cebf1fa1d77e601af80bff825c42676a9.svg" class="inline-math"> does not occur in <img src="img-math/49d82e153ba9554774e5cf42f2a25ead34b1889dbce1ca32cde9582177e2e192.svg" class="inline-math">.</div>
<div class="paragraph">
Thus <img src="img-math/1102b2a8f67a1333820062bd637e8275f1be2b6cc1f01df052b105cf37d21efa.svg" class="inline-math"> satisfies the sequent <img src="img-math/121cfe734ff5ad02c5c220036e8387f3cd32c0d74ea3fcafefc50437b8f7e11e.svg" class="inline-math">.
Two interpretations of <img src="img-math/7f15aa55cf7cd571a1dadd12329de73d6b63b9dc06d98c638307e005d819d980.svg" class="inline-math"> in <img src="img-math/1102b2a8f67a1333820062bd637e8275f1be2b6cc1f01df052b105cf37d21efa.svg" class="inline-math"> that agree on the variables in <img src="img-math/49d82e153ba9554774e5cf42f2a25ead34b1889dbce1ca32cde9582177e2e192.svg" class="inline-math"> agree also on the variables that occur in <img src="img-math/f01bc8a000c08d15aed25ef15f5acd71cf0134bc807b3f0564102b2ed8197abc.svg" class="inline-math"> because of sequent <a href="#itm-new-functions-uniquely">3</a>.
We have thus shown that <img src="img-math/64ca379cf1c6924c8d37743a885e69f21e7591c2545042fa2acd48b58ce9cd51.svg" class="inline-math"> restricts to a functor <img src="img-math/23734b4393ccff35291ef00626e3d68d3d8b40c1d188ee420ece54e91ef00d57.svg" class="inline-math">.</div>
<div class="paragraph">
We now construct an inverse functor <img src="img-math/9b8427d398f5c994953d2bf6f59fda9fa32c5597b5e25a7715cb6cc237efdec6.svg" class="inline-math">.
Thus, let <img src="img-math/636281c08eb92402af96349e9046b9140f342a7b6bef76c65115e67f87297e62.svg" class="inline-math"> and let us construct <img src="img-math/b867de6f55b445d7cb3965ef57c396a6ed3552287cd5669a48c6f483731499f2.svg" class="inline-math"> such that <img src="img-math/a73227de0cebe98d189161e24bee4f4afa9c7a13c2f8db7b841ae3ff70020399.svg" class="inline-math">.
This leaves us no choice but to define <img src="img-math/058a0e00a68e1131c9aa4f8bd9d0e56f03e14180114befecf4eccfefb05fb83d.svg" class="inline-math"> on the same carrier sets as <img src="img-math/114fcb6328c864abf62596ade0d8558d94cfc13aad67dd29fc29433ac30f5146.svg" class="inline-math"> with <img src="img-math/d6bc14c7566f1337f941089432d62399de256d202cb9b447fc8005357d7cbf69.svg" class="inline-math"> for <img src="img-math/eb8a0ae53bfae72796e1352feea1dea35fd9884f2e749b6aeab6f52fd03277ab.svg" class="inline-math">.
Let <img src="img-math/3ee054267b2482dd601e7989eee8fddbaed341d4d976512c352d54149be9a72a.svg" class="inline-math"> be in <img src="img-math/33f0af6adb082f260ea68be9c97080c9a6c235a7dab602edf2e620f833b4a5e9.svg" class="inline-math">, and let <img src="img-math/66bf39caae985149c22c93e415ab33b5f583476bb1329ab9aa41683431380137.svg" class="inline-math"> be the enumeration of the variables in <img src="img-math/49d82e153ba9554774e5cf42f2a25ead34b1889dbce1ca32cde9582177e2e192.svg" class="inline-math"> that we chose earlier.
Then we set
<div id="eq-definition-epic-transformation-functions" class="display-math-row">
<span>(5)</span>
<img src="img-math/68b7bf70c7f93e5921b1fa6fcccc30e9ac46fff065f58e6f8fc54864bafe6eee.svg">
<span>(5)</span>
</div>
whenever <img src="img-math/85d617f9ec5b3c3579342ff68281cc3c898f2ed55d8dc66f8323c228b5577eaf.svg" class="inline-math"> is an interpretation of <img src="img-math/7f15aa55cf7cd571a1dadd12329de73d6b63b9dc06d98c638307e005d819d980.svg" class="inline-math"> in <img src="img-math/114fcb6328c864abf62596ade0d8558d94cfc13aad67dd29fc29433ac30f5146.svg" class="inline-math">.
Since <img src="img-math/114fcb6328c864abf62596ade0d8558d94cfc13aad67dd29fc29433ac30f5146.svg" class="inline-math"> satisfies <img src="img-math/121cfe734ff5ad02c5c220036e8387f3cd32c0d74ea3fcafefc50437b8f7e11e.svg" class="inline-math"> uniquely, two interpretations of <img src="img-math/7f15aa55cf7cd571a1dadd12329de73d6b63b9dc06d98c638307e005d819d980.svg" class="inline-math"> are equal as soon as they agree on the variables in <img src="img-math/49d82e153ba9554774e5cf42f2a25ead34b1889dbce1ca32cde9582177e2e192.svg" class="inline-math">.
Thus the sequent <a href="#eq-definition-epic-transformation-functions">(5)</a> defines partial functions as required.
By construction, <img src="img-math/058a0e00a68e1131c9aa4f8bd9d0e56f03e14180114befecf4eccfefb05fb83d.svg" class="inline-math"> satisfies the sequent <a href="#itm-new-functions-satisfy">1</a> and the sequents <a href="#itm-new-functions-only-defined-if-premise">2</a>.
Because <img src="img-math/114fcb6328c864abf62596ade0d8558d94cfc13aad67dd29fc29433ac30f5146.svg" class="inline-math"> satisfies <img src="img-math/121cfe734ff5ad02c5c220036e8387f3cd32c0d74ea3fcafefc50437b8f7e11e.svg" class="inline-math"> uniquely, <img src="img-math/058a0e00a68e1131c9aa4f8bd9d0e56f03e14180114befecf4eccfefb05fb83d.svg" class="inline-math"> satisfies the sequents <a href="#itm-new-functions-uniquely">3</a>.</div>
<div class="paragraph">
It remains to show that <img src="img-math/3d546c334e5a5b09fad223a0bf3a258e5dfcff5e4329762929ab5a7c0b4c31c7.svg" class="inline-math"> is functorial.
Thus let <img src="img-math/cb862d01da6023825de67a774eccd79b68b2a3f21d4f07e7a53613087d1f7a7f.svg" class="inline-math"> be a map of relational structures <img src="img-math/15fef37d9bf13e55df49a0abd78df1e7cf8b6e4495dfc1989408b1ffd3faf061.svg" class="inline-math">, and let <img src="img-math/8f5e36c327954b15fce11b7b1e6479f8f23b3c5efb4480ca607656ae1a365185.svg" class="inline-math"> for <img src="img-math/4bdbe52d4405812005d9e307cf767c5be2a54a4440ce1aa2f1c53b572c6a79bd.svg" class="inline-math">.
We need to show that the action of <img src="img-math/177573b798181d45acc4d40ee1d44a201a42e266a3bf77e23894840c697c4e3a.svg" class="inline-math"> on carrier sets is also a morphism <img src="img-math/be99fc0dbde6bb47ff36457e51f0fd0e992a696fd2776f6bc649358f2c76400f.svg" class="inline-math">, i.e. that it preserves partial functions.
This follows from the definition of the partial functions <a href="#eq-definition-epic-transformation-functions">(5)</a> because if <img src="img-math/85d617f9ec5b3c3579342ff68281cc3c898f2ed55d8dc66f8323c228b5577eaf.svg" class="inline-math"> is an interpretation of <img src="img-math/7f15aa55cf7cd571a1dadd12329de73d6b63b9dc06d98c638307e005d819d980.svg" class="inline-math"> in <img src="img-math/06d354688722d4687b805d338858dbb30cc0c06888e77a80208fdab7bc5cfdf1.svg" class="inline-math">, then <img src="img-math/1781aa19ea19c64f82caa7e22a2742456b569f90f1ea4aec9664c7140d6e90d3.svg" class="inline-math"> is an interpretation of <img src="img-math/7f15aa55cf7cd571a1dadd12329de73d6b63b9dc06d98c638307e005d819d980.svg" class="inline-math"> in <img src="img-math/85c884e99bade0c4702a30376bcb114fe73201678fae807db1cb59e10696f80c.svg" class="inline-math">.</div>
</div>
<h2>Bibliography</h2>
<ol class="bibliography">
<li id="souffle-choice">
 The Choice Construct in the Souffl{\'{e}} Language. Programming Languages and Systems, pages 163181, 2021.</li>
<li id="milner-inference">
 A theory of type polymorphism in programming. Journal of Computer and System Sciences, 17(3):348375, 1978.</li>
<li id="steensgard">
 Points-to analysis in almost linear time. Proceedings of the 23rd {ACM} {SIGPLAN}-{SIGACT} symposium on Principles of programming languages  - {POPL} {\textquotesingle}96, 1996.</li>
<li id="congruence-closure">
 Variations on the Common Subexpression Problem. Journal of the {ACM}, 27(4):758771, 1980.</li>
<li id="souffle-union-find">
 Fast Parallel Equivalence Relations in a Datalog Compiler. 2019 28th International Conference on Parallel Architectures and Compilation Techniques ({PACT}), 2019.</li>
<li id="phl">
 Partial Horn logic and cartesian categories. Annals of Pure and Applied Logic, 145(3):314353, 2007.</li>
<li id="locally-presentable-and-accessible-categories">
 Locally Presentable and Accessible Categories. 1994.</li>
<li id="flix">
 From Datalog to flix: a declarative language for fixed points on lattices. {ACM} {SIGPLAN} Notices, 51(6):194208, 2016.</li>
<li id="alias-analysis-bdd">
 Cloning-based context-sensitive pointer alias analysis using binary decision diagrams. {ACM} {SIGPLAN} Notices, 39(6):131144, 2004.</li>
<li id="declarative-points-to">
 Strictly declarative specification of sophisticated points-to analyses. Proceeding of the 24th {ACM} {SIGPLAN} conference on Object oriented programming systems languages and applications - {OOPSLA} 09, 2009.</li>
<li id="know-datalog">
 What you always wanted to know about Datalog (and never dared to ask)., 1(1):146166, 1989.</li>
<li id="hovey-model-categories">
 Mark Hovey. Model categories., (63), 2007.</li>
<li id="egg">
 Max Willsey, Chandrakana Nandi, Yisu Remy Wang, Oliver Flatt, Zachary Tatlock and Pavel Panchekha. Egg: Fast and Extensible Equality Saturation. Proc. ACM Program. Lang., 5(POPL), 2021.</li>
</ol>
</body>
</html>
